<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>COMPLETE_ARCHITECTURE_EXPLAINED</title>
  <style>

code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}
.display.math{display: block; text-align: center; margin: 0.5rem auto;}

html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
  <link href="data:text/css; charset=utf-8;charset=utf-8,%0A%40media%20%28prefers%2Dcolor%2Dscheme%3Adark%29%7B%2Emarkdown%2Dbody%7Bcolor%2Dscheme%3Adark%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dcomment%3A%238b949e%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dconstant%3A%2379c0ff%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dentity%3A%23d2a8ff%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dstorage%2Dmodifier%2Dimport%3A%23c9d1d9%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dentity%2Dtag%3A%237ee787%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dkeyword%3A%23ff7b72%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dstring%3A%23a5d6ff%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dvariable%3A%23ffa657%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dbrackethighlighter%2Dunmatched%3A%23f85149%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dinvalid%2Dillegal%2Dtext%3A%23f0f6fc%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dinvalid%2Dillegal%2Dbg%3A%238e1519%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dcarriage%2Dreturn%2Dtext%3A%23f0f6fc%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dcarriage%2Dreturn%2Dbg%3A%23b62324%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dstring%2Dregexp%3A%237ee787%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dlist%3A%23f2cc60%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dheading%3A%231f6feb%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Ditalic%3A%23c9d1d9%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dbold%3A%23c9d1d9%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Ddeleted%2Dtext%3A%23ffdcd7%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Ddeleted%2Dbg%3A%2367060c%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dinserted%2Dtext%3A%23aff5b4%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dinserted%2Dbg%3A%23033a16%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dchanged%2Dtext%3A%23ffdfb6%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dchanged%2Dbg%3A%235a1e02%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dignored%2Dtext%3A%23c9d1d9%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dignored%2Dbg%3A%231158c7%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmeta%2Ddiff%2Drange%3A%23d2a8ff%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dbrackethighlighter%2Dangle%3A%238b949e%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dsublimelinter%2Dgutter%2Dmark%3A%23484f58%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dconstant%2Dother%2Dreference%2Dlink%3A%23a5d6ff%3B%2D%2Dcolor%2Dfg%2Ddefault%3A%23c9d1d9%3B%2D%2Dcolor%2Dfg%2Dmuted%3A%238b949e%3B%2D%2Dcolor%2Dfg%2Dsubtle%3A%236e7681%3B%2D%2Dcolor%2Dcanvas%2Ddefault%3A%230d1117%3B%2D%2Dcolor%2Dcanvas%2Dsubtle%3A%23161b22%3B%2D%2Dcolor%2Dborder%2Ddefault%3A%2330363d%3B%2D%2Dcolor%2Dborder%2Dmuted%3A%2321262d%3B%2D%2Dcolor%2Dneutral%2Dmuted%3Argba%28110%2C118%2C129%2C0%2E4%29%3B%2D%2Dcolor%2Daccent%2Dfg%3A%2358a6ff%3B%2D%2Dcolor%2Daccent%2Demphasis%3A%231f6feb%3B%2D%2Dcolor%2Dattention%2Dsubtle%3Argba%28187%2C128%2C9%2C0%2E15%29%3B%2D%2Dcolor%2Ddanger%2Dfg%3A%23f85149%7D%7D%40media%20%28prefers%2Dcolor%2Dscheme%3Alight%29%7B%2Emarkdown%2Dbody%7Bcolor%2Dscheme%3Alight%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dcomment%3A%236e7781%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dconstant%3A%230550ae%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dentity%3A%238250df%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dstorage%2Dmodifier%2Dimport%3A%2324292f%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dentity%2Dtag%3A%23116329%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dkeyword%3A%23cf222e%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dstring%3A%230a3069%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dvariable%3A%23953800%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dbrackethighlighter%2Dunmatched%3A%2382071e%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dinvalid%2Dillegal%2Dtext%3A%23f6f8fa%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dinvalid%2Dillegal%2Dbg%3A%2382071e%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dcarriage%2Dreturn%2Dtext%3A%23f6f8fa%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dcarriage%2Dreturn%2Dbg%3A%23cf222e%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dstring%2Dregexp%3A%23116329%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dlist%3A%233b2300%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dheading%3A%230550ae%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Ditalic%3A%2324292f%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dbold%3A%2324292f%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Ddeleted%2Dtext%3A%2382071e%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Ddeleted%2Dbg%3A%23ffebe9%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dinserted%2Dtext%3A%23116329%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dinserted%2Dbg%3A%23dafbe1%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dchanged%2Dtext%3A%23953800%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dchanged%2Dbg%3A%23ffd8b5%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dignored%2Dtext%3A%23eaeef2%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dignored%2Dbg%3A%230550ae%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmeta%2Ddiff%2Drange%3A%238250df%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dbrackethighlighter%2Dangle%3A%2357606a%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dsublimelinter%2Dgutter%2Dmark%3A%238c959f%3B%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dconstant%2Dother%2Dreference%2Dlink%3A%230a3069%3B%2D%2Dcolor%2Dfg%2Ddefault%3A%2324292f%3B%2D%2Dcolor%2Dfg%2Dmuted%3A%2357606a%3B%2D%2Dcolor%2Dfg%2Dsubtle%3A%236e7781%3B%2D%2Dcolor%2Dcanvas%2Ddefault%3A%23ffffff%3B%2D%2Dcolor%2Dcanvas%2Dsubtle%3A%23f6f8fa%3B%2D%2Dcolor%2Dborder%2Ddefault%3A%23d0d7de%3B%2D%2Dcolor%2Dborder%2Dmuted%3Ahsla%28210%2C18%25%2C87%25%2C1%29%3B%2D%2Dcolor%2Dneutral%2Dmuted%3Argba%28175%2C184%2C193%2C0%2E2%29%3B%2D%2Dcolor%2Daccent%2Dfg%3A%230969da%3B%2D%2Dcolor%2Daccent%2Demphasis%3A%230969da%3B%2D%2Dcolor%2Dattention%2Dsubtle%3A%23fff8c5%3B%2D%2Dcolor%2Ddanger%2Dfg%3A%23cf222e%7D%7D%2Emarkdown%2Dbody%7B%2Dms%2Dtext%2Dsize%2Dadjust%3A100%25%3B%2Dwebkit%2Dtext%2Dsize%2Dadjust%3A100%25%3Bmargin%3A0%3Bcolor%3Avar%28%2D%2Dcolor%2Dfg%2Ddefault%29%3Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dcanvas%2Ddefault%29%3Bfont%2Dfamily%3A%2Dapple%2Dsystem%2CBlinkMacSystemFont%2C%22Segoe%20UI%22%2C%22Noto%20Sans%22%2CHelvetica%2CArial%2Csans%2Dserif%2C%22Apple%20Color%20Emoji%22%2C%22Segoe%20UI%20Emoji%22%3Bfont%2Dsize%3A16px%3Bline%2Dheight%3A1%2E5%3Bword%2Dwrap%3Abreak%2Dword%7D%2Emarkdown%2Dbody%20%2Eocticon%7Bdisplay%3Ainline%2Dblock%3Bfill%3AcurrentColor%3Bvertical%2Dalign%3Atext%2Dbottom%7D%2Emarkdown%2Dbody%20h1%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%3Abefore%2C%2Emarkdown%2Dbody%20h2%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%3Abefore%2C%2Emarkdown%2Dbody%20h3%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%3Abefore%2C%2Emarkdown%2Dbody%20h4%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%3Abefore%2C%2Emarkdown%2Dbody%20h5%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%3Abefore%2C%2Emarkdown%2Dbody%20h6%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%3Abefore%7Bwidth%3A16px%3Bheight%3A16px%3Bcontent%3A%27%20%27%3Bdisplay%3Ainline%2Dblock%3Bbackground%2Dcolor%3AcurrentColor%3B%2Dwebkit%2Dmask%2Dimage%3Aurl%28%22data%3Aimage%2Fsvg%2Bxml%2C%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww%2Ew3%2Eorg%2F2000%2Fsvg%27%20viewBox%3D%270%200%2016%2016%27%20version%3D%271%2E1%27%20aria%2Dhidden%3D%27true%27%3E%3Cpath%20fill%2Drule%3D%27evenodd%27%20d%3D%27M7%2E775%203%2E275a%2E75%2E75%200%20001%2E06%201%2E06l1%2E25%2D1%2E25a2%202%200%20112%2E83%202%2E83l%2D2%2E5%202%2E5a2%202%200%2001%2D2%2E83%200%20%2E75%2E75%200%2000%2D1%2E06%201%2E06%203%2E5%203%2E5%200%20004%2E95%200l2%2E5%2D2%2E5a3%2E5%203%2E5%200%2000%2D4%2E95%2D4%2E95l%2D1%2E25%201%2E25zm%2D4%2E69%209%2E64a2%202%200%20010%2D2%2E83l2%2E5%2D2%2E5a2%202%200%20012%2E83%200%20%2E75%2E75%200%20001%2E06%2D1%2E06%203%2E5%203%2E5%200%2000%2D4%2E95%200l%2D2%2E5%202%2E5a3%2E5%203%2E5%200%20004%2E95%204%2E95l1%2E25%2D1%2E25a%2E75%2E75%200%2000%2D1%2E06%2D1%2E06l%2D1%2E25%201%2E25a2%202%200%2001%2D2%2E83%200z%27%3E%3C%2Fpath%3E%3C%2Fsvg%3E%22%29%3Bmask%2Dimage%3Aurl%28%22data%3Aimage%2Fsvg%2Bxml%2C%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww%2Ew3%2Eorg%2F2000%2Fsvg%27%20viewBox%3D%270%200%2016%2016%27%20version%3D%271%2E1%27%20aria%2Dhidden%3D%27true%27%3E%3Cpath%20fill%2Drule%3D%27evenodd%27%20d%3D%27M7%2E775%203%2E275a%2E75%2E75%200%20001%2E06%201%2E06l1%2E25%2D1%2E25a2%202%200%20112%2E83%202%2E83l%2D2%2E5%202%2E5a2%202%200%2001%2D2%2E83%200%20%2E75%2E75%200%2000%2D1%2E06%201%2E06%203%2E5%203%2E5%200%20004%2E95%200l2%2E5%2D2%2E5a3%2E5%203%2E5%200%2000%2D4%2E95%2D4%2E95l%2D1%2E25%201%2E25zm%2D4%2E69%209%2E64a2%202%200%20010%2D2%2E83l2%2E5%2D2%2E5a2%202%200%20012%2E83%200%20%2E75%2E75%200%20001%2E06%2D1%2E06%203%2E5%203%2E5%200%2000%2D4%2E95%200l%2D2%2E5%202%2E5a3%2E5%203%2E5%200%20004%2E95%204%2E95l1%2E25%2D1%2E25a%2E75%2E75%200%2000%2D1%2E06%2D1%2E06l%2D1%2E25%201%2E25a2%202%200%2001%2D2%2E83%200z%27%3E%3C%2Fpath%3E%3C%2Fsvg%3E%22%29%7D%2Emarkdown%2Dbody%20details%2C%2Emarkdown%2Dbody%20figcaption%2C%2Emarkdown%2Dbody%20figure%7Bdisplay%3Ablock%7D%2Emarkdown%2Dbody%20summary%7Bdisplay%3Alist%2Ditem%7D%2Emarkdown%2Dbody%20%5Bhidden%5D%7Bdisplay%3Anone%21important%7D%2Emarkdown%2Dbody%20a%7Bbackground%2Dcolor%3Atransparent%3Bcolor%3Avar%28%2D%2Dcolor%2Daccent%2Dfg%29%3Btext%2Ddecoration%3Anone%7D%2Emarkdown%2Dbody%20abbr%5Btitle%5D%7Bborder%2Dbottom%3Anone%3Btext%2Ddecoration%3Aunderline%20dotted%7D%2Emarkdown%2Dbody%20b%2C%2Emarkdown%2Dbody%20strong%7Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dsemibold%2C600%29%7D%2Emarkdown%2Dbody%20dfn%7Bfont%2Dstyle%3Aitalic%7D%2Emarkdown%2Dbody%20h1%7Bmargin%3A%2E67em%200%3Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dsemibold%2C600%29%3Bpadding%2Dbottom%3A%2E3em%3Bfont%2Dsize%3A2em%3Bborder%2Dbottom%3A1px%20solid%20var%28%2D%2Dcolor%2Dborder%2Dmuted%29%7D%2Emarkdown%2Dbody%20mark%7Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dattention%2Dsubtle%29%3Bcolor%3Avar%28%2D%2Dcolor%2Dfg%2Ddefault%29%7D%2Emarkdown%2Dbody%20small%7Bfont%2Dsize%3A90%25%7D%2Emarkdown%2Dbody%20sub%2C%2Emarkdown%2Dbody%20sup%7Bfont%2Dsize%3A75%25%3Bline%2Dheight%3A0%3Bposition%3Arelative%3Bvertical%2Dalign%3Abaseline%7D%2Emarkdown%2Dbody%20sub%7Bbottom%3A%2D%2E25em%7D%2Emarkdown%2Dbody%20sup%7Btop%3A%2D%2E5em%7D%2Emarkdown%2Dbody%20img%7Bborder%2Dstyle%3Anone%3Bmax%2Dwidth%3A100%25%3Bbox%2Dsizing%3Acontent%2Dbox%3Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dcanvas%2Ddefault%29%7D%2Emarkdown%2Dbody%20code%2C%2Emarkdown%2Dbody%20kbd%2C%2Emarkdown%2Dbody%20pre%2C%2Emarkdown%2Dbody%20samp%7Bfont%2Dfamily%3Amonospace%3Bfont%2Dsize%3A1em%7D%2Emarkdown%2Dbody%20figure%7Bmargin%3A1em%2040px%7D%2Emarkdown%2Dbody%20hr%7Bbox%2Dsizing%3Acontent%2Dbox%3Boverflow%3Ahidden%3Bbackground%3A0%200%3Bborder%2Dbottom%3A1px%20solid%20var%28%2D%2Dcolor%2Dborder%2Dmuted%29%3Bheight%3A%2E25em%3Bpadding%3A0%3Bmargin%3A24px%200%3Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dborder%2Ddefault%29%3Bborder%3A0%7D%2Emarkdown%2Dbody%20input%7Bfont%3Ainherit%3Bmargin%3A0%3Boverflow%3Avisible%3Bfont%2Dfamily%3Ainherit%3Bfont%2Dsize%3Ainherit%3Bline%2Dheight%3Ainherit%7D%2Emarkdown%2Dbody%20%5Btype%3Dbutton%5D%2C%2Emarkdown%2Dbody%20%5Btype%3Dreset%5D%2C%2Emarkdown%2Dbody%20%5Btype%3Dsubmit%5D%7B%2Dwebkit%2Dappearance%3Abutton%7D%2Emarkdown%2Dbody%20%5Btype%3Dcheckbox%5D%2C%2Emarkdown%2Dbody%20%5Btype%3Dradio%5D%7Bbox%2Dsizing%3Aborder%2Dbox%3Bpadding%3A0%7D%2Emarkdown%2Dbody%20%5Btype%3Dnumber%5D%3A%3A%2Dwebkit%2Dinner%2Dspin%2Dbutton%2C%2Emarkdown%2Dbody%20%5Btype%3Dnumber%5D%3A%3A%2Dwebkit%2Douter%2Dspin%2Dbutton%7Bheight%3Aauto%7D%2Emarkdown%2Dbody%20%5Btype%3Dsearch%5D%3A%3A%2Dwebkit%2Dsearch%2Dcancel%2Dbutton%2C%2Emarkdown%2Dbody%20%5Btype%3Dsearch%5D%3A%3A%2Dwebkit%2Dsearch%2Ddecoration%7B%2Dwebkit%2Dappearance%3Anone%7D%2Emarkdown%2Dbody%20%3A%3A%2Dwebkit%2Dinput%2Dplaceholder%7Bcolor%3Ainherit%3Bopacity%3A%2E54%7D%2Emarkdown%2Dbody%20%3A%3A%2Dwebkit%2Dfile%2Dupload%2Dbutton%7B%2Dwebkit%2Dappearance%3Abutton%3Bfont%3Ainherit%7D%2Emarkdown%2Dbody%20a%3Ahover%7Btext%2Ddecoration%3Aunderline%7D%2Emarkdown%2Dbody%20%3A%3Aplaceholder%7Bcolor%3Avar%28%2D%2Dcolor%2Dfg%2Dsubtle%29%3Bopacity%3A1%7D%2Emarkdown%2Dbody%20hr%3A%3Abefore%7Bdisplay%3Atable%3Bcontent%3A%22%22%7D%2Emarkdown%2Dbody%20hr%3A%3Aafter%7Bdisplay%3Atable%3Bclear%3Aboth%3Bcontent%3A%22%22%7D%2Emarkdown%2Dbody%20table%7Bborder%2Dspacing%3A0%3Bborder%2Dcollapse%3Acollapse%3Bdisplay%3Ablock%3Bwidth%3Amax%2Dcontent%3Bmax%2Dwidth%3A100%25%3Boverflow%3Aauto%7D%2Emarkdown%2Dbody%20td%2C%2Emarkdown%2Dbody%20th%7Bpadding%3A0%7D%2Emarkdown%2Dbody%20details%20summary%7Bcursor%3Apointer%7D%2Emarkdown%2Dbody%20details%3Anot%28%5Bopen%5D%29%3E%3Anot%28summary%29%7Bdisplay%3Anone%21important%7D%2Emarkdown%2Dbody%20%5Brole%3Dbutton%5D%3Afocus%2C%2Emarkdown%2Dbody%20a%3Afocus%2C%2Emarkdown%2Dbody%20input%5Btype%3Dcheckbox%5D%3Afocus%2C%2Emarkdown%2Dbody%20input%5Btype%3Dradio%5D%3Afocus%7Boutline%3A2px%20solid%20var%28%2D%2Dcolor%2Daccent%2Dfg%29%3Boutline%2Doffset%3A%2D2px%3Bbox%2Dshadow%3Anone%7D%2Emarkdown%2Dbody%20%5Brole%3Dbutton%5D%3Afocus%3Anot%28%3Afocus%2Dvisible%29%2C%2Emarkdown%2Dbody%20a%3Afocus%3Anot%28%3Afocus%2Dvisible%29%2C%2Emarkdown%2Dbody%20input%5Btype%3Dcheckbox%5D%3Afocus%3Anot%28%3Afocus%2Dvisible%29%2C%2Emarkdown%2Dbody%20input%5Btype%3Dradio%5D%3Afocus%3Anot%28%3Afocus%2Dvisible%29%7Boutline%3Asolid%201px%20transparent%7D%2Emarkdown%2Dbody%20%5Brole%3Dbutton%5D%3Afocus%2Dvisible%2C%2Emarkdown%2Dbody%20a%3Afocus%2Dvisible%2C%2Emarkdown%2Dbody%20input%5Btype%3Dcheckbox%5D%3Afocus%2Dvisible%2C%2Emarkdown%2Dbody%20input%5Btype%3Dradio%5D%3Afocus%2Dvisible%7Boutline%3A2px%20solid%20var%28%2D%2Dcolor%2Daccent%2Dfg%29%3Boutline%2Doffset%3A%2D2px%3Bbox%2Dshadow%3Anone%7D%2Emarkdown%2Dbody%20a%3Anot%28%5Bclass%5D%29%3Afocus%2C%2Emarkdown%2Dbody%20a%3Anot%28%5Bclass%5D%29%3Afocus%2Dvisible%2C%2Emarkdown%2Dbody%20input%5Btype%3Dcheckbox%5D%3Afocus%2C%2Emarkdown%2Dbody%20input%5Btype%3Dcheckbox%5D%3Afocus%2Dvisible%2C%2Emarkdown%2Dbody%20input%5Btype%3Dradio%5D%3Afocus%2C%2Emarkdown%2Dbody%20input%5Btype%3Dradio%5D%3Afocus%2Dvisible%7Boutline%2Doffset%3A0%7D%2Emarkdown%2Dbody%20kbd%7Bdisplay%3Ainline%2Dblock%3Bpadding%3A3px%205px%3Bfont%3A11px%20ui%2Dmonospace%2CSFMono%2DRegular%2CSF%20Mono%2CMenlo%2CConsolas%2CLiberation%20Mono%2Cmonospace%3Bline%2Dheight%3A10px%3Bcolor%3Avar%28%2D%2Dcolor%2Dfg%2Ddefault%29%3Bvertical%2Dalign%3Amiddle%3Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dcanvas%2Dsubtle%29%3Bborder%3Asolid%201px%20var%28%2D%2Dcolor%2Dneutral%2Dmuted%29%3Bborder%2Dbottom%2Dcolor%3Avar%28%2D%2Dcolor%2Dneutral%2Dmuted%29%3Bborder%2Dradius%3A6px%3Bbox%2Dshadow%3Ainset%200%20%2D1px%200%20var%28%2D%2Dcolor%2Dneutral%2Dmuted%29%7D%2Emarkdown%2Dbody%20h1%2C%2Emarkdown%2Dbody%20h2%2C%2Emarkdown%2Dbody%20h3%2C%2Emarkdown%2Dbody%20h4%2C%2Emarkdown%2Dbody%20h5%2C%2Emarkdown%2Dbody%20h6%7Bmargin%2Dtop%3A24px%3Bmargin%2Dbottom%3A16px%3Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dsemibold%2C600%29%3Bline%2Dheight%3A1%2E25%7D%2Emarkdown%2Dbody%20h2%7Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dsemibold%2C600%29%3Bpadding%2Dbottom%3A%2E3em%3Bfont%2Dsize%3A1%2E5em%3Bborder%2Dbottom%3A1px%20solid%20var%28%2D%2Dcolor%2Dborder%2Dmuted%29%7D%2Emarkdown%2Dbody%20h3%7Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dsemibold%2C600%29%3Bfont%2Dsize%3A1%2E25em%7D%2Emarkdown%2Dbody%20h4%7Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dsemibold%2C600%29%3Bfont%2Dsize%3A1em%7D%2Emarkdown%2Dbody%20h5%7Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dsemibold%2C600%29%3Bfont%2Dsize%3A%2E875em%7D%2Emarkdown%2Dbody%20h6%7Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dsemibold%2C600%29%3Bfont%2Dsize%3A%2E85em%3Bcolor%3Avar%28%2D%2Dcolor%2Dfg%2Dmuted%29%7D%2Emarkdown%2Dbody%20p%7Bmargin%2Dtop%3A0%3Bmargin%2Dbottom%3A10px%7D%2Emarkdown%2Dbody%20blockquote%7Bmargin%3A0%3Bpadding%3A0%201em%3Bcolor%3Avar%28%2D%2Dcolor%2Dfg%2Dmuted%29%3Bborder%2Dleft%3A%2E25em%20solid%20var%28%2D%2Dcolor%2Dborder%2Ddefault%29%7D%2Emarkdown%2Dbody%20ol%2C%2Emarkdown%2Dbody%20ul%7Bmargin%2Dtop%3A0%3Bmargin%2Dbottom%3A0%3Bpadding%2Dleft%3A2em%7D%2Emarkdown%2Dbody%20ol%20ol%2C%2Emarkdown%2Dbody%20ul%20ol%7Blist%2Dstyle%2Dtype%3Alower%2Droman%7D%2Emarkdown%2Dbody%20ol%20ol%20ol%2C%2Emarkdown%2Dbody%20ol%20ul%20ol%2C%2Emarkdown%2Dbody%20ul%20ol%20ol%2C%2Emarkdown%2Dbody%20ul%20ul%20ol%7Blist%2Dstyle%2Dtype%3Alower%2Dalpha%7D%2Emarkdown%2Dbody%20dd%7Bmargin%2Dleft%3A0%7D%2Emarkdown%2Dbody%20code%2C%2Emarkdown%2Dbody%20samp%2C%2Emarkdown%2Dbody%20tt%7Bfont%2Dfamily%3Aui%2Dmonospace%2CSFMono%2DRegular%2CSF%20Mono%2CMenlo%2CConsolas%2CLiberation%20Mono%2Cmonospace%3Bfont%2Dsize%3A12px%7D%2Emarkdown%2Dbody%20pre%7Bmargin%2Dtop%3A0%3Bmargin%2Dbottom%3A0%3Bfont%2Dfamily%3Aui%2Dmonospace%2CSFMono%2DRegular%2CSF%20Mono%2CMenlo%2CConsolas%2CLiberation%20Mono%2Cmonospace%3Bfont%2Dsize%3A12px%3Bword%2Dwrap%3Anormal%7D%2Emarkdown%2Dbody%20%2Eocticon%7Bdisplay%3Ainline%2Dblock%3Boverflow%3Avisible%21important%3Bvertical%2Dalign%3Atext%2Dbottom%3Bfill%3AcurrentColor%7D%2Emarkdown%2Dbody%20input%3A%3A%2Dwebkit%2Dinner%2Dspin%2Dbutton%2C%2Emarkdown%2Dbody%20input%3A%3A%2Dwebkit%2Douter%2Dspin%2Dbutton%7Bmargin%3A0%3B%2Dwebkit%2Dappearance%3Anone%3Bappearance%3Anone%7D%2Emarkdown%2Dbody%3A%3Abefore%7Bdisplay%3Atable%3Bcontent%3A%22%22%7D%2Emarkdown%2Dbody%3A%3Aafter%7Bdisplay%3Atable%3Bclear%3Aboth%3Bcontent%3A%22%22%7D%2Emarkdown%2Dbody%3E%3Afirst%2Dchild%7Bmargin%2Dtop%3A0%21important%7D%2Emarkdown%2Dbody%3E%3Alast%2Dchild%7Bmargin%2Dbottom%3A0%21important%7D%2Emarkdown%2Dbody%20a%3Anot%28%5Bhref%5D%29%7Bcolor%3Ainherit%3Btext%2Ddecoration%3Anone%7D%2Emarkdown%2Dbody%20%2Eabsent%7Bcolor%3Avar%28%2D%2Dcolor%2Ddanger%2Dfg%29%7D%2Emarkdown%2Dbody%20%2Eanchor%7Bfloat%3Aleft%3Bpadding%2Dright%3A4px%3Bmargin%2Dleft%3A%2D20px%3Bline%2Dheight%3A1%7D%2Emarkdown%2Dbody%20%2Eanchor%3Afocus%7Boutline%3A0%7D%2Emarkdown%2Dbody%20blockquote%2C%2Emarkdown%2Dbody%20details%2C%2Emarkdown%2Dbody%20dl%2C%2Emarkdown%2Dbody%20ol%2C%2Emarkdown%2Dbody%20p%2C%2Emarkdown%2Dbody%20pre%2C%2Emarkdown%2Dbody%20table%2C%2Emarkdown%2Dbody%20ul%7Bmargin%2Dtop%3A0%3Bmargin%2Dbottom%3A16px%7D%2Emarkdown%2Dbody%20blockquote%3E%3Afirst%2Dchild%7Bmargin%2Dtop%3A0%7D%2Emarkdown%2Dbody%20blockquote%3E%3Alast%2Dchild%7Bmargin%2Dbottom%3A0%7D%2Emarkdown%2Dbody%20h1%20%2Eocticon%2Dlink%2C%2Emarkdown%2Dbody%20h2%20%2Eocticon%2Dlink%2C%2Emarkdown%2Dbody%20h3%20%2Eocticon%2Dlink%2C%2Emarkdown%2Dbody%20h4%20%2Eocticon%2Dlink%2C%2Emarkdown%2Dbody%20h5%20%2Eocticon%2Dlink%2C%2Emarkdown%2Dbody%20h6%20%2Eocticon%2Dlink%7Bcolor%3Avar%28%2D%2Dcolor%2Dfg%2Ddefault%29%3Bvertical%2Dalign%3Amiddle%3Bvisibility%3Ahidden%7D%2Emarkdown%2Dbody%20h1%3Ahover%20%2Eanchor%2C%2Emarkdown%2Dbody%20h2%3Ahover%20%2Eanchor%2C%2Emarkdown%2Dbody%20h3%3Ahover%20%2Eanchor%2C%2Emarkdown%2Dbody%20h4%3Ahover%20%2Eanchor%2C%2Emarkdown%2Dbody%20h5%3Ahover%20%2Eanchor%2C%2Emarkdown%2Dbody%20h6%3Ahover%20%2Eanchor%7Btext%2Ddecoration%3Anone%7D%2Emarkdown%2Dbody%20h1%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%2Emarkdown%2Dbody%20h2%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%2Emarkdown%2Dbody%20h3%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%2Emarkdown%2Dbody%20h4%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%2Emarkdown%2Dbody%20h5%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%2Emarkdown%2Dbody%20h6%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%7Bvisibility%3Avisible%7D%2Emarkdown%2Dbody%20h1%20code%2C%2Emarkdown%2Dbody%20h1%20tt%2C%2Emarkdown%2Dbody%20h2%20code%2C%2Emarkdown%2Dbody%20h2%20tt%2C%2Emarkdown%2Dbody%20h3%20code%2C%2Emarkdown%2Dbody%20h3%20tt%2C%2Emarkdown%2Dbody%20h4%20code%2C%2Emarkdown%2Dbody%20h4%20tt%2C%2Emarkdown%2Dbody%20h5%20code%2C%2Emarkdown%2Dbody%20h5%20tt%2C%2Emarkdown%2Dbody%20h6%20code%2C%2Emarkdown%2Dbody%20h6%20tt%7Bpadding%3A0%20%2E2em%3Bfont%2Dsize%3Ainherit%7D%2Emarkdown%2Dbody%20summary%20h1%2C%2Emarkdown%2Dbody%20summary%20h2%2C%2Emarkdown%2Dbody%20summary%20h3%2C%2Emarkdown%2Dbody%20summary%20h4%2C%2Emarkdown%2Dbody%20summary%20h5%2C%2Emarkdown%2Dbody%20summary%20h6%7Bdisplay%3Ainline%2Dblock%7D%2Emarkdown%2Dbody%20summary%20h1%20%2Eanchor%2C%2Emarkdown%2Dbody%20summary%20h2%20%2Eanchor%2C%2Emarkdown%2Dbody%20summary%20h3%20%2Eanchor%2C%2Emarkdown%2Dbody%20summary%20h4%20%2Eanchor%2C%2Emarkdown%2Dbody%20summary%20h5%20%2Eanchor%2C%2Emarkdown%2Dbody%20summary%20h6%20%2Eanchor%7Bmargin%2Dleft%3A%2D40px%7D%2Emarkdown%2Dbody%20summary%20h1%2C%2Emarkdown%2Dbody%20summary%20h2%7Bpadding%2Dbottom%3A0%3Bborder%2Dbottom%3A0%7D%2Emarkdown%2Dbody%20ol%2Eno%2Dlist%2C%2Emarkdown%2Dbody%20ul%2Eno%2Dlist%7Bpadding%3A0%3Blist%2Dstyle%2Dtype%3Anone%7D%2Emarkdown%2Dbody%20ol%5Btype%3Da%5D%7Blist%2Dstyle%2Dtype%3Alower%2Dalpha%7D%2Emarkdown%2Dbody%20ol%5Btype%3DA%5D%7Blist%2Dstyle%2Dtype%3Aupper%2Dalpha%7D%2Emarkdown%2Dbody%20ol%5Btype%3Di%5D%7Blist%2Dstyle%2Dtype%3Alower%2Droman%7D%2Emarkdown%2Dbody%20ol%5Btype%3DI%5D%7Blist%2Dstyle%2Dtype%3Aupper%2Droman%7D%2Emarkdown%2Dbody%20ol%5Btype%3D%221%22%5D%7Blist%2Dstyle%2Dtype%3Adecimal%7D%2Emarkdown%2Dbody%20div%3Eol%3Anot%28%5Btype%5D%29%7Blist%2Dstyle%2Dtype%3Adecimal%7D%2Emarkdown%2Dbody%20ol%20ol%2C%2Emarkdown%2Dbody%20ol%20ul%2C%2Emarkdown%2Dbody%20ul%20ol%2C%2Emarkdown%2Dbody%20ul%20ul%7Bmargin%2Dtop%3A0%3Bmargin%2Dbottom%3A0%7D%2Emarkdown%2Dbody%20li%3Ep%7Bmargin%2Dtop%3A16px%7D%2Emarkdown%2Dbody%20li%2Bli%7Bmargin%2Dtop%3A%2E25em%7D%2Emarkdown%2Dbody%20dl%7Bpadding%3A0%7D%2Emarkdown%2Dbody%20dl%20dt%7Bpadding%3A0%3Bmargin%2Dtop%3A16px%3Bfont%2Dsize%3A1em%3Bfont%2Dstyle%3Aitalic%3Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dsemibold%2C600%29%7D%2Emarkdown%2Dbody%20dl%20dd%7Bpadding%3A0%2016px%3Bmargin%2Dbottom%3A16px%7D%2Emarkdown%2Dbody%20table%20th%7Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dsemibold%2C600%29%7D%2Emarkdown%2Dbody%20table%20td%2C%2Emarkdown%2Dbody%20table%20th%7Bpadding%3A6px%2013px%3Bborder%3A1px%20solid%20var%28%2D%2Dcolor%2Dborder%2Ddefault%29%7D%2Emarkdown%2Dbody%20table%20tr%7Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dcanvas%2Ddefault%29%3Bborder%2Dtop%3A1px%20solid%20var%28%2D%2Dcolor%2Dborder%2Dmuted%29%7D%2Emarkdown%2Dbody%20table%20tr%3Anth%2Dchild%282n%29%7Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dcanvas%2Dsubtle%29%7D%2Emarkdown%2Dbody%20table%20img%7Bbackground%2Dcolor%3Atransparent%7D%2Emarkdown%2Dbody%20img%5Balign%3Dright%5D%7Bpadding%2Dleft%3A20px%7D%2Emarkdown%2Dbody%20img%5Balign%3Dleft%5D%7Bpadding%2Dright%3A20px%7D%2Emarkdown%2Dbody%20%2Eemoji%7Bmax%2Dwidth%3Anone%3Bvertical%2Dalign%3Atext%2Dtop%3Bbackground%2Dcolor%3Atransparent%7D%2Emarkdown%2Dbody%20span%2Eframe%7Bdisplay%3Ablock%3Boverflow%3Ahidden%7D%2Emarkdown%2Dbody%20span%2Eframe%3Espan%7Bdisplay%3Ablock%3Bfloat%3Aleft%3Bwidth%3Aauto%3Bpadding%3A7px%3Bmargin%3A13px%200%200%3Boverflow%3Ahidden%3Bborder%3A1px%20solid%20var%28%2D%2Dcolor%2Dborder%2Ddefault%29%7D%2Emarkdown%2Dbody%20span%2Eframe%20span%20img%7Bdisplay%3Ablock%3Bfloat%3Aleft%7D%2Emarkdown%2Dbody%20span%2Eframe%20span%20span%7Bdisplay%3Ablock%3Bpadding%3A5px%200%200%3Bclear%3Aboth%3Bcolor%3Avar%28%2D%2Dcolor%2Dfg%2Ddefault%29%7D%2Emarkdown%2Dbody%20span%2Ealign%2Dcenter%7Bdisplay%3Ablock%3Boverflow%3Ahidden%3Bclear%3Aboth%7D%2Emarkdown%2Dbody%20span%2Ealign%2Dcenter%3Espan%7Bdisplay%3Ablock%3Bmargin%3A13px%20auto%200%3Boverflow%3Ahidden%3Btext%2Dalign%3Acenter%7D%2Emarkdown%2Dbody%20span%2Ealign%2Dcenter%20span%20img%7Bmargin%3A0%20auto%3Btext%2Dalign%3Acenter%7D%2Emarkdown%2Dbody%20span%2Ealign%2Dright%7Bdisplay%3Ablock%3Boverflow%3Ahidden%3Bclear%3Aboth%7D%2Emarkdown%2Dbody%20span%2Ealign%2Dright%3Espan%7Bdisplay%3Ablock%3Bmargin%3A13px%200%200%3Boverflow%3Ahidden%3Btext%2Dalign%3Aright%7D%2Emarkdown%2Dbody%20span%2Ealign%2Dright%20span%20img%7Bmargin%3A0%3Btext%2Dalign%3Aright%7D%2Emarkdown%2Dbody%20span%2Efloat%2Dleft%7Bdisplay%3Ablock%3Bfloat%3Aleft%3Bmargin%2Dright%3A13px%3Boverflow%3Ahidden%7D%2Emarkdown%2Dbody%20span%2Efloat%2Dleft%20span%7Bmargin%3A13px%200%200%7D%2Emarkdown%2Dbody%20span%2Efloat%2Dright%7Bdisplay%3Ablock%3Bfloat%3Aright%3Bmargin%2Dleft%3A13px%3Boverflow%3Ahidden%7D%2Emarkdown%2Dbody%20span%2Efloat%2Dright%3Espan%7Bdisplay%3Ablock%3Bmargin%3A13px%20auto%200%3Boverflow%3Ahidden%3Btext%2Dalign%3Aright%7D%2Emarkdown%2Dbody%20code%2C%2Emarkdown%2Dbody%20tt%7Bpadding%3A%2E2em%20%2E4em%3Bmargin%3A0%3Bfont%2Dsize%3A85%25%3Bwhite%2Dspace%3Abreak%2Dspaces%3Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dneutral%2Dmuted%29%3Bborder%2Dradius%3A6px%7D%2Emarkdown%2Dbody%20code%20br%2C%2Emarkdown%2Dbody%20tt%20br%7Bdisplay%3Anone%7D%2Emarkdown%2Dbody%20del%20code%7Btext%2Ddecoration%3Ainherit%7D%2Emarkdown%2Dbody%20samp%7Bfont%2Dsize%3A85%25%7D%2Emarkdown%2Dbody%20pre%20code%7Bfont%2Dsize%3A100%25%7D%2Emarkdown%2Dbody%20pre%3Ecode%7Bpadding%3A0%3Bmargin%3A0%3Bword%2Dbreak%3Anormal%3Bwhite%2Dspace%3Apre%3Bbackground%3A0%200%3Bborder%3A0%7D%2Emarkdown%2Dbody%20%2Ehighlight%7Bmargin%2Dbottom%3A16px%7D%2Emarkdown%2Dbody%20%2Ehighlight%20pre%7Bmargin%2Dbottom%3A0%3Bword%2Dbreak%3Anormal%7D%2Emarkdown%2Dbody%20%2Ehighlight%20pre%2C%2Emarkdown%2Dbody%20pre%7Bpadding%3A16px%3Boverflow%3Aauto%3Bfont%2Dsize%3A85%25%3Bline%2Dheight%3A1%2E45%3Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dcanvas%2Dsubtle%29%3Bborder%2Dradius%3A6px%7D%2Emarkdown%2Dbody%20pre%20code%2C%2Emarkdown%2Dbody%20pre%20tt%7Bdisplay%3Ainline%3Bmax%2Dwidth%3Aauto%3Bpadding%3A0%3Bmargin%3A0%3Boverflow%3Avisible%3Bline%2Dheight%3Ainherit%3Bword%2Dwrap%3Anormal%3Bbackground%2Dcolor%3Atransparent%3Bborder%3A0%7D%2Emarkdown%2Dbody%20%2Ecsv%2Ddata%20td%2C%2Emarkdown%2Dbody%20%2Ecsv%2Ddata%20th%7Bpadding%3A5px%3Boverflow%3Ahidden%3Bfont%2Dsize%3A12px%3Bline%2Dheight%3A1%3Btext%2Dalign%3Aleft%3Bwhite%2Dspace%3Anowrap%7D%2Emarkdown%2Dbody%20%2Ecsv%2Ddata%20%2Eblob%2Dnum%7Bpadding%3A10px%208px%209px%3Btext%2Dalign%3Aright%3Bbackground%3Avar%28%2D%2Dcolor%2Dcanvas%2Ddefault%29%3Bborder%3A0%7D%2Emarkdown%2Dbody%20%2Ecsv%2Ddata%20tr%7Bborder%2Dtop%3A0%7D%2Emarkdown%2Dbody%20%2Ecsv%2Ddata%20th%7Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dsemibold%2C600%29%3Bbackground%3Avar%28%2D%2Dcolor%2Dcanvas%2Dsubtle%29%3Bborder%2Dtop%3A0%7D%2Emarkdown%2Dbody%20%5Bdata%2Dfootnote%2Dref%5D%3A%3Abefore%7Bcontent%3A%22%5B%22%7D%2Emarkdown%2Dbody%20%5Bdata%2Dfootnote%2Dref%5D%3A%3Aafter%7Bcontent%3A%22%5D%22%7D%2Emarkdown%2Dbody%20%2Efootnotes%7Bfont%2Dsize%3A12px%3Bcolor%3Avar%28%2D%2Dcolor%2Dfg%2Dmuted%29%3Bborder%2Dtop%3A1px%20solid%20var%28%2D%2Dcolor%2Dborder%2Ddefault%29%7D%2Emarkdown%2Dbody%20%2Efootnotes%20ol%7Bpadding%2Dleft%3A16px%7D%2Emarkdown%2Dbody%20%2Efootnotes%20ol%20ul%7Bdisplay%3Ainline%2Dblock%3Bpadding%2Dleft%3A16px%3Bmargin%2Dtop%3A16px%7D%2Emarkdown%2Dbody%20%2Efootnotes%20li%7Bposition%3Arelative%7D%2Emarkdown%2Dbody%20%2Efootnotes%20li%3Atarget%3A%3Abefore%7Bposition%3Aabsolute%3Btop%3A%2D8px%3Bright%3A%2D8px%3Bbottom%3A%2D8px%3Bleft%3A%2D24px%3Bpointer%2Devents%3Anone%3Bcontent%3A%22%22%3Bborder%3A2px%20solid%20var%28%2D%2Dcolor%2Daccent%2Demphasis%29%3Bborder%2Dradius%3A6px%7D%2Emarkdown%2Dbody%20%2Efootnotes%20li%3Atarget%7Bcolor%3Avar%28%2D%2Dcolor%2Dfg%2Ddefault%29%7D%2Emarkdown%2Dbody%20%2Efootnotes%20%2Edata%2Dfootnote%2Dbackref%20g%2Demoji%7Bfont%2Dfamily%3Amonospace%7D%2Emarkdown%2Dbody%20%2Epl%2Dc%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dcomment%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dc1%2C%2Emarkdown%2Dbody%20%2Epl%2Ds%20%2Epl%2Dv%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dconstant%29%7D%2Emarkdown%2Dbody%20%2Epl%2De%2C%2Emarkdown%2Dbody%20%2Epl%2Den%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dentity%29%7D%2Emarkdown%2Dbody%20%2Epl%2Ds%20%2Epl%2Ds1%2C%2Emarkdown%2Dbody%20%2Epl%2Dsmi%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dstorage%2Dmodifier%2Dimport%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dent%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dentity%2Dtag%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dk%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dkeyword%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dpds%2C%2Emarkdown%2Dbody%20%2Epl%2Ds%2C%2Emarkdown%2Dbody%20%2Epl%2Ds%20%2Epl%2Dpse%20%2Epl%2Ds1%2C%2Emarkdown%2Dbody%20%2Epl%2Dsr%2C%2Emarkdown%2Dbody%20%2Epl%2Dsr%20%2Epl%2Dcce%2C%2Emarkdown%2Dbody%20%2Epl%2Dsr%20%2Epl%2Dsra%2C%2Emarkdown%2Dbody%20%2Epl%2Dsr%20%2Epl%2Dsre%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dstring%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dsmw%2C%2Emarkdown%2Dbody%20%2Epl%2Dv%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dvariable%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dbu%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dbrackethighlighter%2Dunmatched%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dii%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dinvalid%2Dillegal%2Dtext%29%3Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dinvalid%2Dillegal%2Dbg%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dc2%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dcarriage%2Dreturn%2Dtext%29%3Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dcarriage%2Dreturn%2Dbg%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dsr%20%2Epl%2Dcce%7Bfont%2Dweight%3A700%3Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dstring%2Dregexp%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dml%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dlist%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dmh%2C%2Emarkdown%2Dbody%20%2Epl%2Dmh%20%2Epl%2Den%2C%2Emarkdown%2Dbody%20%2Epl%2Dms%7Bfont%2Dweight%3A700%3Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dheading%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dmi%7Bfont%2Dstyle%3Aitalic%3Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Ditalic%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dmb%7Bfont%2Dweight%3A700%3Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dbold%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dmd%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Ddeleted%2Dtext%29%3Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Ddeleted%2Dbg%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dmi1%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dinserted%2Dtext%29%3Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dinserted%2Dbg%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dmc%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dchanged%2Dtext%29%3Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dchanged%2Dbg%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dmi2%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dignored%2Dtext%29%3Bbackground%2Dcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmarkup%2Dignored%2Dbg%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dmdr%7Bfont%2Dweight%3A700%3Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dmeta%2Ddiff%2Drange%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dba%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dbrackethighlighter%2Dangle%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dsg%7Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dsublimelinter%2Dgutter%2Dmark%29%7D%2Emarkdown%2Dbody%20%2Epl%2Dcorl%7Btext%2Ddecoration%3Aunderline%3Bcolor%3Avar%28%2D%2Dcolor%2Dprettylights%2Dsyntax%2Dconstant%2Dother%2Dreference%2Dlink%29%7D%2Emarkdown%2Dbody%20g%2Demoji%7Bdisplay%3Ainline%2Dblock%3Bmin%2Dwidth%3A1ch%3Bfont%2Dfamily%3A%22Apple%20Color%20Emoji%22%2C%22Segoe%20UI%20Emoji%22%2C%22Segoe%20UI%20Symbol%22%3Bfont%2Dsize%3A1em%3Bfont%2Dstyle%3Anormal%21important%3Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dnormal%2C400%29%3Bline%2Dheight%3A1%3Bvertical%2Dalign%3A%2D%2E075em%7D%2Emarkdown%2Dbody%20g%2Demoji%20img%7Bwidth%3A1em%3Bheight%3A1em%7D%2Emarkdown%2Dbody%20%2Etask%2Dlist%2Ditem%7Blist%2Dstyle%2Dtype%3Anone%7D%2Emarkdown%2Dbody%20%2Etask%2Dlist%2Ditem%20label%7Bfont%2Dweight%3Avar%28%2D%2Dbase%2Dtext%2Dweight%2Dnormal%2C400%29%7D%2Emarkdown%2Dbody%20%2Etask%2Dlist%2Ditem%2Eenabled%20label%7Bcursor%3Apointer%7D%2Emarkdown%2Dbody%20%2Etask%2Dlist%2Ditem%2B%2Etask%2Dlist%2Ditem%7Bmargin%2Dtop%3A4px%7D%2Emarkdown%2Dbody%20%2Etask%2Dlist%2Ditem%20%2Ehandle%7Bdisplay%3Anone%7D%2Emarkdown%2Dbody%20%2Etask%2Dlist%2Ditem%2Dcheckbox%7Bmargin%3A0%20%2E2em%20%2E25em%20%2D1%2E4em%3Bvertical%2Dalign%3Amiddle%7D%2Emarkdown%2Dbody%20%2Econtains%2Dtask%2Dlist%3Adir%28rtl%29%20%2Etask%2Dlist%2Ditem%2Dcheckbox%7Bmargin%3A0%20%2D1%2E6em%20%2E25em%20%2E2em%7D%2Emarkdown%2Dbody%20%2Econtains%2Dtask%2Dlist%7Bposition%3Arelative%7D%2Emarkdown%2Dbody%20%2Econtains%2Dtask%2Dlist%3Afocus%2Dwithin%20%2Etask%2Dlist%2Ditem%2Dconvert%2Dcontainer%2C%2Emarkdown%2Dbody%20%2Econtains%2Dtask%2Dlist%3Ahover%20%2Etask%2Dlist%2Ditem%2Dconvert%2Dcontainer%7Bdisplay%3Ablock%3Bwidth%3Aauto%3Bheight%3A24px%3Boverflow%3Avisible%3Bclip%3Aauto%7D%2Emarkdown%2Dbody%20%3A%3A%2Dwebkit%2Dcalendar%2Dpicker%2Dindicator%7Bfilter%3Ainvert%2850%25%29%7D%0A" rel="stylesheet" />
</head>
<body>
<h1 id="complete-event-driven-architecture---beginners-guide">Complete
Event-Driven Architecture - Beginner’s Guide</h1>
<p><strong>A Step-by-Step Explanation of Building Production-Grade Cloud
Applications</strong></p>
<p><em>Author: Learning Guide for Beginners</em> <em>Date: October
2025</em> <em>Technologies: Apache Kafka, PostgreSQL, MinIO (S3), Java,
Docker</em></p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol type="1">
<li><a href="#introduction">Introduction - What Did We Build?</a></li>
<li><a href="#big-picture">The Big Picture - High-Level
Architecture</a></li>
<li><a href="#kafka">Component 1: Apache Kafka - The Message Streaming
Platform</a></li>
<li><a href="#postgresql">Component 2: PostgreSQL - The Relational
Database</a></li>
<li><a href="#minio">Component 3: MinIO (S3) - The Blob Storage</a></li>
<li><a href="#java-app">Component 4: Java Application - The
Orchestrator</a></li>
<li><a href="#integration">How Everything Works Together</a></li>
<li><a href="#docker">Docker &amp; Containerization</a></li>
<li><a href="#data-flow">Deep Dive: Complete Data Flow</a></li>
<li><a href="#real-world">Real-World Applications</a></li>
<li><a href="#concepts">Key Concepts for Beginners</a></li>
<li><a href="#troubleshooting">Troubleshooting &amp; Common
Issues</a></li>
</ol>
<hr />
<p><a name="introduction"></a> ## 1. Introduction - What Did We
Build?</p>
<h3 id="overview">Overview</h3>
<p>You’ve just built a <strong>complete event-driven
architecture</strong> that’s used by billion-dollar companies like: -
<strong>Netflix</strong> - Video streaming and content delivery -
<strong>Instagram</strong> - Photo sharing and social media -
<strong>Dropbox</strong> - File storage and synchronization -
<strong>Spotify</strong> - Music streaming and recommendations -
<strong>Uber</strong> - Real-time ride tracking -
<strong>Airbnb</strong> - Property listings and bookings</p>
<h3 id="what-makes-this-production-grade">What Makes This
“Production-Grade”?</h3>
<ol type="1">
<li><strong>Scalable</strong> - Can handle millions of users</li>
<li><strong>Reliable</strong> - If one part fails, others keep
working</li>
<li><strong>Fast</strong> - Asynchronous processing means no
waiting</li>
<li><strong>Flexible</strong> - Easy to add new features without
breaking existing code</li>
<li><strong>Maintainable</strong> - Each component has a clear
responsibility</li>
</ol>
<h3 id="the-three-main-components">The Three Main Components</h3>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 21%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Real-World Equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Apache Kafka</strong></td>
<td>Message streaming &amp; event processing</td>
<td>Post office that delivers messages between services</td>
</tr>
<tr>
<td><strong>PostgreSQL</strong></td>
<td>Structured data storage</td>
<td>Filing cabinet with organized folders</td>
</tr>
<tr>
<td><strong>MinIO (S3)</strong></td>
<td>File/blob storage</td>
<td>Warehouse for storing physical items</td>
</tr>
</tbody>
</table>
<hr />
<p><a name="big-picture"></a> ## 2. The Big Picture - High-Level
Architecture</p>
<h3 id="visual-architecture">Visual Architecture</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                    YOUR APPLICATION                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  USER UPLOADS FILE (e.g., &quot;vacation-photo.jpg&quot;)                │
│       │                                                          │
│       ↓                                                          │
│  ┌──────────────────────────────────────────────────────┐      │
│  │  STEP 1: Java Application Receives File              │      │
│  │  (CompleteIntegrationDemo.java)                      │      │
│  └──────────────────────────────────────────────────────┘      │
│       │                                                          │
│       ↓                                                          │
│  ┌──────────────────────────────────────────────────────┐      │
│  │  STEP 2: Upload to MinIO (S3 Storage)               │      │
│  │  - S3Manager.uploadFile()                            │      │
│  │  - Stores: /uploads/user/vacation-photo.jpg          │      │
│  │  - Returns: http://localhost:9000/bucket/uploads/... │      │
│  └──────────────────────────────────────────────────────┘      │
│       │                                                          │
│       ↓                                                          │
│  ┌──────────────────────────────────────────────────────┐      │
│  │  STEP 3: Save Metadata to PostgreSQL                │      │
│  │  - FileRepository.insertFileMetadata()               │      │
│  │  - Table: files                                       │      │
│  │  - Columns: id, filename, s3_url, size, user, date  │      │
│  └──────────────────────────────────────────────────────┘      │
│       │                                                          │
│       ↓                                                          │
│  ┌──────────────────────────────────────────────────────┐      │
│  │  STEP 4: Publish Event to Kafka                     │      │
│  │  - FileEventProducer.sendUploadedEvent()             │      │
│  │  - Topic: &quot;file-events&quot;                              │      │
│  │  - Message: {eventType: &quot;UPLOADED&quot;, metadata: {...}} │      │
│  └──────────────────────────────────────────────────────┘      │
│       │                                                          │
│       ↓                                                          │
│  ┌──────────────────────────────────────────────────────┐      │
│  │  STEP 5: Kafka Consumer Processes Event             │      │
│  │  - FileEventConsumer.start()                         │      │
│  │  - Triggers:                                          │      │
│  │    • Generate thumbnails                             │      │
│  │    • Scan for viruses                                │      │
│  │    • Send notifications                              │      │
│  │    • Update search index                             │      │
│  └──────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘</code></pre>
<h3 id="why-this-architecture">Why This Architecture?</h3>
<p><strong>Traditional Approach (Old Way):</strong></p>
<pre><code>User uploads file → Process EVERYTHING (thumbnails, scan, notify) → Response
                          (User waits 30 seconds!)</code></pre>
<p><strong>Event-Driven Approach (Modern Way):</strong></p>
<pre><code>User uploads file → Store file → Quick response (1 second!)
                         ↓
                    Background processing happens asynchronously</code></pre>
<p>The user gets immediate feedback, and heavy processing happens in the
background!</p>
<hr />
<p><a name="kafka"></a> ## 3. Component 1: Apache Kafka - The Message
Streaming Platform</p>
<h3 id="what-is-kafka">What is Kafka?</h3>
<p><strong>Simple Analogy</strong>: Think of Kafka as a
<strong>super-efficient post office</strong> that: - Never loses mail
(messages) - Delivers to multiple people (consumers) simultaneously -
Keeps a record of all deliveries - Can handle millions of letters per
second</p>
<h3 id="why-do-we-need-kafka">Why Do We Need Kafka?</h3>
<p><strong>Problem Without Kafka:</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Direct function calls - tightly coupled</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">uploadFile</span><span class="op">(</span>file<span class="op">);</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">generateThumbnail</span><span class="op">(</span>file<span class="op">);</span>  <span class="co">// If this fails, everything stops!</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scanVirus</span><span class="op">(</span>file<span class="op">);</span>          <span class="co">// User waits for all of this</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sendNotification</span><span class="op">(</span>file<span class="op">);</span>   <span class="co">// Too slow!</span></span></code></pre></div>
<p><strong>Solution With Kafka:</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Loosely coupled through events</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">uploadFile</span><span class="op">(</span>file<span class="op">);</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>kafka<span class="op">.</span><span class="fu">publish</span><span class="op">(</span><span class="st">&quot;file-uploaded&quot;</span><span class="op">,</span> fileInfo<span class="op">);</span>  <span class="co">// Fire and forget!</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">// User gets immediate response</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Meanwhile, in the background:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">// - Thumbnail service listens for &quot;file-uploaded&quot; events</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">// - Virus scanner listens for &quot;file-uploaded&quot; events</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">// - Notification service listens for &quot;file-uploaded&quot; events</span></span></code></pre></div>
<h3 id="kafka-architecture">Kafka Architecture</h3>
<pre><code>┌─────────────────────────────────────────────────────┐
│              KAFKA CLUSTER                          │
├─────────────────────────────────────────────────────┤
│                                                      │
│  TOPICS (Categories of Messages)                    │
│  ┌──────────────────────────────────────┐          │
│  │ Topic: &quot;file-events&quot;                 │          │
│  │ Partitions: 3 (for parallel processing)│        │
│  │ Replication: 1 (copies for backup)   │          │
│  └──────────────────────────────────────┘          │
│                                                      │
│  PRODUCERS (Send Messages)                          │
│  • FileEventProducer                                │
│  • Sends: File uploaded, File deleted events        │
│                                                      │
│  CONSUMERS (Receive Messages)                       │
│  • FileEventConsumer (Group: &quot;file-processors&quot;)    │
│  • ThumbnailGenerator (Group: &quot;thumbnail-gen&quot;)     │
│  • VirusScanner (Group: &quot;virus-scanners&quot;)          │
│                                                      │
│  ZOOKEEPER (Manages Kafka)                          │
│  • Tracks which consumers are active                │
│  • Manages partition assignments                    │
│  • Monitors broker health                           │
│                                                      │
└─────────────────────────────────────────────────────┘</code></pre>
<h3 id="key-kafka-concepts">Key Kafka Concepts</h3>
<h4 id="topics">1. <strong>Topics</strong></h4>
<ul>
<li><strong>What</strong>: A category or feed name to which messages are
published</li>
<li><strong>Example</strong>: “file-events”, “user-signups”,
“payment-transactions”</li>
<li><strong>Real-World</strong>: Like departments in a company (HR,
Finance, Engineering)</li>
</ul>
<h4 id="partitions">2. <strong>Partitions</strong></h4>
<ul>
<li><strong>What</strong>: Sub-divisions of topics for parallel
processing</li>
<li><strong>Example</strong>: Topic “file-events” has 3 partitions
<ul>
<li>Partition 0: Handles files from users A-H</li>
<li>Partition 1: Handles files from users I-P</li>
<li>Partition 2: Handles files from users Q-Z</li>
</ul></li>
<li><strong>Benefit</strong>: 3 consumers can process simultaneously =
3x faster!</li>
</ul>
<h4 id="producers">3. <strong>Producers</strong></h4>
<ul>
<li><strong>What</strong>: Applications that send messages to Kafka
topics</li>
<li><strong>Our Code</strong>: <code>FileEventProducer.java</code></li>
<li><strong>Example</strong>:</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// FileEventProducer.java:72</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">sendUploadedEvent</span><span class="op">(</span>FileMetadata metadata<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    FileEvent event <span class="op">=</span> <span class="kw">new</span> <span class="fu">FileEvent</span><span class="op">(</span><span class="st">&quot;UPLOADED&quot;</span><span class="op">,</span> metadata<span class="op">);</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> jsonMessage <span class="op">=</span> objectMapper<span class="op">.</span><span class="fu">writeValueAsString</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    ProducerRecord<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;</span> <span class="kw">record</span> <span class="op">=</span> <span class="kw">new</span> ProducerRecord<span class="op">&lt;&gt;(</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        topicName<span class="op">,</span>           <span class="co">// &quot;file-events&quot;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        metadata<span class="op">.</span><span class="fu">getId</span><span class="op">(),</span>    <span class="co">// Partition key (keeps same user&#39;s events in order)</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        jsonMessage          <span class="co">// The actual message</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    producer<span class="op">.</span><span class="fu">send</span><span class="op">(</span><span class="kw">record</span><span class="op">);</span>  <span class="co">// Send to Kafka</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="consumers">4. <strong>Consumers</strong></h4>
<ul>
<li><strong>What</strong>: Applications that read messages from Kafka
topics</li>
<li><strong>Our Code</strong>: <code>FileEventConsumer.java</code></li>
<li><strong>Example</strong>:</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// FileEventConsumer.java:87</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>consumer<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span><span class="bu">Collections</span><span class="op">.</span><span class="fu">singletonList</span><span class="op">(</span>topicName<span class="op">));</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>running<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    ConsumerRecords<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;</span> records <span class="op">=</span> consumer<span class="op">.</span><span class="fu">poll</span><span class="op">(</span><span class="bu">Duration</span><span class="op">.</span><span class="fu">ofMillis</span><span class="op">(</span><span class="dv">100</span><span class="op">));</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>ConsumerRecord<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;</span> <span class="kw">record</span> <span class="op">:</span> records<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        FileEvent event <span class="op">=</span> objectMapper<span class="op">.</span><span class="fu">readValue</span><span class="op">(</span><span class="kw">record</span><span class="op">.</span><span class="fu">value</span><span class="op">(),</span> FileEvent<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Process the event</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        eventHandler<span class="op">.</span><span class="fu">accept</span><span class="op">(</span>event<span class="op">);</span>  <span class="co">// Your custom processing logic</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="consumer-groups">5. <strong>Consumer Groups</strong></h4>
<ul>
<li><strong>What</strong>: Multiple consumers working together to
process messages</li>
<li><strong>Example</strong>:
<ul>
<li>Group “thumbnail-generators”: 5 consumers generate thumbnails in
parallel</li>
<li>Group “virus-scanners”: 3 consumers scan files in parallel</li>
<li>Group “notification-senders”: 2 consumers send emails in
parallel</li>
</ul></li>
<li><strong>Benefit</strong>: Each group processes ALL messages
independently</li>
</ul>
<pre><code>Message: &quot;File uploaded: photo.jpg&quot;
    ↓
    ├──→ Consumer Group &quot;thumbnail-generators&quot; (5 consumers)
    │    All 5 share the work, each processes different files
    │
    ├──→ Consumer Group &quot;virus-scanners&quot; (3 consumers)
    │    All 3 share the work, each scans different files
    │
    └──→ Consumer Group &quot;notification-senders&quot; (2 consumers)
         Both process the SAME message independently</code></pre>
<h3 id="kafka-configuration-in-our-project">Kafka Configuration in Our
Project</h3>
<p><strong>File</strong>: <code>docker-compose.yml:21-51</code></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kafka</span><span class="kw">:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">image</span><span class="kw">:</span><span class="at"> confluentinc/cp-kafka:7.5.0</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;9092:9092&quot;</span><span class="co">      # External access port</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;29092:29092&quot;</span><span class="co">    # Internal (Docker) access port</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">KAFKA_BROKER_ID</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">KAFKA_ZOOKEEPER_CONNECT</span><span class="kw">:</span><span class="at"> zookeeper:2181</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">KAFKA_ADVERTISED_LISTENERS</span><span class="kw">:</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="at">      PLAINTEXT://kafka:29092,</span><span class="co">           # For Docker containers</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="at">      PLAINTEXT_HOST://localhost:9092</span><span class="co">    # For your Java app</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">KAFKA_AUTO_CREATE_TOPICS_ENABLE</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;true&#39;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">KAFKA_NUM_PARTITIONS</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span><span class="co">              # Default partitions per topic</span></span></code></pre></div>
<h3 id="how-kafka-guarantees-reliability">How Kafka Guarantees
Reliability</h3>
<ol type="1">
<li><strong>Durability</strong>: Messages are written to disk, not just
memory</li>
<li><strong>Replication</strong>: Messages are copied to multiple
brokers</li>
<li><strong>Acknowledgments</strong>: Producer waits for
confirmation</li>
<li><strong>Offset Tracking</strong>: Consumers remember where they left
off</li>
<li><strong>Retry Logic</strong>: Failed sends are automatically
retried</li>
</ol>
<h3 id="kafka-in-our-code">Kafka in Our Code</h3>
<p><strong>Producer Configuration</strong>
(<code>FileEventProducer.java:51</code>):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Properties</span> props <span class="op">=</span> <span class="kw">new</span> <span class="bu">Properties</span><span class="op">();</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ProducerConfig<span class="op">.</span><span class="fu">BOOTSTRAP_SERVERS_CONFIG</span><span class="op">,</span> bootstrapServers<span class="op">);</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ProducerConfig<span class="op">.</span><span class="fu">KEY_SERIALIZER_CLASS_CONFIG</span><span class="op">,</span> StringSerializer<span class="op">.</span><span class="fu">class</span><span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ProducerConfig<span class="op">.</span><span class="fu">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="op">,</span> StringSerializer<span class="op">.</span><span class="fu">class</span><span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ProducerConfig<span class="op">.</span><span class="fu">ACKS_CONFIG</span><span class="op">,</span> <span class="st">&quot;all&quot;</span><span class="op">);</span>  <span class="co">// Wait for all replicas</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ProducerConfig<span class="op">.</span><span class="fu">RETRIES_CONFIG</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span>   <span class="co">// Retry 3 times</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ProducerConfig<span class="op">.</span><span class="fu">ENABLE_IDEMPOTENCE_CONFIG</span><span class="op">,</span> <span class="st">&quot;true&quot;</span><span class="op">);</span>  <span class="co">// Prevent duplicates</span></span></code></pre></div>
<p><strong>Consumer Configuration</strong>
(<code>FileEventConsumer.java:58</code>):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Properties</span> props <span class="op">=</span> <span class="kw">new</span> <span class="bu">Properties</span><span class="op">();</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ConsumerConfig<span class="op">.</span><span class="fu">BOOTSTRAP_SERVERS_CONFIG</span><span class="op">,</span> bootstrapServers<span class="op">);</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ConsumerConfig<span class="op">.</span><span class="fu">GROUP_ID_CONFIG</span><span class="op">,</span> groupId<span class="op">);</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ConsumerConfig<span class="op">.</span><span class="fu">KEY_DESERIALIZER_CLASS_CONFIG</span><span class="op">,</span> StringDeserializer<span class="op">.</span><span class="fu">class</span><span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ConsumerConfig<span class="op">.</span><span class="fu">VALUE_DESERIALIZER_CLASS_CONFIG</span><span class="op">,</span> StringDeserializer<span class="op">.</span><span class="fu">class</span><span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ConsumerConfig<span class="op">.</span><span class="fu">AUTO_OFFSET_RESET_CONFIG</span><span class="op">,</span> <span class="st">&quot;earliest&quot;</span><span class="op">);</span>  <span class="co">// Read from beginning</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ConsumerConfig<span class="op">.</span><span class="fu">ENABLE_AUTO_COMMIT_CONFIG</span><span class="op">,</span> <span class="st">&quot;true&quot;</span><span class="op">);</span>     <span class="co">// Auto-save progress</span></span></code></pre></div>
<hr />
<p><a name="postgresql"></a> ## 4. Component 2: PostgreSQL - The
Relational Database</p>
<h3 id="what-is-postgresql">What is PostgreSQL?</h3>
<p><strong>Simple Analogy</strong>: Think of PostgreSQL as a
<strong>highly organized filing cabinet</strong> where: - Each drawer is
a <strong>table</strong> - Each file is a <strong>row</strong> - Each
label on the file is a <strong>column</strong> - The filing system
ensures everything is organized and easy to find</p>
<h3 id="why-do-we-need-a-database">Why Do We Need a Database?</h3>
<p><strong>What We Store in PostgreSQL:</strong> -
<strong>Metadata</strong>: Information ABOUT files (not the files
themselves) - <strong>Structured Data</strong>: Data with clear
relationships - <strong>Searchable Information</strong>: Things you need
to query quickly</p>
<p><strong>What We DON’T Store in PostgreSQL:</strong> - Large files
(photos, videos, documents) → Goes to S3/MinIO - Temporary data → Goes
to Redis/Memcached - Real-time events → Goes to Kafka</p>
<h3 id="database-schema">Database Schema</h3>
<p><strong>File</strong>: <code>init-db.sql:6-18</code></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Table to store file metadata</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> files (</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,              <span class="co">-- Unique identifier (UUID)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    filename <span class="dt">VARCHAR</span>(<span class="dv">500</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,           <span class="co">-- Original filename</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    s3_key <span class="dt">VARCHAR</span>(<span class="dv">1000</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,            <span class="co">-- Path in S3 bucket</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    s3_url TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>,                     <span class="co">-- Full URL to access file</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    file_size BIGINT <span class="kw">NOT</span> <span class="kw">NULL</span>,                <span class="co">-- Size in bytes</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    content_type <span class="dt">VARCHAR</span>(<span class="dv">255</span>),                <span class="co">-- MIME type (image/jpeg, video/mp4)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    uploaded_by <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,        <span class="co">-- Username of uploader</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    uploaded_at BIGINT <span class="kw">NOT</span> <span class="kw">NULL</span>,              <span class="co">-- Unix timestamp</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> <span class="fu">CURRENT_TIMESTAMP</span>,  <span class="co">-- Auto-populated</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> <span class="fu">CURRENT_TIMESTAMP</span>   <span class="co">-- Auto-updated</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>);</span></code></pre></div>
<p><strong>What Each Column Means:</strong></p>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 18%" />
<col style="width: 28%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>VARCHAR(255)</td>
<td>Unique identifier</td>
<td>“a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6”</td>
</tr>
<tr>
<td><code>filename</code></td>
<td>VARCHAR(500)</td>
<td>Original name</td>
<td>“vacation-photo.jpg”</td>
</tr>
<tr>
<td><code>s3_key</code></td>
<td>VARCHAR(1000)</td>
<td>S3 storage path</td>
<td>“uploads/alice/vacation-photo.jpg”</td>
</tr>
<tr>
<td><code>s3_url</code></td>
<td>TEXT</td>
<td>Complete URL</td>
<td>“http://localhost:9000/bucket/uploads/alice/vacation-photo.jpg”</td>
</tr>
<tr>
<td><code>file_size</code></td>
<td>BIGINT</td>
<td>Size in bytes</td>
<td>2621440 (2.5 MB)</td>
</tr>
<tr>
<td><code>content_type</code></td>
<td>VARCHAR(255)</td>
<td>File type</td>
<td>“image/jpeg”</td>
</tr>
<tr>
<td><code>uploaded_by</code></td>
<td>VARCHAR(255)</td>
<td>User</td>
<td>“alice”</td>
</tr>
<tr>
<td><code>uploaded_at</code></td>
<td>BIGINT</td>
<td>Unix timestamp</td>
<td>1729090624308</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>Row creation time</td>
<td>“2025-10-16 16:37:04”</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>TIMESTAMP</td>
<td>Last update time</td>
<td>“2025-10-16 16:37:04”</td>
</tr>
</tbody>
</table>
<h3 id="database-indexes">Database Indexes</h3>
<p><strong>File</strong>: <code>init-db.sql:21-24</code></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Indexes for faster queries</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> idx_files_uploaded_by <span class="kw">ON</span> files(uploaded_by);</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> idx_files_created_at <span class="kw">ON</span> files(created_at <span class="kw">DESC</span>);</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> idx_files_content_type <span class="kw">ON</span> files(content_type);</span></code></pre></div>
<p><strong>Why Indexes?</strong></p>
<p>Without Index:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> files <span class="kw">WHERE</span> uploaded_by <span class="op">=</span> <span class="st">&#39;alice&#39;</span>;</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- Database scans ALL 1,000,000 rows → Takes 5 seconds!</span></span></code></pre></div>
<p>With Index:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> files <span class="kw">WHERE</span> uploaded_by <span class="op">=</span> <span class="st">&#39;alice&#39;</span>;</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- Database uses index → Finds 10 rows instantly → Takes 0.01 seconds!</span></span></code></pre></div>
<p><strong>Analogy</strong>: Like the index at the back of a textbook -
instead of reading every page, you jump directly to the relevant
page!</p>
<h3 id="connection-pooling-with-hikaricp">Connection Pooling with
HikariCP</h3>
<p><strong>What is Connection Pooling?</strong></p>
<p><strong>Without Pooling</strong> (Slow):</p>
<pre><code>Request 1: Create DB connection → Use it → Close it
Request 2: Create DB connection → Use it → Close it
Request 3: Create DB connection → Use it → Close it
(Each connection creation takes 100ms!)</code></pre>
<p><strong>With Pooling</strong> (Fast):</p>
<pre><code>Startup: Create 10 connections in advance (1 second total)
Request 1: Borrow connection 1 → Use it → Return it
Request 2: Borrow connection 2 → Use it → Return it
Request 3: Borrow connection 1 → Use it → Return it
(Each request takes 0.1ms!)</code></pre>
<p><strong>Our Configuration</strong>
(<code>DatabaseManager.java:30-50</code>):</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>HikariConfig config <span class="op">=</span> <span class="kw">new</span> <span class="fu">HikariConfig</span><span class="op">();</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">setJdbcUrl</span><span class="op">(</span><span class="st">&quot;jdbc:postgresql://localhost:5432/mydb&quot;</span><span class="op">);</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">setUsername</span><span class="op">(</span><span class="st">&quot;admin&quot;</span><span class="op">);</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">setPassword</span><span class="op">(</span><span class="st">&quot;admin123&quot;</span><span class="op">);</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Pool settings</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">setMaximumPoolSize</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span>        <span class="co">// Max 10 connections</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">setMinimumIdle</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span>             <span class="co">// Always keep 2 ready</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">setConnectionTimeout</span><span class="op">(</span><span class="dv">30000</span><span class="op">);</span>    <span class="co">// Wait max 30s for connection</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">setIdleTimeout</span><span class="op">(</span><span class="dv">600000</span><span class="op">);</span>         <span class="co">// Close idle connections after 10 min</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">setMaxLifetime</span><span class="op">(</span><span class="dv">1800000</span><span class="op">);</span>        <span class="co">// Renew connections every 30 min</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance optimizations</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">addDataSourceProperty</span><span class="op">(</span><span class="st">&quot;cachePrepStmts&quot;</span><span class="op">,</span> <span class="st">&quot;true&quot;</span><span class="op">);</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">addDataSourceProperty</span><span class="op">(</span><span class="st">&quot;prepStmtCacheSize&quot;</span><span class="op">,</span> <span class="st">&quot;250&quot;</span><span class="op">);</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">addDataSourceProperty</span><span class="op">(</span><span class="st">&quot;prepStmtCacheSqlLimit&quot;</span><span class="op">,</span> <span class="st">&quot;2048&quot;</span><span class="op">);</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>dataSource <span class="op">=</span> <span class="kw">new</span> <span class="fu">HikariDataSource</span><span class="op">(</span>config<span class="op">);</span></span></code></pre></div>
<h3 id="crud-operations">CRUD Operations</h3>
<p><strong>File Repository</strong>
(<code>FileRepository.java</code>)</p>
<h4 id="create-insert">Create (Insert)</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">// FileRepository.java:48-76</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">insertFileMetadata</span><span class="op">(</span>FileMetadata metadata<span class="op">)</span> <span class="kw">throws</span> <span class="bu">SQLException</span> <span class="op">{</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> sql <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="st">        INSERT INTO files (id, filename, s3_key, s3_url, file_size,</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="st">                          content_type, uploaded_by, uploaded_at)</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="st">        VALUES (?, ?, ?, ?, ?, ?, ?, ?)</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span><span class="op">;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">(</span><span class="bu">Connection</span> conn <span class="op">=</span> databaseManager<span class="op">.</span><span class="fu">getConnection</span><span class="op">();</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>         <span class="bu">PreparedStatement</span> stmt <span class="op">=</span> conn<span class="op">.</span><span class="fu">prepareStatement</span><span class="op">(</span>sql<span class="op">))</span> <span class="op">{</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getId</span><span class="op">());</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getFilename</span><span class="op">());</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">3</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getS3Key</span><span class="op">());</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getS3Url</span><span class="op">());</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setLong</span><span class="op">(</span><span class="dv">5</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getFileSize</span><span class="op">());</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">6</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getContentType</span><span class="op">());</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">7</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getUploadedBy</span><span class="op">());</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setLong</span><span class="op">(</span><span class="dv">8</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getUploadedAt</span><span class="op">());</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">executeUpdate</span><span class="op">();</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;Inserted file metadata: {}&quot;</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getFilename</span><span class="op">());</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="read-query">Read (Query)</h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">// FileRepository.java:83-108</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> FileMetadata <span class="fu">getFileById</span><span class="op">(</span><span class="bu">String</span> id<span class="op">)</span> <span class="kw">throws</span> <span class="bu">SQLException</span> <span class="op">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> sql <span class="op">=</span> <span class="st">&quot;SELECT * FROM files WHERE id = ?&quot;</span><span class="op">;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">(</span><span class="bu">Connection</span> conn <span class="op">=</span> databaseManager<span class="op">.</span><span class="fu">getConnection</span><span class="op">();</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>         <span class="bu">PreparedStatement</span> stmt <span class="op">=</span> conn<span class="op">.</span><span class="fu">prepareStatement</span><span class="op">(</span>sql<span class="op">))</span> <span class="op">{</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> id<span class="op">);</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">ResultSet</span> rs <span class="op">=</span> stmt<span class="op">.</span><span class="fu">executeQuery</span><span class="op">();</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>rs<span class="op">.</span><span class="fu">next</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">new</span> <span class="fu">FileMetadata</span><span class="op">(</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                rs<span class="op">.</span><span class="fu">getString</span><span class="op">(</span><span class="st">&quot;id&quot;</span><span class="op">),</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>                rs<span class="op">.</span><span class="fu">getString</span><span class="op">(</span><span class="st">&quot;filename&quot;</span><span class="op">),</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                rs<span class="op">.</span><span class="fu">getString</span><span class="op">(</span><span class="st">&quot;s3_key&quot;</span><span class="op">),</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>                rs<span class="op">.</span><span class="fu">getString</span><span class="op">(</span><span class="st">&quot;s3_url&quot;</span><span class="op">),</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                rs<span class="op">.</span><span class="fu">getLong</span><span class="op">(</span><span class="st">&quot;file_size&quot;</span><span class="op">),</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                rs<span class="op">.</span><span class="fu">getString</span><span class="op">(</span><span class="st">&quot;content_type&quot;</span><span class="op">),</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                rs<span class="op">.</span><span class="fu">getString</span><span class="op">(</span><span class="st">&quot;uploaded_by&quot;</span><span class="op">),</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                rs<span class="op">.</span><span class="fu">getLong</span><span class="op">(</span><span class="st">&quot;uploaded_at&quot;</span><span class="op">)</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">);</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="update">Update</h4>
<div class="sourceCode" id="cb22"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// FileRepository.java:115-132</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">updateFileMetadata</span><span class="op">(</span><span class="bu">String</span> id<span class="op">,</span> FileMetadata metadata<span class="op">)</span> <span class="kw">throws</span> <span class="bu">SQLException</span> <span class="op">{</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> sql <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="st">        UPDATE files</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="st">        SET filename = ?, s3_key = ?, s3_url = ?, file_size = ?,</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="st">            content_type = ?, updated_at = CURRENT_TIMESTAMP</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="st">        WHERE id = ?</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span><span class="op">;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">(</span><span class="bu">Connection</span> conn <span class="op">=</span> databaseManager<span class="op">.</span><span class="fu">getConnection</span><span class="op">();</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>         <span class="bu">PreparedStatement</span> stmt <span class="op">=</span> conn<span class="op">.</span><span class="fu">prepareStatement</span><span class="op">(</span>sql<span class="op">))</span> <span class="op">{</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getFilename</span><span class="op">());</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getS3Key</span><span class="op">());</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">3</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getS3Url</span><span class="op">());</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setLong</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getFileSize</span><span class="op">());</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">5</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getContentType</span><span class="op">());</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">6</span><span class="op">,</span> id<span class="op">);</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">executeUpdate</span><span class="op">();</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="delete">Delete</h4>
<div class="sourceCode" id="cb23"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// FileRepository.java:139-153</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">deleteFileMetadata</span><span class="op">(</span><span class="bu">String</span> id<span class="op">)</span> <span class="kw">throws</span> <span class="bu">SQLException</span> <span class="op">{</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> sql <span class="op">=</span> <span class="st">&quot;DELETE FROM files WHERE id = ?&quot;</span><span class="op">;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">(</span><span class="bu">Connection</span> conn <span class="op">=</span> databaseManager<span class="op">.</span><span class="fu">getConnection</span><span class="op">();</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>         <span class="bu">PreparedStatement</span> stmt <span class="op">=</span> conn<span class="op">.</span><span class="fu">prepareStatement</span><span class="op">(</span>sql<span class="op">))</span> <span class="op">{</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> id<span class="op">);</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> rowsAffected <span class="op">=</span> stmt<span class="op">.</span><span class="fu">executeUpdate</span><span class="op">();</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>rowsAffected <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;Deleted file metadata: {}&quot;</span><span class="op">,</span> id<span class="op">);</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="transactions">Transactions</h3>
<p><strong>What is a Transaction?</strong></p>
<p>A transaction ensures that <strong>all operations succeed together,
or all fail together</strong>.</p>
<p><strong>Example Without Transaction:</strong></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BAD: If step 2 fails, step 1 is already done!</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">updateUserBalance</span><span class="op">(</span>userId<span class="op">,</span> <span class="op">-</span><span class="dv">100</span><span class="op">);</span>    <span class="co">// Deduct $100</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">updateMerchantBalance</span><span class="op">(</span>merchantId<span class="op">,</span> <span class="op">+</span><span class="dv">100</span><span class="op">);</span>  <span class="co">// This fails!</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">// User lost $100, merchant didn&#39;t get it! 💸</span></span></code></pre></div>
<p><strong>Example With Transaction:</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Both succeed or both fail</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">(</span><span class="bu">Connection</span> conn <span class="op">=</span> dataSource<span class="op">.</span><span class="fu">getConnection</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    conn<span class="op">.</span><span class="fu">setAutoCommit</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span>  <span class="co">// Start transaction</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateUserBalance</span><span class="op">(</span>conn<span class="op">,</span> userId<span class="op">,</span> <span class="op">-</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateMerchantBalance</span><span class="op">(</span>conn<span class="op">,</span> merchantId<span class="op">,</span> <span class="op">+</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    conn<span class="op">.</span><span class="fu">commit</span><span class="op">();</span>  <span class="co">// Both succeeded! ✅</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    conn<span class="op">.</span><span class="fu">rollback</span><span class="op">();</span>  <span class="co">// Undo everything! ↩️</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="postgresql-configuration">PostgreSQL Configuration</h3>
<p><strong>File</strong>: <code>docker-compose.yml:89-104</code></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postgres</span><span class="kw">:</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres:16-alpine</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> postgres-db</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">POSTGRES_USER</span><span class="kw">:</span><span class="at"> admin</span><span class="co">           # Username</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">POSTGRES_PASSWORD</span><span class="kw">:</span><span class="at"> admin123</span><span class="co">    # Password</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">POSTGRES_DB</span><span class="kw">:</span><span class="at"> mydb</span><span class="co">              # Database name</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;5432:5432&quot;</span><span class="co">                  # Port mapping</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> postgres-data:/var/lib/postgresql/data</span><span class="co">  # Persistent storage</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">healthcheck</span><span class="kw">:</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;CMD-SHELL&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;pg_isready -U admin -d mydb&quot;</span><span class="kw">]</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> 10s</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> 5s</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">retries</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span></code></pre></div>
<h3 id="common-sql-queries">Common SQL Queries</h3>
<p><strong>Query 1: Get all files uploaded by a user</strong></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> files</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> uploaded_by <span class="op">=</span> <span class="st">&#39;alice&#39;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> created_at <span class="kw">DESC</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
<p><strong>Query 2: Get total storage used by user</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> uploaded_by, <span class="fu">SUM</span>(file_size) <span class="kw">as</span> total_bytes</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> files</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> uploaded_by;</span></code></pre></div>
<p><strong>Query 3: Find large files</strong></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> filename, file_size, uploaded_by</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> files</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> file_size <span class="op">&gt;</span> <span class="dv">10485760</span>  <span class="co">-- 10 MB</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> file_size <span class="kw">DESC</span>;</span></code></pre></div>
<p><strong>Query 4: Get file statistics by type</strong></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    content_type,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">as</span> file_count,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(file_size) <span class="kw">as</span> total_size,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">AVG</span>(file_size) <span class="kw">as</span> avg_size</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> files</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> content_type;</span></code></pre></div>
<hr />
<p><a name="minio"></a> ## 5. Component 3: MinIO (S3) - The Blob
Storage</p>
<h3 id="what-is-minio">What is MinIO?</h3>
<p><strong>Simple Analogy</strong>: Think of MinIO as a <strong>massive
warehouse</strong> where: - Each item (file) has a unique barcode (S3
key) - Items are organized in sections (buckets) - You can retrieve any
item instantly using its barcode - The warehouse is virtually unlimited
in size</p>
<p><strong>MinIO vs AWS S3:</strong> - <strong>AWS S3</strong>: Cloud
storage service by Amazon - <strong>MinIO</strong>: Open-source,
self-hosted, S3-compatible storage - <strong>API</strong>: MinIO uses
the EXACT same API as AWS S3 - <strong>Benefit</strong>: Develop locally
with MinIO, deploy to AWS S3 with zero code changes!</p>
<h3 id="why-separate-file-storage-from-database">Why Separate File
Storage from Database?</h3>
<p><strong>Storing Files in Database</strong> (Bad Idea ❌):</p>
<pre><code>Database size: 100 GB
- User data: 1 GB
- Files: 99 GB (images, videos, documents)

Problems:
❌ Slow queries (database scans huge files)
❌ Expensive (database storage costs 10x more)
❌ Backups take forever
❌ Can&#39;t scale independently</code></pre>
<p><strong>Storing Files in S3/MinIO</strong> (Good Idea ✅):</p>
<pre><code>Database: 1 GB (just metadata)
S3 Storage: 99 GB (actual files)

Benefits:
✅ Fast queries (database only scans metadata)
✅ Cheap (S3 costs 10x less than database storage)
✅ Quick backups
✅ Scales independently</code></pre>
<h3 id="s3-architecture-concepts">S3 Architecture Concepts</h3>
<h4 id="buckets">1. <strong>Buckets</strong></h4>
<ul>
<li><strong>What</strong>: Top-level containers for storing objects</li>
<li><strong>Example</strong>: “user-uploads”, “profile-pictures”,
“video-content”</li>
<li><strong>Analogy</strong>: Like a hard drive or USB stick</li>
<li><strong>Our Bucket</strong>: “complete-integration-bucket”</li>
</ul>
<h4 id="objects-files">2. <strong>Objects (Files)</strong></h4>
<ul>
<li><strong>What</strong>: The actual files you store</li>
<li><strong>Components</strong>:
<ul>
<li><strong>Key</strong>: Unique identifier/path (e.g.,
“uploads/alice/photo.jpg”)</li>
<li><strong>Data</strong>: The file content</li>
<li><strong>Metadata</strong>: Additional info (content-type, size,
etc.)</li>
</ul></li>
</ul>
<h4 id="keys-file-paths">3. <strong>Keys (File Paths)</strong></h4>
<ul>
<li><strong>What</strong>: The “address” of an object in a bucket</li>
<li><strong>Format</strong>: Like a file system path</li>
<li><strong>Examples</strong>:
<ul>
<li><code>uploads/alice/vacation-photo.jpg</code></li>
<li><code>documents/2025/report.pdf</code></li>
<li><code>videos/tutorial-01.mp4</code></li>
</ul></li>
</ul>
<h4 id="urls">4. <strong>URLs</strong></h4>
<ul>
<li><strong>What</strong>: Web address to access the file</li>
<li><strong>Format</strong>:
<code>http://endpoint/bucket-name/key</code></li>
<li><strong>Example</strong>:
<code>http://localhost:9000/complete-integration-bucket/uploads/alice/photo.jpg</code></li>
</ul>
<h3 id="minio-configuration">MinIO Configuration</h3>
<p><strong>File</strong>: <code>docker-compose.yml:120-136</code></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">minio</span><span class="kw">:</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">image</span><span class="kw">:</span><span class="at"> minio/minio:latest</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> minio-s3</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">command</span><span class="kw">:</span><span class="at"> server /data --console-address &quot;:9001&quot;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">MINIO_ROOT_USER</span><span class="kw">:</span><span class="at"> minioadmin</span><span class="co">        # Access key</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">MINIO_ROOT_PASSWORD</span><span class="kw">:</span><span class="at"> minioadmin123</span><span class="co">  # Secret key</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;9000:9000&quot;</span><span class="co">      # API port (S3 operations)</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;9001:9001&quot;</span><span class="co">      # Web console port</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> minio-data:/data</span><span class="co">  # Persistent storage</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">healthcheck</span><span class="kw">:</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;CMD&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;curl&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;-f&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;http://localhost:9000/minio/health/live&quot;</span><span class="kw">]</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> 10s</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> 5s</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">retries</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span></code></pre></div>
<h3 id="s3manager---java-implementation">S3Manager - Java
Implementation</h3>
<p><strong>File</strong>: <code>S3Manager.java</code></p>
<h4 id="initialization">Initialization</h4>
<div class="sourceCode" id="cb34"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">// S3Manager.java:33-55</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="fu">S3Manager</span><span class="op">(</span><span class="bu">String</span> endpoint<span class="op">,</span> <span class="bu">String</span> accessKey<span class="op">,</span> <span class="bu">String</span> secretKey<span class="op">)</span> <span class="op">{</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Configure AWS SDK for MinIO</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    AwsBasicCredentials credentials <span class="op">=</span> AwsBasicCredentials<span class="op">.</span><span class="fu">create</span><span class="op">(</span>accessKey<span class="op">,</span> secretKey<span class="op">);</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">s3Client</span> <span class="op">=</span> S3Client<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">endpointOverride</span><span class="op">(</span><span class="bu">URI</span><span class="op">.</span><span class="fu">create</span><span class="op">(</span>endpoint<span class="op">))</span>  <span class="co">// Point to MinIO instead of AWS</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">region</span><span class="op">(</span><span class="bu">Region</span><span class="op">.</span><span class="fu">US_EAST_1</span><span class="op">)</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">credentialsProvider</span><span class="op">(</span>StaticCredentialsProvider<span class="op">.</span><span class="fu">create</span><span class="op">(</span>credentials<span class="op">))</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">serviceConfiguration</span><span class="op">(</span>S3Configuration<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">pathStyleAccessEnabled</span><span class="op">(</span><span class="kw">true</span><span class="op">)</span>  <span class="co">// Required for MinIO</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">())</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="create-bucket">Create Bucket</h4>
<div class="sourceCode" id="cb35"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">// S3Manager.java:62-77</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">createBucketIfNotExists</span><span class="op">(</span><span class="bu">String</span> bucketName<span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check if bucket exists</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        s3Client<span class="op">.</span><span class="fu">headBucket</span><span class="op">(</span>HeadBucketRequest<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">bucket</span><span class="op">(</span>bucketName<span class="op">)</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">());</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;Bucket {} already exists&quot;</span><span class="op">,</span> bucketName<span class="op">);</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span>NoSuchBucketException e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Bucket doesn&#39;t exist, create it</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>        s3Client<span class="op">.</span><span class="fu">createBucket</span><span class="op">(</span>CreateBucketRequest<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">bucket</span><span class="op">(</span>bucketName<span class="op">)</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">());</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;Created bucket: {}&quot;</span><span class="op">,</span> bucketName<span class="op">);</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="upload-file">Upload File</h4>
<div class="sourceCode" id="cb36"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">// S3Manager.java:90-119</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="bu">String</span> <span class="fu">uploadFile</span><span class="op">(</span><span class="bu">String</span> bucketName<span class="op">,</span> <span class="bu">String</span> key<span class="op">,</span> <span class="dt">byte</span><span class="op">[]</span> fileData<span class="op">,</span> <span class="bu">String</span> contentType<span class="op">)</span> <span class="op">{</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Upload file to S3</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        PutObjectRequest request <span class="op">=</span> PutObjectRequest<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">bucket</span><span class="op">(</span>bucketName<span class="op">)</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">key</span><span class="op">(</span>key<span class="op">)</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">contentType</span><span class="op">(</span>contentType<span class="op">)</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">contentLength</span><span class="op">((</span><span class="dt">long</span><span class="op">)</span> fileData<span class="op">.</span><span class="fu">length</span><span class="op">)</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        s3Client<span class="op">.</span><span class="fu">putObject</span><span class="op">(</span>request<span class="op">,</span> RequestBody<span class="op">.</span><span class="fu">fromBytes</span><span class="op">(</span>fileData<span class="op">));</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Generate URL</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> url <span class="op">=</span> <span class="bu">String</span><span class="op">.</span><span class="fu">format</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">%s</span><span class="st">/</span><span class="sc">%s</span><span class="st">/</span><span class="sc">%s</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>            s3Client<span class="op">.</span><span class="fu">serviceClientConfiguration</span><span class="op">().</span><span class="fu">endpointOverride</span><span class="op">().</span><span class="fu">get</span><span class="op">(),</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>            bucketName<span class="op">,</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>            key<span class="op">);</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;Uploaded file to S3: {} ({})&quot;</span><span class="op">,</span> key<span class="op">,</span> <span class="fu">formatFileSize</span><span class="op">(</span>fileData<span class="op">.</span><span class="fu">length</span><span class="op">));</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> url<span class="op">;</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">error</span><span class="op">(</span><span class="st">&quot;Failed to upload file to S3: {}&quot;</span><span class="op">,</span> key<span class="op">,</span> e<span class="op">);</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">&quot;S3 upload failed&quot;</span><span class="op">,</span> e<span class="op">);</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>What Happens When You Upload:</strong> 1. File is divided
into chunks (for large files) 2. Each chunk is uploaded separately 3.
MinIO reassembles chunks on the server 4. Returns a URL to access the
file 5. File is immediately available worldwide</p>
<h4 id="download-file">Download File</h4>
<div class="sourceCode" id="cb37"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">// S3Manager.java:128-147</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">byte</span><span class="op">[]</span> <span class="fu">downloadFile</span><span class="op">(</span><span class="bu">String</span> bucketName<span class="op">,</span> <span class="bu">String</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        GetObjectRequest request <span class="op">=</span> GetObjectRequest<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">bucket</span><span class="op">(</span>bucketName<span class="op">)</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">key</span><span class="op">(</span>key<span class="op">)</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        ResponseInputStream<span class="op">&lt;</span>GetObjectResponse<span class="op">&gt;</span> response <span class="op">=</span> s3Client<span class="op">.</span><span class="fu">getObject</span><span class="op">(</span>request<span class="op">);</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">byte</span><span class="op">[]</span> fileData <span class="op">=</span> response<span class="op">.</span><span class="fu">readAllBytes</span><span class="op">();</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;Downloaded file from S3: {} ({})&quot;</span><span class="op">,</span> key<span class="op">,</span> <span class="fu">formatFileSize</span><span class="op">(</span>fileData<span class="op">.</span><span class="fu">length</span><span class="op">));</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fileData<span class="op">;</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span>NoSuchKeyException e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">error</span><span class="op">(</span><span class="st">&quot;File not found in S3: {}&quot;</span><span class="op">,</span> key<span class="op">);</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">&quot;File not found&quot;</span><span class="op">,</span> e<span class="op">);</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="delete-file">Delete File</h4>
<div class="sourceCode" id="cb38"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">// S3Manager.java:154-169</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">deleteFile</span><span class="op">(</span><span class="bu">String</span> bucketName<span class="op">,</span> <span class="bu">String</span> key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        DeleteObjectRequest request <span class="op">=</span> DeleteObjectRequest<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">bucket</span><span class="op">(</span>bucketName<span class="op">)</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">key</span><span class="op">(</span>key<span class="op">)</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        s3Client<span class="op">.</span><span class="fu">deleteObject</span><span class="op">(</span>request<span class="op">);</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;Deleted file from S3: {}&quot;</span><span class="op">,</span> key<span class="op">);</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">error</span><span class="op">(</span><span class="st">&quot;Failed to delete file from S3: {}&quot;</span><span class="op">,</span> key<span class="op">,</span> e<span class="op">);</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">&quot;S3 delete failed&quot;</span><span class="op">,</span> e<span class="op">);</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="list-files">List Files</h4>
<div class="sourceCode" id="cb39"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">// S3Manager.java:176-201</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="bu">List</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> <span class="fu">listFiles</span><span class="op">(</span><span class="bu">String</span> bucketName<span class="op">,</span> <span class="bu">String</span> prefix<span class="op">)</span> <span class="op">{</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> fileKeys <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>        ListObjectsV2Request request <span class="op">=</span> ListObjectsV2Request<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">bucket</span><span class="op">(</span>bucketName<span class="op">)</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">prefix</span><span class="op">(</span>prefix<span class="op">)</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        ListObjectsV2Response response <span class="op">=</span> s3Client<span class="op">.</span><span class="fu">listObjectsV2</span><span class="op">(</span>request<span class="op">);</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span>S3Object object <span class="op">:</span> response<span class="op">.</span><span class="fu">contents</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>            fileKeys<span class="op">.</span><span class="fu">add</span><span class="op">(</span>object<span class="op">.</span><span class="fu">key</span><span class="op">());</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;Listed {} files with prefix: {}&quot;</span><span class="op">,</span> fileKeys<span class="op">.</span><span class="fu">size</span><span class="op">(),</span> prefix<span class="op">);</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fileKeys<span class="op">;</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">error</span><span class="op">(</span><span class="st">&quot;Failed to list files from S3&quot;</span><span class="op">,</span> e<span class="op">);</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">&quot;S3 list failed&quot;</span><span class="op">,</span> e<span class="op">);</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="file-organization-strategy">File Organization Strategy</h3>
<p><strong>Good File Organization:</strong></p>
<pre><code>bucket: complete-integration-bucket
├── uploads/
│   ├── alice/
│   │   ├── vacation-photo-1.jpg
│   │   ├── vacation-photo-2.jpg
│   │   └── document.pdf
│   ├── bob/
│   │   ├── profile-pic.png
│   │   └── resume.pdf
│   └── carol/
│       └── presentation.pptx
├── thumbnails/
│   ├── alice/
│   │   ├── vacation-photo-1_thumb.jpg
│   │   └── vacation-photo-2_thumb.jpg
│   └── bob/
│       └── profile-pic_thumb.png
└── processed/
    ├── alice/
    │   └── vacation-photo-1_filtered.jpg
    └── bob/
        └── profile-pic_cropped.png</code></pre>
<p><strong>Benefits:</strong> - Easy to find user’s files - Can set
permissions per folder - Simple to backup specific users - Clear
separation of file types</p>
<h3 id="s3-best-practices">S3 Best Practices</h3>
<h4 id="unique-keys">1. <strong>Unique Keys</strong></h4>
<div class="sourceCode" id="cb41"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BAD: Filename collisions</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> key <span class="op">=</span> <span class="st">&quot;uploads/&quot;</span> <span class="op">+</span> filename<span class="op">;</span>  <span class="co">// Multiple users upload &quot;photo.jpg&quot;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Use UUID or timestamp</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> key <span class="op">=</span> <span class="st">&quot;uploads/&quot;</span> <span class="op">+</span> userId <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> <span class="bu">UUID</span><span class="op">.</span><span class="fu">randomUUID</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;_&quot;</span> <span class="op">+</span> filename<span class="op">;</span></span></code></pre></div>
<h4 id="content-type">2. <strong>Content-Type</strong></h4>
<div class="sourceCode" id="cb42"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Set proper content-type for browsers to handle correctly</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> contentType <span class="op">=</span> <span class="st">&quot;image/jpeg&quot;</span><span class="op">;</span>  <span class="co">// Browser displays image</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> contentType <span class="op">=</span> <span class="st">&quot;video/mp4&quot;</span><span class="op">;</span>   <span class="co">// Browser plays video</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> contentType <span class="op">=</span> <span class="st">&quot;application/pdf&quot;</span><span class="op">;</span>  <span class="co">// Browser shows PDF</span></span></code></pre></div>
<h4 id="file-size-limits">3. <strong>File Size Limits</strong></h4>
<div class="sourceCode" id="cb43"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Check file size before upload</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> MAX_FILE_SIZE <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span><span class="op">;</span>  <span class="co">// 100 MB</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>fileData<span class="op">.</span><span class="fu">length</span> <span class="op">&gt;</span> MAX_FILE_SIZE<span class="op">)</span> <span class="op">{</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span><span class="op">(</span><span class="st">&quot;File too large!&quot;</span><span class="op">);</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="error-handling">4. <strong>Error Handling</strong></h4>
<div class="sourceCode" id="cb44"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    s3Manager<span class="op">.</span><span class="fu">uploadFile</span><span class="op">(</span>bucket<span class="op">,</span> key<span class="op">,</span> data<span class="op">,</span> contentType<span class="op">);</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span>S3Exception e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>e<span class="op">.</span><span class="fu">statusCode</span><span class="op">()</span> <span class="op">==</span> <span class="dv">403</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Permission denied</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>e<span class="op">.</span><span class="fu">statusCode</span><span class="op">()</span> <span class="op">==</span> <span class="dv">404</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Bucket not found</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>e<span class="op">.</span><span class="fu">statusCode</span><span class="op">()</span> <span class="op">==</span> <span class="dv">503</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Service unavailable, retry</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="s3-vs-database-when-to-use-what">S3 vs Database: When to Use
What?</h3>
<table>
<thead>
<tr>
<th>Data Type</th>
<th>Store In</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td>Images</td>
<td>S3</td>
<td>Large, binary, served directly to users</td>
</tr>
<tr>
<td>Videos</td>
<td>S3</td>
<td>Very large, streaming required</td>
</tr>
<tr>
<td>Documents (PDF, DOCX)</td>
<td>S3</td>
<td>Large, downloadable</td>
</tr>
<tr>
<td>User profiles</td>
<td>Database</td>
<td>Small, structured, frequently queried</td>
</tr>
<tr>
<td>Comments</td>
<td>Database</td>
<td>Small, structured, searchable</td>
</tr>
<tr>
<td>Thumbnails</td>
<td>S3</td>
<td>Images, but smaller versions</td>
</tr>
<tr>
<td>Log files</td>
<td>S3</td>
<td>Large, infrequently accessed</td>
</tr>
<tr>
<td>Session data</td>
<td>Redis/Cache</td>
<td>Temporary, needs fast access</td>
</tr>
<tr>
<td>Configurations</td>
<td>Database</td>
<td>Small, structured, version controlled</td>
</tr>
</tbody>
</table>
<hr />
<p><a name="java-app"></a> ## 6. Component 4: Java Application - The
Orchestrator</p>
<h3 id="application-architecture">Application Architecture</h3>
<pre><code>┌─────────────────────────────────────────────────────┐
│            JAVA APPLICATION LAYER                    │
├─────────────────────────────────────────────────────┤
│                                                      │
│  CONFIG LAYER                                        │
│  • KafkaConfig.java - Loads configurations          │
│  • application.properties - App settings            │
│  • kafka.properties - Kafka settings                │
│                                                      │
│  MODEL LAYER (Data Structures)                      │
│  • Message.java - Kafka message model               │
│  • FileMetadata.java - File information             │
│  • FileEvent.java - Event payload                   │
│                                                      │
│  STORAGE LAYER (S3)                                  │
│  • S3Manager.java - MinIO operations                │
│    - uploadFile(), downloadFile(), deleteFile()     │
│                                                      │
│  DATABASE LAYER (PostgreSQL)                        │
│  • DatabaseManager.java - Connection pooling        │
│  • FileRepository.java - File metadata CRUD         │
│  • MessageRepository.java - Message CRUD            │
│                                                      │
│  KAFKA LAYER (Messaging)                            │
│  • KafkaProducer.java - Send messages               │
│  • KafkaConsumer.java - Receive messages            │
│  • FileEventProducer.java - Send file events        │
│  • FileEventConsumer.java - Receive file events     │
│                                                      │
│  APPLICATION LAYER (Main Programs)                  │
│  • CompleteIntegrationDemo.java - Full demo         │
│  • S3IntegrationDemo.java - S3 demo                 │
│  • KafkaDatabaseIntegration.java - Kafka+DB demo   │
│  • DatabaseDemo.java - DB demo                      │
│  • KafkaApplication.java - Basic Kafka demo         │
│                                                      │
└─────────────────────────────────────────────────────┘</code></pre>
<h3 id="complete-integration-flow">Complete Integration Flow</h3>
<p><strong>File</strong>: <code>CompleteIntegrationDemo.java</code></p>
<h4 id="main-method">Main Method</h4>
<div class="sourceCode" id="cb46"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">// CompleteIntegrationDemo.java:56-78</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;=&quot;</span><span class="op">.</span><span class="fu">repeat</span><span class="op">(</span><span class="dv">70</span><span class="op">));</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot; COMPLETE S3 + KAFKA + DATABASE INTEGRATION DEMO&quot;</span><span class="op">);</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;=&quot;</span><span class="op">.</span><span class="fu">repeat</span><span class="op">(</span><span class="dv">70</span><span class="op">));</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    CompleteIntegrationDemo demo <span class="op">=</span> <span class="kw">new</span> <span class="fu">CompleteIntegrationDemo</span><span class="op">();</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Initialize all components</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>        demo<span class="op">.</span><span class="fu">initializeComponents</span><span class="op">();</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Start consumer in background</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        demo<span class="op">.</span><span class="fu">startConsumer</span><span class="op">();</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Upload sample files</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>        demo<span class="op">.</span><span class="fu">uploadSampleFiles</span><span class="op">();</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Wait for processing</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Thread</span><span class="op">.</span><span class="fu">sleep</span><span class="op">(</span><span class="dv">5000</span><span class="op">);</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Show statistics</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>        demo<span class="op">.</span><span class="fu">displayStatistics</span><span class="op">();</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">finally</span> <span class="op">{</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>        demo<span class="op">.</span><span class="fu">cleanup</span><span class="op">();</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="component-initialization">Component Initialization</h4>
<div class="sourceCode" id="cb47"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">// CompleteIntegrationDemo.java:85-115</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">initializeComponents</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">.</span><span class="fu">repeat</span><span class="op">(</span><span class="dv">70</span><span class="op">));</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot; INITIALIZING COMPONENTS&quot;</span><span class="op">);</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;=&quot;</span><span class="op">.</span><span class="fu">repeat</span><span class="op">(</span><span class="dv">70</span><span class="op">));</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Initialize S3 (MinIO)</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">[1/4] Initializing S3 Storage (MinIO)...&quot;</span><span class="op">);</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    s3Manager <span class="op">=</span> <span class="kw">new</span> <span class="fu">S3Manager</span><span class="op">(</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;http://localhost:9000&quot;</span><span class="op">,</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;minioadmin&quot;</span><span class="op">,</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;minioadmin123&quot;</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    s3Manager<span class="op">.</span><span class="fu">createBucketIfNotExists</span><span class="op">(</span>BUCKET_NAME<span class="op">);</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Initialize Database</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;[2/4] Initializing PostgreSQL Database...&quot;</span><span class="op">);</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>    databaseManager <span class="op">=</span> <span class="kw">new</span> <span class="fu">DatabaseManager</span><span class="op">(</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;jdbc:postgresql://localhost:5432/mydb&quot;</span><span class="op">,</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;admin&quot;</span><span class="op">,</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;admin123&quot;</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    fileRepository <span class="op">=</span> <span class="kw">new</span> <span class="fu">FileRepository</span><span class="op">(</span>databaseManager<span class="op">);</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. Initialize Kafka Producer</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;[3/4] Initializing Kafka Producer...&quot;</span><span class="op">);</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>    eventProducer <span class="op">=</span> <span class="kw">new</span> <span class="fu">FileEventProducer</span><span class="op">(</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;localhost:9092&quot;</span><span class="op">,</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;file-events&quot;</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 4. Initialize Kafka Consumer</span></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;[4/4] Initializing Kafka Consumer...&quot;</span><span class="op">);</span></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>    eventConsumer <span class="op">=</span> <span class="kw">new</span> <span class="fu">FileEventConsumer</span><span class="op">(</span></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;localhost:9092&quot;</span><span class="op">,</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;complete-integration-group&quot;</span><span class="op">,</span></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;file-events&quot;</span></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">✅ All components initialized successfully!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="file-upload-process">File Upload Process</h4>
<div class="sourceCode" id="cb48"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">// CompleteIntegrationDemo.java:156-214</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">uploadFile</span><span class="op">(</span><span class="bu">String</span> filename<span class="op">,</span> <span class="bu">String</span> contentType<span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;─&quot;</span><span class="op">.</span><span class="fu">repeat</span><span class="op">(</span><span class="dv">70</span><span class="op">));</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;📤 UPLOADING: {}&quot;</span><span class="op">,</span> filename<span class="op">);</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;─&quot;</span><span class="op">.</span><span class="fu">repeat</span><span class="op">(</span><span class="dv">70</span><span class="op">));</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// STEP 1: Create sample file data</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">byte</span><span class="op">[]</span> fileData <span class="op">=</span> <span class="op">(</span><span class="st">&quot;Sample content for &quot;</span> <span class="op">+</span> filename<span class="op">).</span><span class="fu">getBytes</span><span class="op">();</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> fileId <span class="op">=</span> <span class="bu">UUID</span><span class="op">.</span><span class="fu">randomUUID</span><span class="op">().</span><span class="fu">toString</span><span class="op">();</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> s3Key <span class="op">=</span> <span class="st">&quot;uploads/&quot;</span> <span class="op">+</span> DEMO_USER <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> filename<span class="op">;</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;  [1/4] Created file: {} ({} bytes)&quot;</span><span class="op">,</span> filename<span class="op">,</span> fileData<span class="op">.</span><span class="fu">length</span><span class="op">);</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// STEP 2: Upload to S3</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;  [2/4] Uploading to S3...&quot;</span><span class="op">);</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">String</span> s3Url <span class="op">=</span> s3Manager<span class="op">.</span><span class="fu">uploadFile</span><span class="op">(</span>BUCKET_NAME<span class="op">,</span> s3Key<span class="op">,</span> fileData<span class="op">,</span> contentType<span class="op">);</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;        ✅ S3 URL: {}&quot;</span><span class="op">,</span> s3Url<span class="op">);</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// STEP 3: Create metadata object</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>        FileMetadata metadata <span class="op">=</span> <span class="kw">new</span> <span class="fu">FileMetadata</span><span class="op">(</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>            fileId<span class="op">,</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>            filename<span class="op">,</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>            s3Key<span class="op">,</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>            s3Url<span class="op">,</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">(</span><span class="dt">long</span><span class="op">)</span> fileData<span class="op">.</span><span class="fu">length</span><span class="op">,</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>            contentType<span class="op">,</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>            DEMO_USER<span class="op">,</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>            <span class="bu">System</span><span class="op">.</span><span class="fu">currentTimeMillis</span><span class="op">()</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// STEP 4: Save metadata to database</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;  [3/4] Saving metadata to PostgreSQL...&quot;</span><span class="op">);</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>        fileRepository<span class="op">.</span><span class="fu">insertFileMetadata</span><span class="op">(</span>metadata<span class="op">);</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;        ✅ Saved to database with ID: {}&quot;</span><span class="op">,</span> fileId<span class="op">);</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">// STEP 5: Send event to Kafka</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;  [4/4] Publishing event to Kafka...&quot;</span><span class="op">);</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>        eventProducer<span class="op">.</span><span class="fu">sendUploadedEvent</span><span class="op">(</span>metadata<span class="op">);</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;        ✅ Event published to topic: file-events&quot;</span><span class="op">);</span></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">✅ File upload complete: {}&quot;</span><span class="op">,</span> filename<span class="op">);</span></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>        filesUploaded<span class="op">.</span><span class="fu">incrementAndGet</span><span class="op">();</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">error</span><span class="op">(</span><span class="st">&quot;❌ Failed to upload file: {}&quot;</span><span class="op">,</span> filename<span class="op">,</span> e<span class="op">);</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="consumer-event-handler">Consumer Event Handler</h4>
<div class="sourceCode" id="cb49"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">// CompleteIntegrationDemo.java:125-147</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">startConsumer</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">.</span><span class="fu">repeat</span><span class="op">(</span><span class="dv">70</span><span class="op">));</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot; STARTING EVENT CONSUMER&quot;</span><span class="op">);</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;=&quot;</span><span class="op">.</span><span class="fu">repeat</span><span class="op">(</span><span class="dv">70</span><span class="op">));</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Define event handler</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    Consumer<span class="op">&lt;</span>FileEvent<span class="op">&gt;</span> eventHandler <span class="op">=</span> event <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;▬&quot;</span><span class="op">.</span><span class="fu">repeat</span><span class="op">(</span><span class="dv">70</span><span class="op">));</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;📥 RECEIVED EVENT: {}&quot;</span><span class="op">,</span> event<span class="op">.</span><span class="fu">getEventType</span><span class="op">());</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;▬&quot;</span><span class="op">.</span><span class="fu">repeat</span><span class="op">(</span><span class="dv">70</span><span class="op">));</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>            FileMetadata metadata <span class="op">=</span> event<span class="op">.</span><span class="fu">getFileMetadata</span><span class="op">();</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;  • Filename: {}&quot;</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getFilename</span><span class="op">());</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;  • Size: {}&quot;</span><span class="op">,</span> <span class="fu">formatFileSize</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">getFileSize</span><span class="op">()));</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;  • User: {}&quot;</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getUploadedBy</span><span class="op">());</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;  • S3 URL: {}&quot;</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getS3Url</span><span class="op">());</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Simulate processing</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">  🔄 Processing tasks:&quot;</span><span class="op">);</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;     [1] Generating thumbnails...&quot;</span><span class="op">);</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;     [2] Scanning for viruses...&quot;</span><span class="op">);</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;     [3] Updating search index...&quot;</span><span class="op">);</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;     [4] Sending notifications...&quot;</span><span class="op">);</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Thread</span><span class="op">.</span><span class="fu">sleep</span><span class="op">(</span><span class="dv">100</span><span class="op">);</span>  <span class="co">// Simulate work</span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">  ✅ Processing complete!&quot;</span><span class="op">);</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>            eventsProcessed<span class="op">.</span><span class="fu">incrementAndGet</span><span class="op">();</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>            logger<span class="op">.</span><span class="fu">error</span><span class="op">(</span><span class="st">&quot;❌ Error processing event&quot;</span><span class="op">,</span> e<span class="op">);</span></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start consumer in background thread</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="bu">Thread</span><span class="op">(()</span> <span class="op">-&gt;</span> eventConsumer<span class="op">.</span><span class="fu">start</span><span class="op">(</span>eventHandler<span class="op">)).</span><span class="fu">start</span><span class="op">();</span></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;✅ Consumer started and listening for events...</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="project-structure-explained">Project Structure Explained</h3>
<pre><code>src/main/java/com/example/kafka/
│
├── config/
│   └── KafkaConfig.java
│       • Loads kafka.properties
│       • Provides configuration to producers/consumers
│       • Validates settings
│
├── model/
│   ├── Message.java
│   │   • Simple message with id, content, timestamp
│   │   • Used in basic Kafka examples
│   ├── FileMetadata.java
│   │   • File information (id, name, size, user, etc.)
│   │   • Stored in PostgreSQL
│   │   • Sent in Kafka events
│   └── FileEvent.java
│       • Event wrapper (eventType, fileMetadata, timestamp)
│       • JSON serialized for Kafka
│
├── producer/
│   └── KafkaProducer.java
│       • Generic Kafka producer
│       • Sends Message objects to topics
│       • Used in basic examples
│
├── consumer/
│   └── KafkaConsumer.java
│       • Generic Kafka consumer
│       • Receives Message objects from topics
│       • Used in basic examples
│
├── db/
│   ├── DatabaseManager.java
│   │   • HikariCP connection pool setup
│   │   • Manages database connections
│   │   • Health checks and cleanup
│   ├── FileRepository.java
│   │   • CRUD operations for files table
│   │   • Insert, select, update, delete file metadata
│   └── MessageRepository.java
│       • CRUD operations for messages table
│       • Used in basic examples
│
├── storage/
│   └── S3Manager.java
│       • MinIO/S3 client wrapper
│       • Upload, download, delete, list files
│       • Bucket management
│
├── kafka/
│   ├── FileEventProducer.java
│   │   • Specialized producer for file events
│   │   • sendUploadedEvent(), sendDeletedEvent()
│   │   • JSON serialization
│   └── FileEventConsumer.java
│       • Specialized consumer for file events
│       • Deserializes FileEvent objects
│       • Calls custom event handlers
│
└── [Demo Applications]
    ├── CompleteIntegrationDemo.java
    │   • Full S3 + Kafka + DB integration
    │   • Shows complete workflow
    ├── S3IntegrationDemo.java
    │   • S3 + DB integration
    │   • File upload and metadata storage
    ├── KafkaDatabaseIntegration.java
    │   • Kafka + DB integration
    │   • Messages stored in database
    ├── DatabaseDemo.java
    │   • Database operations demo
    │   • Connection pooling example
    └── KafkaApplication.java
        • Basic Kafka producer/consumer demo
        • Interactive mode</code></pre>
<h3 id="maven-dependencies">Maven Dependencies</h3>
<p><strong>File</strong>: <code>pom.xml</code></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">dependencies</span>&gt;</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- Kafka Client --&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">groupId</span>&gt;org.apache.kafka&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">artifactId</span>&gt;kafka-clients&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">version</span>&gt;3.6.0&lt;/<span class="kw">version</span>&gt;</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">dependency</span>&gt;</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- Logging --&gt;</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">groupId</span>&gt;org.slf4j&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">artifactId</span>&gt;slf4j-api&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">version</span>&gt;2.0.9&lt;/<span class="kw">version</span>&gt;</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">dependency</span>&gt;</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">groupId</span>&gt;ch.qos.logback&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">artifactId</span>&gt;logback-classic&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">version</span>&gt;1.4.11&lt;/<span class="kw">version</span>&gt;</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">dependency</span>&gt;</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- JSON Processing --&gt;</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">groupId</span>&gt;com.fasterxml.jackson.core&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">artifactId</span>&gt;jackson-databind&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">version</span>&gt;2.16.0&lt;/<span class="kw">version</span>&gt;</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">dependency</span>&gt;</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- PostgreSQL Driver --&gt;</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">groupId</span>&gt;org.postgresql&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">artifactId</span>&gt;postgresql&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">version</span>&gt;42.7.1&lt;/<span class="kw">version</span>&gt;</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">dependency</span>&gt;</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- Connection Pooling --&gt;</span></span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">groupId</span>&gt;com.zaxxer&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">artifactId</span>&gt;HikariCP&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">version</span>&gt;5.1.0&lt;/<span class="kw">version</span>&gt;</span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">dependency</span>&gt;</span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- AWS S3 SDK (works with MinIO) --&gt;</span></span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">groupId</span>&gt;software.amazon.awssdk&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">artifactId</span>&gt;s3&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">version</span>&gt;2.21.0&lt;/<span class="kw">version</span>&gt;</span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">dependency</span>&gt;</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">dependencies</span>&gt;</span></code></pre></div>
<hr />
<p><a name="integration"></a> ## 7. How Everything Works Together</p>
<h3 id="the-complete-workflow">The Complete Workflow</h3>
<pre><code>USER ACTION: Upload file &quot;vacation-photo.jpg&quot;
│
├─▶ STEP 1: Java Application Receives File
│   │ File: CompleteIntegrationDemo.java:156
│   │ Method: uploadFile()
│   │ Input: filename, contentType, fileData
│   │
│   ├─▶ STEP 2: Upload to S3 (MinIO)
│   │   │ File: S3Manager.java:90
│   │   │ Method: uploadFile()
│   │   │ Actions:
│   │   │   • Creates S3 key: &quot;uploads/alice/vacation-photo.jpg&quot;
│   │   │   • Uploads file data to MinIO
│   │   │   • Returns URL: &quot;http://localhost:9000/bucket/uploads/alice/vacation-photo.jpg&quot;
│   │   │ Result: File stored in blob storage ✅
│   │   │
│   │   └─▶ STEP 3: Save Metadata to PostgreSQL
│   │       │ File: FileRepository.java:48
│   │       │ Method: insertFileMetadata()
│   │       │ Actions:
│   │       │   • Creates FileMetadata object
│   │       │   • Executes INSERT SQL statement
│   │       │   • Saves: id, filename, s3_url, size, user, timestamp
│   │       │ Result: Metadata stored in database ✅
│   │       │
│   │       └─▶ STEP 4: Publish Event to Kafka
│   │           │ File: FileEventProducer.java:72
│   │           │ Method: sendUploadedEvent()
│   │           │ Actions:
│   │           │   • Creates FileEvent object
│   │           │   • Converts to JSON
│   │           │   • Sends to Kafka topic &quot;file-events&quot;
│   │           │   • Uses file ID as partition key
│   │           │ Result: Event published to Kafka ✅
│   │           │
│   │           └─▶ STEP 5: Consumer Receives Event
│   │               │ File: FileEventConsumer.java:87
│   │               │ Method: start()
│   │               │ Actions:
│   │               │   • Polls Kafka for new messages
│   │               │   • Deserializes JSON to FileEvent
│   │               │   • Calls custom event handler
│   │               │   • Processes: thumbnails, virus scan, notifications
│   │               │ Result: Event processed ✅
│   │
│   └─▶ RESPONSE: Return success to user (1 second)
│       │ User sees: &quot;File uploaded successfully!&quot;
│       │ Background: Processing continues asynchronously
│       │
│       └─▶ BACKGROUND PROCESSING (runs independently)
│           • Thumbnail generation (10 seconds)
│           • Virus scanning (15 seconds)
│           • Search indexing (5 seconds)
│           • Email notification (2 seconds)
│           Total: 32 seconds (but user doesn&#39;t wait!)</code></pre>
<h3 id="component-interaction-diagram">Component Interaction
Diagram</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                       USER REQUEST                              │
│                     &quot;Upload vacation.jpg&quot;                        │
└──────────────────────────┬──────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────────┐
│                    JAVA APPLICATION                             │
│              (CompleteIntegrationDemo.java)                     │
└──┬────────────────┬────────────────┬─────────────────┬──────────┘
   │                │                │                 │
   │ uploadFile()   │ insert()       │ publish()       │ process()
   ▼                ▼                ▼                 ▼
┌─────────┐   ┌─────────────┐  ┌──────────┐   ┌──────────────┐
│         │   │             │  │          │   │              │
│  MinIO  │   │ PostgreSQL  │  │  Kafka   │   │   Consumer   │
│   (S3)  │   │  Database   │  │  Broker  │   │   Thread     │
│         │   │             │  │          │   │              │
│ Stores  │   │   Stores    │  │  Routes  │   │  Processes   │
│  File   │   │  Metadata   │  │  Events  │   │    Event     │
│         │   │             │  │          │   │              │
│ Port:   │   │   Port:     │  │  Port:   │   │  (Background)│
│  9000   │   │    5432     │  │  9092    │   │              │
└─────────┘   └─────────────┘  └──────────┘   └──────────────┘
     │               │               │                │
     │               │               │                │
     ▼               ▼               ▼                ▼
┌─────────┐   ┌─────────────┐  ┌──────────┐   ┌──────────────┐
│ Bucket: │   │   Table:    │  │  Topic:  │   │   Actions:   │
│complete-│   │   files     │  │file-events│  │ • Thumbnails │
│integra- │   │             │  │          │   │ • Virus scan │
│tion-    │   │ Columns:    │  │Partitions│   │ • Notify     │
│ bucket  │   │ • id        │  │   0, 1, 2│   │ • Index      │
│         │   │ • filename  │  │          │   │              │
│Files:   │   │ • s3_url    │  │ Messages:│   │ Async        │
│ /uploads│   │ • size      │  │  JSON    │   │ Processing   │
│  /alice │   │ • user      │  │  Events  │   │              │
│   /*.jpg│   │ • timestamp │  │          │   │              │
└─────────┘   └─────────────┘  └──────────┘   └──────────────┘</code></pre>
<h3 id="data-flow-timeline">Data Flow Timeline</h3>
<pre><code>Time   | Component          | Action
-------|-------------------|------------------------------------------
0.0s   | User              | Clicks &quot;Upload&quot; button
0.1s   | Java App          | Receives file (10 MB)
0.2s   | S3Manager         | Starts upload to MinIO
1.0s   | MinIO             | File stored, returns URL
1.1s   | FileRepository    | Saves metadata to PostgreSQL
1.2s   | PostgreSQL        | INSERT complete
1.3s   | FileEventProducer | Creates JSON event
1.4s   | Kafka Broker      | Receives event, stores in partition 1
1.5s   | Java App          | Returns success to user ✅
       |                   |
       |                   | [User sees &quot;Upload successful!&quot;]
       |                   |
2.0s   | Consumer Thread   | Polls Kafka, receives event
2.1s   | Event Handler     | Starts processing
2.2s   | Thumbnail Service | Generates 3 sizes (200x200, 500x500, 1000x1000)
12.0s  | Thumbnail Service | Complete ✅
12.1s  | Virus Scanner     | Scans file for malware
27.0s  | Virus Scanner     | Complete ✅ (Clean)
27.1s  | Search Indexer    | Extracts metadata, updates search DB
32.0s  | Search Indexer    | Complete ✅
32.1s  | Notification      | Sends email: &quot;Your file is ready!&quot;
34.0s  | Notification      | Complete ✅
       |                   |
       | TOTAL USER WAIT   | 1.5 seconds
       | TOTAL PROCESSING  | 34.0 seconds (async)</code></pre>
<h3 id="error-handling-resilience">Error Handling &amp; Resilience</h3>
<p><strong>Scenario 1: S3 Upload Fails</strong></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    s3Url <span class="op">=</span> s3Manager<span class="op">.</span><span class="fu">uploadFile</span><span class="op">(</span>bucket<span class="op">,</span> key<span class="op">,</span> data<span class="op">,</span> contentType<span class="op">);</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span>S3Exception e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">error</span><span class="op">(</span><span class="st">&quot;S3 upload failed: {}&quot;</span><span class="op">,</span> e<span class="op">.</span><span class="fu">getMessage</span><span class="op">());</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Don&#39;t save to database or send Kafka event</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;Upload failed - please try again&quot;</span><span class="op">;</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Result</strong>: User sees error, database and Kafka stay
clean</p>
<p><strong>Scenario 2: Database Insert Fails</strong></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    fileRepository<span class="op">.</span><span class="fu">insertFileMetadata</span><span class="op">(</span>metadata<span class="op">);</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">SQLException</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">error</span><span class="op">(</span><span class="st">&quot;Database insert failed: {}&quot;</span><span class="op">,</span> e<span class="op">.</span><span class="fu">getMessage</span><span class="op">());</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Rollback: Delete from S3</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    s3Manager<span class="op">.</span><span class="fu">deleteFile</span><span class="op">(</span>bucket<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;Upload failed - please try again&quot;</span><span class="op">;</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Result</strong>: S3 file deleted, user sees error, Kafka not
notified</p>
<p><strong>Scenario 3: Kafka Publish Fails</strong></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    eventProducer<span class="op">.</span><span class="fu">sendUploadedEvent</span><span class="op">(</span>metadata<span class="op">);</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">error</span><span class="op">(</span><span class="st">&quot;Kafka publish failed: {}&quot;</span><span class="op">,</span> e<span class="op">.</span><span class="fu">getMessage</span><span class="op">());</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// File is uploaded and in database</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Event will be retried later or processing triggered manually</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Result</strong>: File uploaded and saved, but processing
delayed</p>
<p><strong>Scenario 4: Consumer Processing Fails</strong></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">// FileEventConsumer.java</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>consumer<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span><span class="bu">Collections</span><span class="op">.</span><span class="fu">singletonList</span><span class="op">(</span>topicName<span class="op">));</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>running<span class="op">)</span> <span class="op">{</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>        ConsumerRecords<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;</span> records <span class="op">=</span> consumer<span class="op">.</span><span class="fu">poll</span><span class="op">(</span><span class="bu">Duration</span><span class="op">.</span><span class="fu">ofMillis</span><span class="op">(</span><span class="dv">100</span><span class="op">));</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span>ConsumerRecord<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;</span> <span class="kw">record</span> <span class="op">:</span> records<span class="op">)</span> <span class="op">{</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>                FileEvent event <span class="op">=</span> <span class="fu">deserialize</span><span class="op">(</span><span class="kw">record</span><span class="op">.</span><span class="fu">value</span><span class="op">());</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>                eventHandler<span class="op">.</span><span class="fu">accept</span><span class="op">(</span>event<span class="op">);</span>  <span class="co">// Process event</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>                logger<span class="op">.</span><span class="fu">error</span><span class="op">(</span><span class="st">&quot;Failed to process event: {}&quot;</span><span class="op">,</span> <span class="kw">record</span><span class="op">.</span><span class="fu">key</span><span class="op">(),</span> e<span class="op">);</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Event offset not committed - will retry on next poll</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>        consumer<span class="op">.</span><span class="fu">commitSync</span><span class="op">();</span>  <span class="co">// Commit only if all successful</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">error</span><span class="op">(</span><span class="st">&quot;Consumer error&quot;</span><span class="op">,</span> e<span class="op">);</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Will reconnect and resume from last committed offset</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Result</strong>: Failed events are retried automatically</p>
<hr />
<p><a name="docker"></a> ## 8. Docker &amp; Containerization</p>
<h3 id="what-is-docker">What is Docker?</h3>
<p><strong>Simple Analogy</strong>: Docker is like <strong>shipping
containers for software</strong>: - Just as shipping containers
standardize how goods are transported - Docker containers standardize
how software runs - Works the same on your laptop, your teammate’s
computer, and production servers</p>
<p><strong>Without Docker:</strong></p>
<pre><code>Developer 1: &quot;Works on my machine!&quot; (Windows)
Developer 2: &quot;Doesn&#39;t work on mine!&quot; (Mac)
Server: &quot;Crashes in production!&quot; (Linux)

Problem: Different environments, different results!</code></pre>
<p><strong>With Docker:</strong></p>
<pre><code>Developer 1: Runs Docker container ✅
Developer 2: Runs same Docker container ✅
Server: Runs same Docker container ✅

Solution: Same environment everywhere!</code></pre>
<h3 id="docker-compose">Docker Compose</h3>
<p><strong>What</strong>: Tool to run multiple Docker containers
together</p>
<p><strong>File</strong>: <code>docker-compose.yml</code></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">  # Service 1: Zookeeper (Kafka&#39;s coordinator)</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">zookeeper</span><span class="kw">:</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> confluentinc/cp-zookeeper:7.5.0</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;2181:2181&quot;</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">ZOOKEEPER_CLIENT_PORT</span><span class="kw">:</span><span class="at"> </span><span class="dv">2181</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> zookeeper-data:/var/lib/zookeeper/data</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">healthcheck</span><span class="kw">:</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;CMD&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;nc&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;-z&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;localhost&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;2181&quot;</span><span class="kw">]</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="co">  # Service 2: Kafka (Message broker)</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">kafka</span><span class="kw">:</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> confluentinc/cp-kafka:7.5.0</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> zookeeper</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;9092:9092&quot;</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">KAFKA_BROKER_ID</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">KAFKA_ZOOKEEPER_CONNECT</span><span class="kw">:</span><span class="at"> zookeeper:2181</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">KAFKA_ADVERTISED_LISTENERS</span><span class="kw">:</span><span class="at"> PLAINTEXT://localhost:9092</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> kafka-data:/var/lib/kafka/data</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a><span class="co">  # Service 3: PostgreSQL (Database)</span></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres</span><span class="kw">:</span></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres:16-alpine</span></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;5432:5432&quot;</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_USER</span><span class="kw">:</span><span class="at"> admin</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_PASSWORD</span><span class="kw">:</span><span class="at"> admin123</span></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_DB</span><span class="kw">:</span><span class="at"> mydb</span></span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres-data:/var/lib/postgresql/data</span></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a><span class="co">  # Service 4: MinIO (S3-compatible storage)</span></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">minio</span><span class="kw">:</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> minio/minio:latest</span></span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> server /data --console-address &quot;:9001&quot;</span></span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;9000:9000&quot;</span><span class="co">  # API</span></span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;9001:9001&quot;</span><span class="co">  # Web Console</span></span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">MINIO_ROOT_USER</span><span class="kw">:</span><span class="at"> minioadmin</span></span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">MINIO_ROOT_PASSWORD</span><span class="kw">:</span><span class="at"> minioadmin123</span></span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> minio-data:/data</span></span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a><span class="co">  # Service 5: pgAdmin (Database UI)</span></span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pgadmin</span><span class="kw">:</span></span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> dpage/pgadmin4:latest</span></span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;5050:80&quot;</span></span>
<span id="cb61-60"><a href="#cb61-60" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb61-61"><a href="#cb61-61" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">PGADMIN_DEFAULT_EMAIL</span><span class="kw">:</span><span class="at"> admin@admin.com</span></span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">PGADMIN_DEFAULT_PASSWORD</span><span class="kw">:</span><span class="at"> admin123</span></span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true" tabindex="-1"></a><span class="co">  # Service 6: Kafka UI (Kafka management)</span></span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">kafka-ui</span><span class="kw">:</span></span>
<span id="cb61-66"><a href="#cb61-66" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> provectuslabs/kafka-ui:latest</span></span>
<span id="cb61-67"><a href="#cb61-67" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb61-68"><a href="#cb61-68" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8080:8080&quot;</span></span>
<span id="cb61-69"><a href="#cb61-69" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb61-70"><a href="#cb61-70" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">KAFKA_CLUSTERS_0_NAME</span><span class="kw">:</span><span class="at"> local</span></span>
<span id="cb61-71"><a href="#cb61-71" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS</span><span class="kw">:</span><span class="at"> kafka:29092</span></span>
<span id="cb61-72"><a href="#cb61-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-73"><a href="#cb61-73" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb61-74"><a href="#cb61-74" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">zookeeper-data</span><span class="kw">:</span></span>
<span id="cb61-75"><a href="#cb61-75" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">kafka-data</span><span class="kw">:</span></span>
<span id="cb61-76"><a href="#cb61-76" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres-data</span><span class="kw">:</span></span>
<span id="cb61-77"><a href="#cb61-77" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">minio-data</span><span class="kw">:</span></span>
<span id="cb61-78"><a href="#cb61-78" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pgadmin-data</span><span class="kw">:</span></span></code></pre></div>
<h3 id="docker-commands">Docker Commands</h3>
<p><strong>Start all services:</strong></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">-d</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># -d = detached mode (runs in background)</span></span></code></pre></div>
<p><strong>Stop all services:</strong></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> down</span></code></pre></div>
<p><strong>Stop and remove all data:</strong></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> down <span class="at">-v</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># -v = removes volumes (deletes all data)</span></span></code></pre></div>
<p><strong>View logs:</strong></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> logs kafka</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> logs postgres</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> logs <span class="at">-f</span>  <span class="co"># -f = follow (live updates)</span></span></code></pre></div>
<p><strong>Check status:</strong></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> ps</span></code></pre></div>
<p><strong>Restart a service:</strong></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> restart kafka</span></code></pre></div>
<h3 id="docker-networking">Docker Networking</h3>
<p><strong>Internal Network</strong> (<code>docker-compose.yml</code>
creates network: <code>kafka-network</code>):</p>
<pre><code>Container: kafka-broker
Internal hostname: kafka
Internal IP: 172.18.0.3
Accessible from other containers: kafka:29092

Container: postgres-db
Internal hostname: postgres
Internal IP: 172.18.0.4
Accessible from other containers: postgres:5432

Container: minio-s3
Internal hostname: minio
Internal IP: 172.18.0.5
Accessible from other containers: minio:9000</code></pre>
<p><strong>Port Mapping</strong>:</p>
<pre><code>Host Machine           Docker Container
localhost:9092    →    kafka:29092
localhost:5432    →    postgres:5432
localhost:9000    →    minio:9000
localhost:8080    →    kafka-ui:8080
localhost:5050    →    pgadmin:80</code></pre>
<h3 id="volumes-data-persistence">Volumes &amp; Data Persistence</h3>
<p><strong>Without Volumes:</strong></p>
<pre><code>1. Start container
2. Write data
3. Stop container
4. Data is LOST! ❌</code></pre>
<p><strong>With Volumes:</strong></p>
<pre><code>1. Start container (mounts volume)
2. Write data (saved to volume)
3. Stop container
4. Data is PRESERVED! ✅
5. Start container again (data still there)</code></pre>
<p><strong>Our Volumes:</strong> - <code>postgres-data</code> → Database
files - <code>kafka-data</code> → Kafka logs and events -
<code>zookeeper-data</code> → Zookeeper state - <code>minio-data</code>
→ Uploaded files</p>
<hr />
<p><a name="data-flow"></a> ## 9. Deep Dive: Complete Data Flow</p>
<h3 id="detailed-step-by-step-execution">Detailed Step-by-Step
Execution</h3>
<h4 id="step-1-application-startup">Step 1: Application Startup</h4>
<p><strong>File</strong>:
<code>CompleteIntegrationDemo.java:56</code></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    CompleteIntegrationDemo demo <span class="op">=</span> <span class="kw">new</span> <span class="fu">CompleteIntegrationDemo</span><span class="op">();</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    demo<span class="op">.</span><span class="fu">initializeComponents</span><span class="op">();</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>What Happens:</strong> 1. JVM starts 2. Loads all classes 3.
Initializes logging (Logback) 4. Calls
<code>initializeComponents()</code></p>
<hr />
<h4 id="step-2-initialize-s3-manager">Step 2: Initialize S3 Manager</h4>
<p><strong>File</strong>: <code>S3Manager.java:33</code></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="fu">S3Manager</span><span class="op">(</span><span class="bu">String</span> endpoint<span class="op">,</span> <span class="bu">String</span> accessKey<span class="op">,</span> <span class="bu">String</span> secretKey<span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    AwsBasicCredentials credentials <span class="op">=</span> AwsBasicCredentials<span class="op">.</span><span class="fu">create</span><span class="op">(</span>accessKey<span class="op">,</span> secretKey<span class="op">);</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">s3Client</span> <span class="op">=</span> S3Client<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">endpointOverride</span><span class="op">(</span><span class="bu">URI</span><span class="op">.</span><span class="fu">create</span><span class="op">(</span><span class="st">&quot;http://localhost:9000&quot;</span><span class="op">))</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">credentialsProvider</span><span class="op">(</span>StaticCredentialsProvider<span class="op">.</span><span class="fu">create</span><span class="op">(</span>credentials<span class="op">))</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Network Request:</strong></p>
<pre><code>Java App → MinIO
└─▶ GET http://localhost:9000/ (health check)
    ◀── Response: 200 OK</code></pre>
<p><strong>Result</strong>: S3 client ready to upload files</p>
<hr />
<h4 id="step-3-initialize-database-connection-pool">Step 3: Initialize
Database Connection Pool</h4>
<p><strong>File</strong>: <code>DatabaseManager.java:30</code></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>HikariConfig config <span class="op">=</span> <span class="kw">new</span> <span class="fu">HikariConfig</span><span class="op">();</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">setJdbcUrl</span><span class="op">(</span><span class="st">&quot;jdbc:postgresql://localhost:5432/mydb&quot;</span><span class="op">);</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">setUsername</span><span class="op">(</span><span class="st">&quot;admin&quot;</span><span class="op">);</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">setPassword</span><span class="op">(</span><span class="st">&quot;admin123&quot;</span><span class="op">);</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="fu">setMaximumPoolSize</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>dataSource <span class="op">=</span> <span class="kw">new</span> <span class="fu">HikariDataSource</span><span class="op">(</span>config<span class="op">);</span></span></code></pre></div>
<p><strong>Network Request:</strong></p>
<pre><code>Java App → PostgreSQL
└─▶ TCP connection to localhost:5432
    ◀── Response: Connection accepted
    └─▶ AUTH: username=admin, password=***
        ◀── Response: AUTH_OK
        └─▶ SELECT 1 (connection test)
            ◀── Response: 1 row</code></pre>
<p><strong>Result</strong>: Connection pool with 10 connections
ready</p>
<hr />
<h4 id="step-4-initialize-kafka-producer">Step 4: Initialize Kafka
Producer</h4>
<p><strong>File</strong>: <code>FileEventProducer.java:51</code></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Properties</span> props <span class="op">=</span> <span class="kw">new</span> <span class="bu">Properties</span><span class="op">();</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ProducerConfig<span class="op">.</span><span class="fu">BOOTSTRAP_SERVERS_CONFIG</span><span class="op">,</span> <span class="st">&quot;localhost:9092&quot;</span><span class="op">);</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ProducerConfig<span class="op">.</span><span class="fu">KEY_SERIALIZER_CLASS_CONFIG</span><span class="op">,</span> StringSerializer<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ProducerConfig<span class="op">.</span><span class="fu">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="op">,</span> StringSerializer<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>producer <span class="op">=</span> <span class="kw">new</span> KafkaProducer<span class="op">&lt;&gt;(</span>props<span class="op">);</span></span></code></pre></div>
<p><strong>Network Request:</strong></p>
<pre><code>Java App → Kafka
└─▶ TCP connection to localhost:9092
    ◀── Response: Connection accepted
    └─▶ API_VERSIONS request
        ◀── Response: [list of supported APIs]
        └─▶ METADATA request (list topics)
            ◀── Response: {topics: [&quot;file-events&quot;], brokers: [{id:1, host:&quot;kafka&quot;}]}</code></pre>
<p><strong>Result</strong>: Producer ready to send messages</p>
<hr />
<h4 id="step-5-initialize-kafka-consumer">Step 5: Initialize Kafka
Consumer</h4>
<p><strong>File</strong>: <code>FileEventConsumer.java:58</code></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Properties</span> props <span class="op">=</span> <span class="kw">new</span> <span class="bu">Properties</span><span class="op">();</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ConsumerConfig<span class="op">.</span><span class="fu">BOOTSTRAP_SERVERS_CONFIG</span><span class="op">,</span> <span class="st">&quot;localhost:9092&quot;</span><span class="op">);</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ConsumerConfig<span class="op">.</span><span class="fu">GROUP_ID_CONFIG</span><span class="op">,</span> <span class="st">&quot;complete-integration-group&quot;</span><span class="op">);</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>consumer <span class="op">=</span> <span class="kw">new</span> KafkaConsumer<span class="op">&lt;&gt;(</span>props<span class="op">);</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>consumer<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span><span class="bu">Collections</span><span class="op">.</span><span class="fu">singletonList</span><span class="op">(</span><span class="st">&quot;file-events&quot;</span><span class="op">));</span></span></code></pre></div>
<p><strong>Network Request:</strong></p>
<pre><code>Java App → Kafka
└─▶ JOIN_GROUP request (group: complete-integration-group)
    ◀── Response: {memberId: &quot;consumer-1&quot;, leader: true}
    └─▶ SYNC_GROUP request
        ◀── Response: {assignment: [file-events-0, file-events-1, file-events-2]}
        └─▶ FETCH_OFFSET request (get last read position)
            ◀── Response: {file-events-0: offset 0, file-events-1: offset 0, file-events-2: offset 0}</code></pre>
<p><strong>Result</strong>: Consumer subscribed to topic, ready to
receive messages</p>
<hr />
<h4 id="step-6-upload-file-to-s3">Step 6: Upload File to S3</h4>
<p><strong>File</strong>: <code>S3Manager.java:90</code></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="bu">String</span> <span class="fu">uploadFile</span><span class="op">(</span><span class="bu">String</span> bucketName<span class="op">,</span> <span class="bu">String</span> key<span class="op">,</span> <span class="dt">byte</span><span class="op">[]</span> fileData<span class="op">,</span> <span class="bu">String</span> contentType<span class="op">)</span> <span class="op">{</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    PutObjectRequest request <span class="op">=</span> PutObjectRequest<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">bucket</span><span class="op">(</span><span class="st">&quot;complete-integration-bucket&quot;</span><span class="op">)</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">key</span><span class="op">(</span><span class="st">&quot;uploads/alice/vacation-photo.jpg&quot;</span><span class="op">)</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">contentType</span><span class="op">(</span><span class="st">&quot;image/jpeg&quot;</span><span class="op">)</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">contentLength</span><span class="op">(</span><span class="dv">2500000L</span><span class="op">)</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    s3Client<span class="op">.</span><span class="fu">putObject</span><span class="op">(</span>request<span class="op">,</span> RequestBody<span class="op">.</span><span class="fu">fromBytes</span><span class="op">(</span>fileData<span class="op">));</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Network Request:</strong></p>
<pre><code>Java App → MinIO
└─▶ PUT http://localhost:9000/complete-integration-bucket/uploads/alice/vacation-photo.jpg
    Headers:
      Content-Type: image/jpeg
      Content-Length: 2500000
      Authorization: AWS4-HMAC-SHA256 Credential=...

    Body: [2.5 MB of image data]

    ◀── Response: 200 OK
        Headers:
          ETag: &quot;abc123def456&quot;
          Location: /complete-integration-bucket/uploads/alice/vacation-photo.jpg</code></pre>
<p><strong>MinIO Internal Processing:</strong> 1. Receives HTTP PUT
request 2. Validates credentials 3. Writes file to disk:
<code>/data/complete-integration-bucket/uploads/alice/vacation-photo.jpg</code>
4. Updates bucket index 5. Calculates ETag (MD5 hash) 6. Returns success
response</p>
<p><strong>Result</strong>: File stored in MinIO at
<code>/data/complete-integration-bucket/uploads/alice/vacation-photo.jpg</code></p>
<hr />
<h4 id="step-7-save-metadata-to-postgresql">Step 7: Save Metadata to
PostgreSQL</h4>
<p><strong>File</strong>: <code>FileRepository.java:48</code></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">insertFileMetadata</span><span class="op">(</span>FileMetadata metadata<span class="op">)</span> <span class="kw">throws</span> <span class="bu">SQLException</span> <span class="op">{</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> sql <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="st">        INSERT INTO files (id, filename, s3_key, s3_url, file_size,</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="st">                          content_type, uploaded_by, uploaded_at)</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="st">        VALUES (?, ?, ?, ?, ?, ?, ?, ?)</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span><span class="op">;</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">(</span><span class="bu">Connection</span> conn <span class="op">=</span> databaseManager<span class="op">.</span><span class="fu">getConnection</span><span class="op">();</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>         <span class="bu">PreparedStatement</span> stmt <span class="op">=</span> conn<span class="op">.</span><span class="fu">prepareStatement</span><span class="op">(</span>sql<span class="op">))</span> <span class="op">{</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="st">&quot;a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6&quot;</span><span class="op">);</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="st">&quot;vacation-photo.jpg&quot;</span><span class="op">);</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="st">&quot;uploads/alice/vacation-photo.jpg&quot;</span><span class="op">);</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="st">&quot;http://localhost:9000/complete-integration-bucket/uploads/alice/vacation-photo.jpg&quot;</span><span class="op">);</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setLong</span><span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">2500000L</span><span class="op">);</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">6</span><span class="op">,</span> <span class="st">&quot;image/jpeg&quot;</span><span class="op">);</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="st">&quot;alice&quot;</span><span class="op">);</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">setLong</span><span class="op">(</span><span class="dv">8</span><span class="op">,</span> <span class="dv">1729090624308L</span><span class="op">);</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>        stmt<span class="op">.</span><span class="fu">executeUpdate</span><span class="op">();</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Network Request:</strong></p>
<pre><code>Java App → PostgreSQL
└─▶ TCP packet to localhost:5432
    PostgreSQL Wire Protocol:
      Message Type: P (Parse)
      SQL: INSERT INTO files (id, filename, s3_key, s3_url, file_size,
                              content_type, uploaded_by, uploaded_at)
           VALUES ($1, $2, $3, $4, $5, $6, $7, $8)

      Message Type: B (Bind)
      Parameters:
        $1: &quot;a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6&quot;
        $2: &quot;vacation-photo.jpg&quot;
        $3: &quot;uploads/alice/vacation-photo.jpg&quot;
        $4: &quot;http://localhost:9000/complete-integration-bucket/uploads/alice/vacation-photo.jpg&quot;
        $5: 2500000
        $6: &quot;image/jpeg&quot;
        $7: &quot;alice&quot;
        $8: 1729090624308

      Message Type: E (Execute)

    ◀── Response:
        Message Type: C (CommandComplete)
        Tag: INSERT 0 1</code></pre>
<p><strong>PostgreSQL Internal Processing:</strong> 1. Parses SQL
statement 2. Validates syntax 3. Checks constraints (NOT NULL, PRIMARY
KEY) 4. Inserts row into <code>files</code> table 5. Updates indexes
(<code>idx_files_uploaded_by</code>, <code>idx_files_created_at</code>)
6. Writes to Write-Ahead Log (WAL) 7. Returns success</p>
<p><strong>Database State:</strong></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> files <span class="kw">WHERE</span> <span class="kw">id</span> <span class="op">=</span> <span class="st">&#39;a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6&#39;</span>;</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- Result:</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="kw">id</span>       | a1b2c3d4<span class="op">-</span>e5f6<span class="op">-</span><span class="dv">7</span>g8h<span class="op">-</span><span class="dv">9</span>i0j<span class="op">-</span>k1l2m3n4o5p6</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>filename | vacation<span class="op">-</span>photo.jpg</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>s3_key   | uploads<span class="op">/</span>alice<span class="op">/</span>vacation<span class="op">-</span>photo.jpg</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>s3_url   | http:<span class="op">//</span>localhost<span class="ch">:9000</span><span class="op">/</span><span class="kw">complete</span><span class="op">-</span>integration<span class="op">-</span>bucket<span class="op">/</span>uploads<span class="op">/</span>alice<span class="op">/</span>vacation<span class="op">-</span>photo.jpg</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>file_size| <span class="dv">2500000</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>content_type | image<span class="op">/</span>jpeg</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>uploaded_by  | alice</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>uploaded_at  | <span class="dv">1729090624308</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>created_at   | <span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">16</span> <span class="dv">16</span><span class="ch">:37:04</span><span class="fl">.308</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>updated_at   | <span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">16</span> <span class="dv">16</span><span class="ch">:37:04</span><span class="fl">.308</span></span></code></pre></div>
<hr />
<h4 id="step-8-publish-event-to-kafka">Step 8: Publish Event to
Kafka</h4>
<p><strong>File</strong>: <code>FileEventProducer.java:72</code></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">sendUploadedEvent</span><span class="op">(</span>FileMetadata metadata<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>    FileEvent event <span class="op">=</span> <span class="kw">new</span> <span class="fu">FileEvent</span><span class="op">(</span><span class="st">&quot;UPLOADED&quot;</span><span class="op">,</span> metadata<span class="op">,</span> <span class="bu">System</span><span class="op">.</span><span class="fu">currentTimeMillis</span><span class="op">());</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> jsonMessage <span class="op">=</span> objectMapper<span class="op">.</span><span class="fu">writeValueAsString</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    ProducerRecord<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;</span> <span class="kw">record</span> <span class="op">=</span> <span class="kw">new</span> ProducerRecord<span class="op">&lt;&gt;(</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;file-events&quot;</span><span class="op">,</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>        metadata<span class="op">.</span><span class="fu">getId</span><span class="op">(),</span>  <span class="co">// Partition key</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>        jsonMessage</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>    producer<span class="op">.</span><span class="fu">send</span><span class="op">(</span><span class="kw">record</span><span class="op">).</span><span class="fu">get</span><span class="op">();</span>  <span class="co">// Wait for acknowledgment</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>JSON Message Created:</strong></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;eventType&quot;</span><span class="fu">:</span> <span class="st">&quot;UPLOADED&quot;</span><span class="fu">,</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;fileMetadata&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6&quot;</span><span class="fu">,</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;filename&quot;</span><span class="fu">:</span> <span class="st">&quot;vacation-photo.jpg&quot;</span><span class="fu">,</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;s3Key&quot;</span><span class="fu">:</span> <span class="st">&quot;uploads/alice/vacation-photo.jpg&quot;</span><span class="fu">,</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;s3Url&quot;</span><span class="fu">:</span> <span class="st">&quot;http://localhost:9000/complete-integration-bucket/uploads/alice/vacation-photo.jpg&quot;</span><span class="fu">,</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;fileSize&quot;</span><span class="fu">:</span> <span class="dv">2500000</span><span class="fu">,</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;contentType&quot;</span><span class="fu">:</span> <span class="st">&quot;image/jpeg&quot;</span><span class="fu">,</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;uploadedBy&quot;</span><span class="fu">:</span> <span class="st">&quot;alice&quot;</span><span class="fu">,</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;uploadedAt&quot;</span><span class="fu">:</span> <span class="dv">1729090624308</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;timestamp&quot;</span><span class="fu">:</span> <span class="dv">1729090624308</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>Network Request:</strong></p>
<pre><code>Java App → Kafka
└─▶ PRODUCE request
    Topic: file-events
    Partition: 1 (calculated from key hash)
    Key: &quot;a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6&quot;
    Value: [JSON message above]
    Compression: none
    Acks: all (wait for all replicas)

    ◀── Response (after 50ms):
        Status: SUCCESS
        Partition: 1
        Offset: 42
        Timestamp: 1729090624358</code></pre>
<p><strong>Kafka Internal Processing:</strong> 1. Receives PRODUCE
request 2. Calculates partition from key hash:
<code>hash(&quot;a1b2c3d4...&quot;) % 3 = 1</code> 3. Appends message to partition
1 log file 4. Writes to disk 5. Replicates to other brokers (if
configured) 6. Returns acknowledgment with offset</p>
<p><strong>Kafka Log File</strong>
(<code>/var/lib/kafka/data/file-events-1/00000000000000000042.log</code>):</p>
<pre><code>Offset: 42
Timestamp: 1729090624358
Key Length: 36
Key: a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6
Value Length: 423
Value: {&quot;eventType&quot;:&quot;UPLOADED&quot;,&quot;fileMetadata&quot;:{...}}</code></pre>
<hr />
<h4 id="step-9-consumer-polls-kafka">Step 9: Consumer Polls Kafka</h4>
<p><strong>File</strong>: <code>FileEventConsumer.java:87</code></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>running<span class="op">)</span> <span class="op">{</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    ConsumerRecords<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;</span> records <span class="op">=</span> consumer<span class="op">.</span><span class="fu">poll</span><span class="op">(</span><span class="bu">Duration</span><span class="op">.</span><span class="fu">ofMillis</span><span class="op">(</span><span class="dv">100</span><span class="op">));</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>ConsumerRecord<span class="op">&lt;</span><span class="bu">String</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;</span> <span class="kw">record</span> <span class="op">:</span> records<span class="op">)</span> <span class="op">{</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>        FileEvent event <span class="op">=</span> objectMapper<span class="op">.</span><span class="fu">readValue</span><span class="op">(</span><span class="kw">record</span><span class="op">.</span><span class="fu">value</span><span class="op">(),</span> FileEvent<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>        eventHandler<span class="op">.</span><span class="fu">accept</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    consumer<span class="op">.</span><span class="fu">commitSync</span><span class="op">();</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Network Request:</strong></p>
<pre><code>Java App → Kafka
└─▶ FETCH request
    Topics: [file-events]
    Partitions: [0, 1, 2]
    CurrentOffsets: [0, 42, 0]  // Partition 1 has new message at offset 42
    MaxWaitMs: 100
    MinBytes: 1
    MaxBytes: 52428800 (50 MB)

    ◀── Response (immediately, since message is available):
        Partition: 1
        HighWaterMark: 43
        Messages: [
          {
            Offset: 42
            Key: &quot;a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6&quot;
            Value: &quot;{\&quot;eventType\&quot;:\&quot;UPLOADED\&quot;,\&quot;fileMetadata\&quot;:{...}}&quot;
            Timestamp: 1729090624358
          }
        ]</code></pre>
<p><strong>Java Processing:</strong> 1. Receives message from Kafka 2.
Deserializes JSON to <code>FileEvent</code> object 3. Calls
<code>eventHandler.accept(event)</code> 4. Event handler processes the
event</p>
<hr />
<h4 id="step-10-process-event">Step 10: Process Event</h4>
<p><strong>File</strong>:
<code>CompleteIntegrationDemo.java:127</code></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>Consumer<span class="op">&lt;</span>FileEvent<span class="op">&gt;</span> eventHandler <span class="op">=</span> event <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    FileMetadata metadata <span class="op">=</span> event<span class="op">.</span><span class="fu">getFileMetadata</span><span class="op">();</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;📥 RECEIVED EVENT: {}&quot;</span><span class="op">,</span> event<span class="op">.</span><span class="fu">getEventType</span><span class="op">());</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;  • Filename: {}&quot;</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getFilename</span><span class="op">());</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;  • Size: {}&quot;</span><span class="op">,</span> <span class="fu">formatFileSize</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">getFileSize</span><span class="op">()));</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;  • User: {}&quot;</span><span class="op">,</span> metadata<span class="op">.</span><span class="fu">getUploadedBy</span><span class="op">());</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Simulate processing tasks</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">  🔄 Processing tasks:&quot;</span><span class="op">);</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;     [1] Generating thumbnails...&quot;</span><span class="op">);</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">generateThumbnails</span><span class="op">(</span>metadata<span class="op">);</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;     [2] Scanning for viruses...&quot;</span><span class="op">);</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scanForViruses</span><span class="op">(</span>metadata<span class="op">);</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;     [3] Updating search index...&quot;</span><span class="op">);</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateSearchIndex</span><span class="op">(</span>metadata<span class="op">);</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;     [4] Sending notifications...&quot;</span><span class="op">);</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sendNotification</span><span class="op">(</span>metadata<span class="op">);</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">  ✅ Processing complete!&quot;</span><span class="op">);</span></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>    eventsProcessed<span class="op">.</span><span class="fu">incrementAndGet</span><span class="op">();</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>Real-World Processing Examples:</strong></p>
<p><strong>1. Generate Thumbnails:</strong></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">generateThumbnails</span><span class="op">(</span>FileMetadata metadata<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>metadata<span class="op">.</span><span class="fu">getContentType</span><span class="op">().</span><span class="fu">startsWith</span><span class="op">(</span><span class="st">&quot;image/&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Download original image from S3</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">byte</span><span class="op">[]</span> imageData <span class="op">=</span> s3Manager<span class="op">.</span><span class="fu">downloadFile</span><span class="op">(</span>bucket<span class="op">,</span> metadata<span class="op">.</span><span class="fu">getS3Key</span><span class="op">());</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Generate 3 sizes</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">byte</span><span class="op">[]</span> thumb200 <span class="op">=</span> <span class="fu">resizeImage</span><span class="op">(</span>imageData<span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="dv">200</span><span class="op">);</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">byte</span><span class="op">[]</span> thumb500 <span class="op">=</span> <span class="fu">resizeImage</span><span class="op">(</span>imageData<span class="op">,</span> <span class="dv">500</span><span class="op">,</span> <span class="dv">500</span><span class="op">);</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">byte</span><span class="op">[]</span> thumb1000 <span class="op">=</span> <span class="fu">resizeImage</span><span class="op">(</span>imageData<span class="op">,</span> <span class="dv">1000</span><span class="op">,</span> <span class="dv">1000</span><span class="op">);</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Upload thumbnails back to S3</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>        s3Manager<span class="op">.</span><span class="fu">uploadFile</span><span class="op">(</span>bucket<span class="op">,</span> metadata<span class="op">.</span><span class="fu">getS3Key</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;_thumb_200&quot;</span><span class="op">,</span> thumb200<span class="op">,</span> <span class="st">&quot;image/jpeg&quot;</span><span class="op">);</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>        s3Manager<span class="op">.</span><span class="fu">uploadFile</span><span class="op">(</span>bucket<span class="op">,</span> metadata<span class="op">.</span><span class="fu">getS3Key</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;_thumb_500&quot;</span><span class="op">,</span> thumb500<span class="op">,</span> <span class="st">&quot;image/jpeg&quot;</span><span class="op">);</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>        s3Manager<span class="op">.</span><span class="fu">uploadFile</span><span class="op">(</span>bucket<span class="op">,</span> metadata<span class="op">.</span><span class="fu">getS3Key</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;_thumb_1000&quot;</span><span class="op">,</span> thumb1000<span class="op">,</span> <span class="st">&quot;image/jpeg&quot;</span><span class="op">);</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>2. Scan for Viruses:</strong></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">scanForViruses</span><span class="op">(</span>FileMetadata metadata<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Download file from S3</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">byte</span><span class="op">[]</span> fileData <span class="op">=</span> s3Manager<span class="op">.</span><span class="fu">downloadFile</span><span class="op">(</span>bucket<span class="op">,</span> metadata<span class="op">.</span><span class="fu">getS3Key</span><span class="op">());</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Call virus scanning API (e.g., ClamAV)</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">boolean</span> isClean <span class="op">=</span> virusScanner<span class="op">.</span><span class="fu">scan</span><span class="op">(</span>fileData<span class="op">);</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>isClean<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Quarantine file</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>        s3Manager<span class="op">.</span><span class="fu">deleteFile</span><span class="op">(</span>bucket<span class="op">,</span> metadata<span class="op">.</span><span class="fu">getS3Key</span><span class="op">());</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>        fileRepository<span class="op">.</span><span class="fu">deleteFileMetadata</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">getId</span><span class="op">());</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Notify user</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>        emailService<span class="op">.</span><span class="fu">send</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">getUploadedBy</span><span class="op">(),</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Your file was removed due to security concerns&quot;</span><span class="op">);</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>3. Update Search Index:</strong></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">updateSearchIndex</span><span class="op">(</span>FileMetadata metadata<span class="op">)</span> <span class="op">{</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create search document</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    SearchDocument doc <span class="op">=</span> <span class="kw">new</span> <span class="fu">SearchDocument</span><span class="op">();</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    doc<span class="op">.</span><span class="fu">setId</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">getId</span><span class="op">());</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    doc<span class="op">.</span><span class="fu">setTitle</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">getFilename</span><span class="op">());</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    doc<span class="op">.</span><span class="fu">setContent</span><span class="op">(</span><span class="fu">extractText</span><span class="op">(</span>metadata<span class="op">));</span>  <span class="co">// OCR for images, parse PDF, etc.</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    doc<span class="op">.</span><span class="fu">setUser</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">getUploadedBy</span><span class="op">());</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    doc<span class="op">.</span><span class="fu">setTimestamp</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">getUploadedAt</span><span class="op">());</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Index in Elasticsearch</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    elasticsearchClient<span class="op">.</span><span class="fu">index</span><span class="op">(</span><span class="st">&quot;files&quot;</span><span class="op">,</span> doc<span class="op">);</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>4. Send Notification:</strong></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">sendNotification</span><span class="op">(</span>FileMetadata metadata<span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Send email</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    emailService<span class="op">.</span><span class="fu">send</span><span class="op">(</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>        metadata<span class="op">.</span><span class="fu">getUploadedBy</span><span class="op">(),</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;File uploaded successfully&quot;</span><span class="op">,</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Your file &#39;&quot;</span> <span class="op">+</span> metadata<span class="op">.</span><span class="fu">getFilename</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;&#39; is ready!&quot;</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Push notification</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>    pushService<span class="op">.</span><span class="fu">send</span><span class="op">(</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>        metadata<span class="op">.</span><span class="fu">getUploadedBy</span><span class="op">(),</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;File uploaded&quot;</span><span class="op">,</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>        metadata<span class="op">.</span><span class="fu">getFilename</span><span class="op">()</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update user&#39;s notification feed</span></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>    notificationRepository<span class="op">.</span><span class="fu">create</span><span class="op">(</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>        metadata<span class="op">.</span><span class="fu">getUploadedBy</span><span class="op">(),</span></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;FILE_UPLOADED&quot;</span><span class="op">,</span></span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>        metadata<span class="op">.</span><span class="fu">getId</span><span class="op">()</span></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h4 id="step-11-commit-offset">Step 11: Commit Offset</h4>
<p><strong>File</strong>: <code>FileEventConsumer.java:102</code></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>consumer<span class="op">.</span><span class="fu">commitSync</span><span class="op">();</span></span></code></pre></div>
<p><strong>Network Request:</strong></p>
<pre><code>Java App → Kafka
└─▶ OFFSET_COMMIT request
    Group: complete-integration-group
    Offsets: {
      file-events-0: 0,
      file-events-1: 43,  // We processed message at offset 42
      file-events-2: 0
    }

    ◀── Response:
        Status: SUCCESS</code></pre>
<p><strong>What This Means:</strong> - If consumer crashes and restarts,
it will resume from offset 43 - Message at offset 42 won’t be processed
again - Ensures “exactly-once” processing (with proper
configuration)</p>
<hr />
<h3 id="complete-timeline-summary">Complete Timeline Summary</h3>
<pre><code>Time    | Component           | Action                           | Duration
--------|---------------------|----------------------------------|----------
0.000s  | User                | Clicks &quot;Upload&quot;                  | -
0.001s  | Browser             | Sends HTTP POST to Java app      | -
0.002s  | Java App            | Receives file (10 MB)            | -
0.003s  | S3Manager           | Starts upload to MinIO           | -
0.500s  | MinIO               | File uploaded ✅                 | 497ms
0.501s  | FileRepository      | Starts DB insert                 | -
0.520s  | PostgreSQL          | Row inserted ✅                  | 19ms
0.521s  | FileEventProducer   | Creates JSON event               | -
0.522s  | Kafka               | Event stored ✅                  | 1ms
0.523s  | Java App            | Returns HTTP 200 to user         | -
0.524s  | User                | Sees &quot;Upload successful!&quot; ✅     | Total: 524ms
        |                     |                                  |
1.000s  | Consumer            | Polls Kafka                      | -
1.001s  | Kafka               | Returns event                    | 1ms
1.002s  | Event Handler       | Starts processing                | -
2.000s  | Thumbnail Gen       | Generates 3 thumbnails           | 998ms
10.000s | Virus Scanner       | Scans file                       | 8000ms
12.000s | Search Indexer      | Updates Elasticsearch            | 2000ms
13.000s | Notification        | Sends email &amp; push               | 1000ms
13.001s | Consumer            | Commits offset ✅                | -
        |                     |                                  |
TOTAL   | User perceived time | 524ms                            |
TOTAL   | Background processing | 12.5 seconds (asynchronous)     |</code></pre>
<hr />
<p><a name="real-world"></a> ## 10. Real-World Applications</p>
<h3 id="case-study-1-instagram-photo-upload">Case Study 1: Instagram
Photo Upload</h3>
<p><strong>Architecture:</strong></p>
<pre><code>User uploads photo → Instagram API
                          ↓
                    [1] Upload to S3
                          ↓
                    [2] Save to MySQL (metadata)
                          ↓
                    [3] Publish Kafka event: &quot;photo.uploaded&quot;
                          ↓
              ┌───────────┼───────────┐
              ↓           ↓           ↓
        [Thumbnail]  [AI Filter] [Feed Update]
         Service      Service     Service
              ↓           ↓           ↓
        Generate     Apply ML     Update
        3 sizes      models       followers&#39;
                                  feeds</code></pre>
<p><strong>Our Implementation Maps To:</strong> -
<code>S3Manager.uploadFile()</code> → Instagram’s photo storage -
<code>FileRepository.insertFileMetadata()</code> → Instagram’s post
metadata - <code>FileEventProducer.sendUploadedEvent()</code> →
Instagram’s event system - <code>FileEventConsumer</code> → Instagram’s
background processors</p>
<p><strong>Scale:</strong> - 95 million photos uploaded per day - 1,100
photos per second - Each photo generates ~20 events - 22,000 events per
second processed</p>
<hr />
<h3 id="case-study-2-netflix-video-upload">Case Study 2: Netflix Video
Upload</h3>
<p><strong>Architecture:</strong></p>
<pre><code>Content provider uploads video → Netflix API
                                      ↓
                                [1] Upload to S3 (original)
                                      ↓
                                [2] Save to Cassandra (metadata)
                                      ↓
                                [3] Publish Kafka event: &quot;video.uploaded&quot;
                                      ↓
                    ┌─────────────────┼─────────────────┐
                    ↓                 ↓                 ↓
              [Transcoder]      [Thumbnail]      [Subtitle]
               Service           Generator        Extractor
                    ↓                 ↓                 ↓
              Generate           Create 5          Extract
              1080p, 720p,      thumbnails        audio for
              480p, 360p,       at different      subtitles
              240p versions     timestamps</code></pre>
<p><strong>Transcoding Pipeline:</strong></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Similar to our event handler</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>Consumer<span class="op">&lt;</span>VideoEvent<span class="op">&gt;</span> transcodingHandler <span class="op">=</span> event <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    VideoMetadata video <span class="op">=</span> event<span class="op">.</span><span class="fu">getVideoMetadata</span><span class="op">();</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Download original from S3</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">byte</span><span class="op">[]</span> originalVideo <span class="op">=</span> s3Manager<span class="op">.</span><span class="fu">downloadFile</span><span class="op">(</span>bucket<span class="op">,</span> video<span class="op">.</span><span class="fu">getS3Key</span><span class="op">());</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Transcode to multiple qualities</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">byte</span><span class="op">[]</span> video1080p <span class="op">=</span> <span class="fu">transcode</span><span class="op">(</span>originalVideo<span class="op">,</span> <span class="st">&quot;1080p&quot;</span><span class="op">);</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">byte</span><span class="op">[]</span> video720p <span class="op">=</span> <span class="fu">transcode</span><span class="op">(</span>originalVideo<span class="op">,</span> <span class="st">&quot;720p&quot;</span><span class="op">);</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">byte</span><span class="op">[]</span> video480p <span class="op">=</span> <span class="fu">transcode</span><span class="op">(</span>originalVideo<span class="op">,</span> <span class="st">&quot;480p&quot;</span><span class="op">);</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">byte</span><span class="op">[]</span> video360p <span class="op">=</span> <span class="fu">transcode</span><span class="op">(</span>originalVideo<span class="op">,</span> <span class="st">&quot;360p&quot;</span><span class="op">);</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">byte</span><span class="op">[]</span> video240p <span class="op">=</span> <span class="fu">transcode</span><span class="op">(</span>originalVideo<span class="op">,</span> <span class="st">&quot;240p&quot;</span><span class="op">);</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Upload all versions back to S3</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>    s3Manager<span class="op">.</span><span class="fu">uploadFile</span><span class="op">(</span>bucket<span class="op">,</span> video<span class="op">.</span><span class="fu">getS3Key</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;_1080p&quot;</span><span class="op">,</span> video1080p<span class="op">,</span> <span class="st">&quot;video/mp4&quot;</span><span class="op">);</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>    s3Manager<span class="op">.</span><span class="fu">uploadFile</span><span class="op">(</span>bucket<span class="op">,</span> video<span class="op">.</span><span class="fu">getS3Key</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;_720p&quot;</span><span class="op">,</span> video720p<span class="op">,</span> <span class="st">&quot;video/mp4&quot;</span><span class="op">);</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... and so on</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Publish event: &quot;video.transcoded&quot;</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>    eventProducer<span class="op">.</span><span class="fu">sendTranscodedEvent</span><span class="op">(</span>video<span class="op">);</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>Scale:</strong> - Netflix processes thousands of hours of new
content per month - Each video generates 5 quality versions + multiple
thumbnails - Transcoding can take hours for a 2-hour movie - All done
asynchronously while content provider sees immediate confirmation</p>
<hr />
<h3 id="case-study-3-dropbox-file-sync">Case Study 3: Dropbox File
Sync</h3>
<p><strong>Architecture:</strong></p>
<pre><code>User uploads file to Dropbox → Dropbox API
                                    ↓
                              [1] Upload to S3 (chunked)
                                    ↓
                              [2] Save to MySQL (file metadata)
                                    ↓
                              [3] Publish Kafka event: &quot;file.changed&quot;
                                    ↓
                    ┌───────────────┼───────────────┐
                    ↓               ↓               ↓
              [Sync Service]  [Preview Gen]  [Version History]
                    ↓               ↓               ↓
              Notify all      Generate         Create
              devices with    preview for      snapshot for
              this folder     supported        rollback
                              file types</code></pre>
<p><strong>File Chunking</strong> (How Dropbox uploads large files):</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">uploadLargeFile</span><span class="op">(</span><span class="bu">String</span> filename<span class="op">,</span> <span class="dt">byte</span><span class="op">[]</span> fileData<span class="op">)</span> <span class="op">{</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> CHUNK_SIZE <span class="op">=</span> <span class="dv">4</span> <span class="op">*</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span><span class="op">;</span>  <span class="co">// 4 MB chunks</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> numChunks <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span><span class="op">((</span><span class="dt">double</span><span class="op">)</span> fileData<span class="op">.</span><span class="fu">length</span> <span class="op">/</span> CHUNK_SIZE<span class="op">);</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> uploadSessionId <span class="op">=</span> <span class="bu">UUID</span><span class="op">.</span><span class="fu">randomUUID</span><span class="op">().</span><span class="fu">toString</span><span class="op">();</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> numChunks<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> start <span class="op">=</span> i <span class="op">*</span> CHUNK_SIZE<span class="op">;</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> end <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span><span class="op">(</span>start <span class="op">+</span> CHUNK_SIZE<span class="op">,</span> fileData<span class="op">.</span><span class="fu">length</span><span class="op">);</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">byte</span><span class="op">[]</span> chunk <span class="op">=</span> <span class="bu">Arrays</span><span class="op">.</span><span class="fu">copyOfRange</span><span class="op">(</span>fileData<span class="op">,</span> start<span class="op">,</span> end<span class="op">);</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Upload chunk</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>        s3Manager<span class="op">.</span><span class="fu">uploadFilePart</span><span class="op">(</span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>            bucket<span class="op">,</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>            uploadSessionId<span class="op">,</span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>            i<span class="op">,</span>  <span class="co">// Part number</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>            chunk</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>        logger<span class="op">.</span><span class="fu">info</span><span class="op">(</span><span class="st">&quot;Uploaded chunk {}/{}&quot;</span><span class="op">,</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> numChunks<span class="op">);</span></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Complete multipart upload</span></span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> s3Key <span class="op">=</span> s3Manager<span class="op">.</span><span class="fu">completeMultipartUpload</span><span class="op">(</span>uploadSessionId<span class="op">,</span> filename<span class="op">);</span></span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Save metadata and publish event</span></span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveMetadataAndPublishEvent</span><span class="op">(</span>s3Key<span class="op">,</span> filename<span class="op">,</span> fileData<span class="op">.</span><span class="fu">length</span><span class="op">);</span></span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h3 id="case-study-4-uber-ride-tracking">Case Study 4: Uber Ride
Tracking</h3>
<p><strong>Architecture (Simplified):</strong></p>
<pre><code>Driver&#39;s phone sends GPS update → Uber API
                                       ↓
                                 [1] Save to Redis (current location)
                                       ↓
                                 [2] Save to PostgreSQL (location history)
                                       ↓
                                 [3] Publish Kafka event: &quot;driver.location.updated&quot;
                                       ↓
                    ┌──────────────────┼──────────────────┐
                    ↓                  ↓                  ↓
              [Rider App]        [Analytics]        [Heatmap]
               Update            Track driver        Update
               rider&#39;s map       patterns           city heatmap</code></pre>
<p><strong>Real-time Location Updates:</strong></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>Consumer<span class="op">&lt;</span>LocationEvent<span class="op">&gt;</span> locationHandler <span class="op">=</span> event <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>    DriverLocation location <span class="op">=</span> event<span class="op">.</span><span class="fu">getLocation</span><span class="op">();</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update Redis (fast, in-memory)</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    redisClient<span class="op">.</span><span class="fu">set</span><span class="op">(</span><span class="st">&quot;driver:&quot;</span> <span class="op">+</span> location<span class="op">.</span><span class="fu">getDriverId</span><span class="op">(),</span> location<span class="op">);</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Save to PostgreSQL (persistent history)</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>    locationRepository<span class="op">.</span><span class="fu">insertLocation</span><span class="op">(</span>location<span class="op">);</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Find nearby riders looking for rides</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>Rider<span class="op">&gt;</span> nearbyRiders <span class="op">=</span> <span class="fu">findRidersNearLocation</span><span class="op">(</span>location<span class="op">);</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Notify each rider</span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>Rider rider <span class="op">:</span> nearbyRiders<span class="op">)</span> <span class="op">{</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pushNotification</span><span class="op">(</span>rider<span class="op">,</span> <span class="st">&quot;Driver nearby!&quot;</span><span class="op">);</span></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update city heatmap</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>    heatmapService<span class="op">.</span><span class="fu">updateCell</span><span class="op">(</span>location<span class="op">.</span><span class="fu">getLat</span><span class="op">(),</span> location<span class="op">.</span><span class="fu">getLon</span><span class="op">());</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<hr />
<h3 id="case-study-5-e-commerce-order-processing">Case Study 5:
E-commerce Order Processing</h3>
<p><strong>Architecture:</strong></p>
<pre><code>User places order → E-commerce API
                          ↓
                    [1] Save to PostgreSQL (order)
                          ↓
                    [2] Publish Kafka event: &quot;order.placed&quot;
                          ↓
        ┌─────────────────┼─────────────────┐
        ↓                 ↓                 ↓
   [Payment]        [Inventory]        [Notification]
    Service          Service             Service
        ↓                 ↓                 ↓
   Charge          Decrease            Send email
   credit card     stock count         confirmation
        ↓                 ↓                 ↓
   Publish         Publish             -
   &quot;paid&quot;          &quot;reserved&quot;
        ↓                 ↓
        └─────────────────┼─────────────────┐
                          ↓
                    [Shipping Service]
                          ↓
                    Create shipping label
                          ↓
                    Publish &quot;shipped&quot;
                          ↓
                    [Tracking Service]
                          ↓
                    Start tracking</code></pre>
<p><strong>Order Processing Flow:</strong></p>
<div class="sourceCode" id="cb108"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Order placement</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">placeOrder</span><span class="op">(</span>Order order<span class="op">)</span> <span class="op">{</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Save order to database</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    orderRepository<span class="op">.</span><span class="fu">insertOrder</span><span class="op">(</span>order<span class="op">);</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Publish event</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>    kafkaProducer<span class="op">.</span><span class="fu">send</span><span class="op">(</span><span class="st">&quot;order-events&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">OrderEvent</span><span class="op">(</span><span class="st">&quot;PLACED&quot;</span><span class="op">,</span> order<span class="op">));</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Payment processor</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>Consumer<span class="op">&lt;</span>OrderEvent<span class="op">&gt;</span> paymentHandler <span class="op">=</span> event <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span><span class="fu">getType</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;PLACED&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>        Order order <span class="op">=</span> event<span class="op">.</span><span class="fu">getOrder</span><span class="op">();</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Charge credit card</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">boolean</span> success <span class="op">=</span> paymentGateway<span class="op">.</span><span class="fu">charge</span><span class="op">(</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>            order<span class="op">.</span><span class="fu">getPaymentMethod</span><span class="op">(),</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>            order<span class="op">.</span><span class="fu">getTotalAmount</span><span class="op">()</span></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>success<span class="op">)</span> <span class="op">{</span></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Update order status</span></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>            orderRepository<span class="op">.</span><span class="fu">updateStatus</span><span class="op">(</span>order<span class="op">.</span><span class="fu">getId</span><span class="op">(),</span> <span class="st">&quot;PAID&quot;</span><span class="op">);</span></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Publish payment success event</span></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>            kafkaProducer<span class="op">.</span><span class="fu">send</span><span class="op">(</span><span class="st">&quot;order-events&quot;</span><span class="op">,</span></span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>                <span class="kw">new</span> <span class="fu">OrderEvent</span><span class="op">(</span><span class="st">&quot;PAID&quot;</span><span class="op">,</span> order<span class="op">));</span></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Handle payment failure</span></span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>            orderRepository<span class="op">.</span><span class="fu">updateStatus</span><span class="op">(</span>order<span class="op">.</span><span class="fu">getId</span><span class="op">(),</span> <span class="st">&quot;PAYMENT_FAILED&quot;</span><span class="op">);</span></span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>            kafkaProducer<span class="op">.</span><span class="fu">send</span><span class="op">(</span><span class="st">&quot;order-events&quot;</span><span class="op">,</span></span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>                <span class="kw">new</span> <span class="fu">OrderEvent</span><span class="op">(</span><span class="st">&quot;PAYMENT_FAILED&quot;</span><span class="op">,</span> order<span class="op">));</span></span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a><span class="co">// Inventory manager</span></span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a>Consumer<span class="op">&lt;</span>OrderEvent<span class="op">&gt;</span> inventoryHandler <span class="op">=</span> event <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span><span class="fu">getType</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;PAID&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a>        Order order <span class="op">=</span> event<span class="op">.</span><span class="fu">getOrder</span><span class="op">();</span></span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Decrease stock for each item</span></span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span>OrderItem item <span class="op">:</span> order<span class="op">.</span><span class="fu">getItems</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a>            inventoryRepository<span class="op">.</span><span class="fu">decreaseStock</span><span class="op">(</span></span>
<span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a>                item<span class="op">.</span><span class="fu">getProductId</span><span class="op">(),</span></span>
<span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a>                item<span class="op">.</span><span class="fu">getQuantity</span><span class="op">()</span></span>
<span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a>            <span class="op">);</span></span>
<span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb108-49"><a href="#cb108-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-50"><a href="#cb108-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Publish inventory reserved event</span></span>
<span id="cb108-51"><a href="#cb108-51" aria-hidden="true" tabindex="-1"></a>        kafkaProducer<span class="op">.</span><span class="fu">send</span><span class="op">(</span><span class="st">&quot;order-events&quot;</span><span class="op">,</span></span>
<span id="cb108-52"><a href="#cb108-52" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> <span class="fu">OrderEvent</span><span class="op">(</span><span class="st">&quot;INVENTORY_RESERVED&quot;</span><span class="op">,</span> order<span class="op">));</span></span>
<span id="cb108-53"><a href="#cb108-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb108-54"><a href="#cb108-54" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb108-55"><a href="#cb108-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-56"><a href="#cb108-56" aria-hidden="true" tabindex="-1"></a><span class="co">// Shipping service</span></span>
<span id="cb108-57"><a href="#cb108-57" aria-hidden="true" tabindex="-1"></a>Consumer<span class="op">&lt;</span>OrderEvent<span class="op">&gt;</span> shippingHandler <span class="op">=</span> event <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb108-58"><a href="#cb108-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span><span class="fu">getType</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span><span class="st">&quot;INVENTORY_RESERVED&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb108-59"><a href="#cb108-59" aria-hidden="true" tabindex="-1"></a>        Order order <span class="op">=</span> event<span class="op">.</span><span class="fu">getOrder</span><span class="op">();</span></span>
<span id="cb108-60"><a href="#cb108-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-61"><a href="#cb108-61" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Create shipping label</span></span>
<span id="cb108-62"><a href="#cb108-62" aria-hidden="true" tabindex="-1"></a>        ShippingLabel label <span class="op">=</span> shippingService<span class="op">.</span><span class="fu">createLabel</span><span class="op">(</span>order<span class="op">);</span></span>
<span id="cb108-63"><a href="#cb108-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-64"><a href="#cb108-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Update order with tracking number</span></span>
<span id="cb108-65"><a href="#cb108-65" aria-hidden="true" tabindex="-1"></a>        orderRepository<span class="op">.</span><span class="fu">updateTrackingNumber</span><span class="op">(</span></span>
<span id="cb108-66"><a href="#cb108-66" aria-hidden="true" tabindex="-1"></a>            order<span class="op">.</span><span class="fu">getId</span><span class="op">(),</span></span>
<span id="cb108-67"><a href="#cb108-67" aria-hidden="true" tabindex="-1"></a>            label<span class="op">.</span><span class="fu">getTrackingNumber</span><span class="op">()</span></span>
<span id="cb108-68"><a href="#cb108-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb108-69"><a href="#cb108-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-70"><a href="#cb108-70" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Publish shipped event</span></span>
<span id="cb108-71"><a href="#cb108-71" aria-hidden="true" tabindex="-1"></a>        kafkaProducer<span class="op">.</span><span class="fu">send</span><span class="op">(</span><span class="st">&quot;order-events&quot;</span><span class="op">,</span></span>
<span id="cb108-72"><a href="#cb108-72" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> <span class="fu">OrderEvent</span><span class="op">(</span><span class="st">&quot;SHIPPED&quot;</span><span class="op">,</span> order<span class="op">));</span></span>
<span id="cb108-73"><a href="#cb108-73" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb108-74"><a href="#cb108-74" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb108-75"><a href="#cb108-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-76"><a href="#cb108-76" aria-hidden="true" tabindex="-1"></a><span class="co">// Notification service</span></span>
<span id="cb108-77"><a href="#cb108-77" aria-hidden="true" tabindex="-1"></a>Consumer<span class="op">&lt;</span>OrderEvent<span class="op">&gt;</span> notificationHandler <span class="op">=</span> event <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb108-78"><a href="#cb108-78" aria-hidden="true" tabindex="-1"></a>    Order order <span class="op">=</span> event<span class="op">.</span><span class="fu">getOrder</span><span class="op">();</span></span>
<span id="cb108-79"><a href="#cb108-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-80"><a href="#cb108-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>event<span class="op">.</span><span class="fu">getType</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb108-81"><a href="#cb108-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">&quot;PLACED&quot;</span><span class="op">:</span></span>
<span id="cb108-82"><a href="#cb108-82" aria-hidden="true" tabindex="-1"></a>            emailService<span class="op">.</span><span class="fu">send</span><span class="op">(</span>order<span class="op">.</span><span class="fu">getCustomerEmail</span><span class="op">(),</span></span>
<span id="cb108-83"><a href="#cb108-83" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Order received&quot;</span><span class="op">,</span></span>
<span id="cb108-84"><a href="#cb108-84" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;We&#39;ve received your order #&quot;</span> <span class="op">+</span> order<span class="op">.</span><span class="fu">getId</span><span class="op">());</span></span>
<span id="cb108-85"><a href="#cb108-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb108-86"><a href="#cb108-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-87"><a href="#cb108-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">&quot;PAID&quot;</span><span class="op">:</span></span>
<span id="cb108-88"><a href="#cb108-88" aria-hidden="true" tabindex="-1"></a>            emailService<span class="op">.</span><span class="fu">send</span><span class="op">(</span>order<span class="op">.</span><span class="fu">getCustomerEmail</span><span class="op">(),</span></span>
<span id="cb108-89"><a href="#cb108-89" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Payment confirmed&quot;</span><span class="op">,</span></span>
<span id="cb108-90"><a href="#cb108-90" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Your payment has been processed&quot;</span><span class="op">);</span></span>
<span id="cb108-91"><a href="#cb108-91" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb108-92"><a href="#cb108-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-93"><a href="#cb108-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">&quot;SHIPPED&quot;</span><span class="op">:</span></span>
<span id="cb108-94"><a href="#cb108-94" aria-hidden="true" tabindex="-1"></a>            emailService<span class="op">.</span><span class="fu">send</span><span class="op">(</span>order<span class="op">.</span><span class="fu">getCustomerEmail</span><span class="op">(),</span></span>
<span id="cb108-95"><a href="#cb108-95" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Order shipped&quot;</span><span class="op">,</span></span>
<span id="cb108-96"><a href="#cb108-96" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Track your order: &quot;</span> <span class="op">+</span> order<span class="op">.</span><span class="fu">getTrackingNumber</span><span class="op">());</span></span>
<span id="cb108-97"><a href="#cb108-97" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb108-98"><a href="#cb108-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-99"><a href="#cb108-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">&quot;PAYMENT_FAILED&quot;</span><span class="op">:</span></span>
<span id="cb108-100"><a href="#cb108-100" aria-hidden="true" tabindex="-1"></a>            emailService<span class="op">.</span><span class="fu">send</span><span class="op">(</span>order<span class="op">.</span><span class="fu">getCustomerEmail</span><span class="op">(),</span></span>
<span id="cb108-101"><a href="#cb108-101" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Payment failed&quot;</span><span class="op">,</span></span>
<span id="cb108-102"><a href="#cb108-102" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Please update your payment method&quot;</span><span class="op">);</span></span>
<span id="cb108-103"><a href="#cb108-103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb108-104"><a href="#cb108-104" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb108-105"><a href="#cb108-105" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>Why Event-Driven Architecture Wins Here:</strong> -
<strong>Decoupling</strong>: Payment failure doesn’t crash inventory
system - <strong>Scalability</strong>: Each service scales independently
- <strong>Resilience</strong>: If email service is down, order still
processes - <strong>Auditability</strong>: Complete event log of order
lifecycle - <strong>Flexibility</strong>: Easy to add new services
(fraud detection, recommendations, etc.)</p>
<hr />
<p><a name="concepts"></a> ## 11. Key Concepts for Beginners</p>
<h3 id="event-driven-architecture">1. Event-Driven Architecture</h3>
<p><strong>Traditional (Synchronous):</strong></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Caller waits for each step to complete</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">uploadFile</span><span class="op">(</span><span class="bu">File</span> file<span class="op">)</span> <span class="op">{</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    s3<span class="op">.</span><span class="fu">upload</span><span class="op">(</span>file<span class="op">);</span>           <span class="co">// Wait 3 seconds</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    database<span class="op">.</span><span class="fu">save</span><span class="op">(</span>metadata<span class="op">);</span>   <span class="co">// Wait 0.5 seconds</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>    thumbnail<span class="op">.</span><span class="fu">generate</span><span class="op">(</span>file<span class="op">);</span>  <span class="co">// Wait 10 seconds</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>    virus<span class="op">.</span><span class="fu">scan</span><span class="op">(</span>file<span class="op">);</span>          <span class="co">// Wait 15 seconds</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>    email<span class="op">.</span><span class="fu">send</span><span class="op">(</span>notification<span class="op">);</span>  <span class="co">// Wait 2 seconds</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Total wait: 30.5 seconds 😴</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Event-Driven (Asynchronous):</strong></p>
<div class="sourceCode" id="cb110"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Caller returns immediately</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">uploadFile</span><span class="op">(</span><span class="bu">File</span> file<span class="op">)</span> <span class="op">{</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    s3<span class="op">.</span><span class="fu">upload</span><span class="op">(</span>file<span class="op">);</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    database<span class="op">.</span><span class="fu">save</span><span class="op">(</span>metadata<span class="op">);</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>    kafka<span class="op">.</span><span class="fu">publish</span><span class="op">(</span><span class="st">&quot;file.uploaded&quot;</span><span class="op">,</span> metadata<span class="op">);</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Returns immediately! ⚡ (3.5 seconds)</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Background services process independently</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">onFileUploaded</span><span class="op">(</span>FileEvent event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>    thumbnail<span class="op">.</span><span class="fu">generate</span><span class="op">(</span>event<span class="op">.</span><span class="fu">file</span><span class="op">);</span>   <span class="co">// Service 1</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">onFileUploaded</span><span class="op">(</span>FileEvent event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>    virus<span class="op">.</span><span class="fu">scan</span><span class="op">(</span>event<span class="op">.</span><span class="fu">file</span><span class="op">);</span>           <span class="co">// Service 2</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">onFileUploaded</span><span class="op">(</span>FileEvent event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>    email<span class="op">.</span><span class="fu">send</span><span class="op">(</span>notification<span class="op">);</span>         <span class="co">// Service 3</span></span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Benefits:</strong> - ✅ Fast response to user - ✅ Services
don’t block each other - ✅ Easy to add new services - ✅ Handles
failures gracefully</p>
<hr />
<h3 id="microservices-architecture">2. Microservices Architecture</h3>
<p><strong>Monolith (All in one):</strong></p>
<pre><code>┌──────────────────────────────────────┐
│         SINGLE APPLICATION           │
│                                      │
│  • File Upload                       │
│  • Thumbnail Generation              │
│  • Virus Scanning                    │
│  • Email Notifications               │
│  • User Management                   │
│  • Payment Processing                │
│                                      │
│  Problem: One bug crashes everything │
└──────────────────────────────────────┘</code></pre>
<p><strong>Microservices (Separate services):</strong></p>
<pre><code>┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│   Upload    │  │  Thumbnail  │  │    Virus    │
│   Service   │  │   Service   │  │   Scanner   │
│             │  │             │  │             │
│  Java       │  │  Python     │  │    Go       │
│  Port 8080  │  │  Port 8081  │  │  Port 8082  │
└─────────────┘  └─────────────┘  └─────────────┘
       │                │                │
       └────────────────┼────────────────┘
                        │
                   ┌─────────┐
                   │  Kafka  │
                   │ (Events)│
                   └─────────┘
                        │
       ┌────────────────┼────────────────┐
       ↓                ↓                ↓
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│    Email    │  │   Search    │  │  Analytics  │
│   Service   │  │  Indexer    │  │   Service   │
│             │  │             │  │             │
│  Node.js    │  │  Python     │  │   Scala     │
│  Port 8083  │  │  Port 8084  │  │  Port 8085  │
└─────────────┘  └─────────────┘  └─────────────┘</code></pre>
<p><strong>Benefits:</strong> - ✅ Independent deployment - ✅
Technology flexibility - ✅ Team autonomy - ✅ Fault isolation - ✅
Independent scaling</p>
<hr />
<h3 id="cap-theorem">3. CAP Theorem</h3>
<p><strong>CAP Theorem</strong>: In a distributed system, you can only
guarantee 2 out of 3:</p>
<ol type="1">
<li><strong>Consistency</strong>: All nodes see the same data at the
same time</li>
<li><strong>Availability</strong>: Every request receives a
response</li>
<li><strong>Partition Tolerance</strong>: System continues despite
network failures</li>
</ol>
<p><strong>Examples:</strong></p>
<p><strong>PostgreSQL</strong> (CP - Consistency + Partition
Tolerance):</p>
<pre><code>Scenario: Network partition between database replicas
Choice: Reject writes to maintain consistency
Result: Some requests fail, but data stays consistent
Use case: Banking (consistency critical)</code></pre>
<p><strong>Cassandra</strong> (AP - Availability + Partition
Tolerance):</p>
<pre><code>Scenario: Network partition between database nodes
Choice: Accept writes on all nodes
Result: All requests succeed, but data may be inconsistent temporarily
Use case: Social media (availability critical)</code></pre>
<p><strong>Our Architecture:</strong> - <strong>PostgreSQL</strong>: CP
(consistency for metadata) - <strong>S3/MinIO</strong>: AP (availability
for file storage) - <strong>Kafka</strong>: AP (availability for event
delivery)</p>
<hr />
<h3 id="acid-vs-base">4. ACID vs BASE</h3>
<p><strong>ACID</strong> (Traditional databases): -
<strong>A</strong>tomicity: All or nothing -
<strong>C</strong>onsistency: Data always valid -
<strong>I</strong>solation: Transactions don’t interfere -
<strong>D</strong>urability: Committed data persists</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Bank transfer - ACID</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">beginTransaction</span><span class="op">();</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    account1<span class="op">.</span><span class="fu">subtract</span><span class="op">(</span><span class="dv">100</span><span class="op">);</span>  <span class="co">// Must succeed</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>    account2<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">100</span><span class="op">);</span>       <span class="co">// Must succeed</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">commit</span><span class="op">();</span>                 <span class="co">// Both succeed or both fail</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rollback</span><span class="op">();</span>              <span class="co">// Undo everything</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>BASE</strong> (Modern distributed systems): -
<strong>B</strong>asically <strong>A</strong>vailable: System is always
available - <strong>S</strong>oft state: State may change without input
- <strong>E</strong>ventual consistency: Data becomes consistent
eventually</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">// File upload - BASE</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>s3<span class="op">.</span><span class="fu">upload</span><span class="op">(</span>file<span class="op">);</span>                    <span class="co">// Available immediately</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>kafka<span class="op">.</span><span class="fu">publish</span><span class="op">(</span><span class="st">&quot;file.uploaded&quot;</span><span class="op">);</span>     <span class="co">// Eventually processed</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Thumbnails generated eventually</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Search index updated eventually</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="co">// User notified eventually</span></span></code></pre></div>
<hr />
<h3 id="connection-pooling">5. Connection Pooling</h3>
<p><strong>Without Pooling</strong> (Slow):</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Every request creates a new connection</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">handleRequest</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Connection</span> conn <span class="op">=</span> <span class="bu">DriverManager</span><span class="op">.</span><span class="fu">getConnection</span><span class="op">(</span>url<span class="op">,</span> user<span class="op">,</span> pass<span class="op">);</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Connection creation takes 100ms!</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Do work (10ms)</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Statement</span> stmt <span class="op">=</span> conn<span class="op">.</span><span class="fu">createStatement</span><span class="op">();</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ResultSet</span> rs <span class="op">=</span> stmt<span class="op">.</span><span class="fu">executeQuery</span><span class="op">(</span><span class="st">&quot;SELECT * FROM files&quot;</span><span class="op">);</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>    conn<span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Total: 110ms per request</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>With Pooling</strong> (Fast):</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Connections created once at startup</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>HikariCP pool <span class="op">=</span> <span class="kw">new</span> <span class="fu">HikariCP</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span>  <span class="co">// 10 connections ready</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">handleRequest</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Connection</span> conn <span class="op">=</span> pool<span class="op">.</span><span class="fu">getConnection</span><span class="op">();</span>  <span class="co">// Instant! (0.1ms)</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Do work (10ms)</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Statement</span> stmt <span class="op">=</span> conn<span class="op">.</span><span class="fu">createStatement</span><span class="op">();</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ResultSet</span> rs <span class="op">=</span> stmt<span class="op">.</span><span class="fu">executeQuery</span><span class="op">(</span><span class="st">&quot;SELECT * FROM files&quot;</span><span class="op">);</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>    conn<span class="op">.</span><span class="fu">close</span><span class="op">();</span>  <span class="co">// Returns to pool, doesn&#39;t actually close</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Total: 10ms per request (11x faster!)</span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Benefits:</strong> - ✅ 10-100x faster - ✅ Less resource
usage - ✅ Automatic connection management - ✅ Connection health
checks</p>
<hr />
<h3 id="serialization-deserialization">6. Serialization &amp;
Deserialization</h3>
<p><strong>Serialization</strong>: Converting objects to bytes/string
<strong>Deserialization</strong>: Converting bytes/string back to
objects</p>
<p><strong>Example with JSON:</strong></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Java Object</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>FileMetadata metadata <span class="op">=</span> <span class="kw">new</span> <span class="fu">FileMetadata</span><span class="op">(</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;123&quot;</span><span class="op">,</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;photo.jpg&quot;</span><span class="op">,</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;uploads/photo.jpg&quot;</span><span class="op">,</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;http://s3.com/photo.jpg&quot;</span><span class="op">,</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2500000L</span><span class="op">,</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;image/jpeg&quot;</span><span class="op">,</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;alice&quot;</span><span class="op">,</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1729090624308L</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Serialization (Object → JSON String)</span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>ObjectMapper mapper <span class="op">=</span> <span class="kw">new</span> <span class="fu">ObjectMapper</span><span class="op">();</span></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> json <span class="op">=</span> mapper<span class="op">.</span><span class="fu">writeValueAsString</span><span class="op">(</span>metadata<span class="op">);</span></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Result: {&quot;id&quot;:&quot;123&quot;,&quot;filename&quot;:&quot;photo.jpg&quot;,...}</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Send JSON over network to Kafka</span></span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Deserialization (JSON String → Object)</span></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a>FileMetadata received <span class="op">=</span> mapper<span class="op">.</span><span class="fu">readValue</span><span class="op">(</span>json<span class="op">,</span> FileMetadata<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Result: FileMetadata object with same values</span></span></code></pre></div>
<p><strong>Why JSON?</strong> - ✅ Human-readable - ✅
Language-independent - ✅ Widely supported - ✅ Easy to debug</p>
<p><strong>Alternatives:</strong> - <strong>Protocol Buffers</strong>:
Faster, smaller, but binary - <strong>Avro</strong>: Schema evolution
support - <strong>MessagePack</strong>: Compact binary format</p>
<hr />
<h3 id="idempotency">7. Idempotency</h3>
<p><strong>Idempotent</strong>: Same operation can be repeated without
different outcome</p>
<p><strong>Non-Idempotent</strong> (Bad):</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">processPayment</span><span class="op">(</span>Order order<span class="op">)</span> <span class="op">{</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If this runs twice, charges customer twice! ❌</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    creditCard<span class="op">.</span><span class="fu">charge</span><span class="op">(</span>order<span class="op">.</span><span class="fu">getTotalAmount</span><span class="op">());</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Idempotent</strong> (Good):</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">processPayment</span><span class="op">(</span>Order order<span class="op">)</span> <span class="op">{</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if already processed</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>paymentRepository<span class="op">.</span><span class="fu">exists</span><span class="op">(</span>order<span class="op">.</span><span class="fu">getId</span><span class="op">()))</span> <span class="op">{</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span>  <span class="co">// Already processed, skip</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Process payment</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>    creditCard<span class="op">.</span><span class="fu">charge</span><span class="op">(</span>order<span class="op">.</span><span class="fu">getTotalAmount</span><span class="op">());</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Mark as processed</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>    paymentRepository<span class="op">.</span><span class="fu">markProcessed</span><span class="op">(</span>order<span class="op">.</span><span class="fu">getId</span><span class="op">());</span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>In Kafka:</strong></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Enable idempotence</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ProducerConfig<span class="op">.</span><span class="fu">ENABLE_IDEMPOTENCE_CONFIG</span><span class="op">,</span> <span class="st">&quot;true&quot;</span><span class="op">);</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Kafka prevents duplicate sends automatically</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="co">// If network fails and retries, Kafka detects duplicate</span></span></code></pre></div>
<hr />
<h3 id="eventual-consistency">8. Eventual Consistency</h3>
<p><strong>Strong Consistency</strong> (Traditional):</p>
<pre><code>User uploads file
  ↓
Write to database (wait for replication to all nodes)
  ↓
Read from database (always sees latest data)</code></pre>
<p><strong>Eventual Consistency</strong> (Distributed):</p>
<pre><code>User uploads file
  ↓
Write to database (write to one node, return immediately)
  ↓
Background: Replicate to other nodes
  ↓
Eventually: All nodes have the same data</code></pre>
<p><strong>Example in Our System:</strong></p>
<pre><code>Time 0:00 - User uploads file
Time 0:01 - File saved to S3, metadata saved to PostgreSQL
Time 0:02 - Kafka event published
Time 0:03 - Consumer starts processing
Time 0:05 - Thumbnails generated
Time 0:10 - Search index updated
Time 0:15 - All systems consistent ✅</code></pre>
<p><strong>During 0:01-0:15:</strong> - File is uploaded ✅ - Metadata
in database ✅ - But thumbnails not ready yet ⏳ - And search doesn’t
show it yet ⏳</p>
<p><strong>Eventually (at 0:15):</strong> - Everything is consistent
✅</p>
<hr />
<h3 id="backpressure">9. Backpressure</h3>
<p><strong>Problem</strong>: Producer sends messages faster than
consumer can process</p>
<p><strong>Without Backpressure</strong> (Bad):</p>
<pre><code>Producer: 1000 messages/second
Consumer: 100 messages/second
Result: Queue grows infinitely, memory overflow! 💥</code></pre>
<p><strong>With Backpressure</strong> (Good):</p>
<pre><code>Consumer tells producer: &quot;Slow down, I can only handle 100/sec&quot;
Producer throttles to match consumer&#39;s capacity
Result: Stable system ✅</code></pre>
<p><strong>In Kafka:</strong></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Consumer automatically handles backpressure</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>consumer<span class="op">.</span><span class="fu">poll</span><span class="op">(</span><span class="bu">Duration</span><span class="op">.</span><span class="fu">ofMillis</span><span class="op">(</span><span class="dv">100</span><span class="op">));</span>  <span class="co">// Fetch as much as can process</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Kafka won&#39;t send more until consumer commits offset</span></span></code></pre></div>
<hr />
<h3 id="schema-evolution">10. Schema Evolution</h3>
<p><strong>Problem</strong>: How to update data structure without
breaking existing code?</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Version 1</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FileMetadata <span class="op">{</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> id<span class="op">;</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> filename<span class="op">;</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Deployed to production, messages sent</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Version 2 (need to add new field)</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FileMetadata <span class="op">{</span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> id<span class="op">;</span></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> filename<span class="op">;</span></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> contentType<span class="op">;</span>  <span class="co">// NEW FIELD</span></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Problem: Old messages don&#39;t have contentType!</span></span></code></pre></div>
<p><strong>Solution 1: Optional Fields</strong></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FileMetadata <span class="op">{</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> id<span class="op">;</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> filename<span class="op">;</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> contentType <span class="op">=</span> <span class="st">&quot;application/octet-stream&quot;</span><span class="op">;</span>  <span class="co">// Default value</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Solution 2: Schema Registry</strong> (Avro, Protobuf):</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Schema Registry tracks versions</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="co">// V1: {id, filename}</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="co">// V2: {id, filename, contentType}</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Consumer knows how to read both versions</span></span></code></pre></div>
<hr />
<p><a name="troubleshooting"></a> ## 12. Troubleshooting &amp; Common
Issues</p>
<h3 id="issue-1-kafka-connection-refused">Issue 1: Kafka Connection
Refused</h3>
<p><strong>Error:</strong></p>
<pre><code>org.apache.kafka.common.errors.TimeoutException:
Failed to update metadata after 60000 ms.</code></pre>
<p><strong>Cause</strong>: Kafka not running or wrong host/port</p>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if Kafka is running</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> ps</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Should see:</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="co"># kafka-broker   Up (healthy)</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="co"># If not running:</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">-d</span> kafka</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Check logs:</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> logs kafka</span></code></pre></div>
<hr />
<h3 id="issue-2-postgresql-connection-failed">Issue 2: PostgreSQL
Connection Failed</h3>
<p><strong>Error:</strong></p>
<pre><code>org.postgresql.util.PSQLException:
Connection refused. Check that the hostname and port are correct.</code></pre>
<p><strong>Cause</strong>: PostgreSQL not running or wrong
credentials</p>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb135"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if PostgreSQL is running</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> ps postgres</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Test connection:</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> exec postgres psql <span class="at">-U</span> admin <span class="at">-d</span> mydb</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co"># If password error, check docker-compose.yml:</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="ex">postgres:</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">environment:</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">POSTGRES_USER:</span> admin        <span class="co"># Must match code</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">POSTGRES_PASSWORD:</span> admin123  <span class="co"># Must match code</span></span></code></pre></div>
<hr />
<h3 id="issue-3-minio-access-denied">Issue 3: MinIO Access Denied</h3>
<p><strong>Error:</strong></p>
<pre><code>software.amazon.awssdk.services.s3.model.S3Exception:
Access Denied (Service: S3, Status Code: 403)</code></pre>
<p><strong>Cause</strong>: Wrong access key/secret key</p>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Check credentials in code</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>S3Manager s3Manager <span class="op">=</span> <span class="kw">new</span> <span class="fu">S3Manager</span><span class="op">(</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;http://localhost:9000&quot;</span><span class="op">,</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;minioadmin&quot;</span><span class="op">,</span>        <span class="co">// Must match docker-compose.yml</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;minioadmin123&quot;</span>      <span class="co">// Must match docker-compose.yml</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span></code></pre></div>
<div class="sourceCode" id="cb138"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check docker-compose.yml</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">minio</span><span class="kw">:</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">MINIO_ROOT_USER</span><span class="kw">:</span><span class="at"> minioadmin</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">MINIO_ROOT_PASSWORD</span><span class="kw">:</span><span class="at"> minioadmin123</span></span></code></pre></div>
<hr />
<h3 id="issue-4-out-of-memory">Issue 4: Out of Memory</h3>
<p><strong>Error:</strong></p>
<pre><code>java.lang.OutOfMemoryError: Java heap space</code></pre>
<p><strong>Cause</strong>: Uploading too large files or too many at
once</p>
<p><strong>Solution 1: Increase JVM memory</strong></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to run command</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-Xmx2g</span> <span class="at">-Xms512m</span> <span class="at">-jar</span> app.jar</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -Xmx2g = max 2 GB</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="co"># -Xms512m = start with 512 MB</span></span></code></pre></div>
<p><strong>Solution 2: Stream large files</strong></p>
<div class="sourceCode" id="cb141"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BAD: Loads entire file into memory</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="dt">byte</span><span class="op">[]</span> fileData <span class="op">=</span> Files<span class="op">.</span><span class="fu">readAllBytes</span><span class="op">(</span>path<span class="op">);</span>  <span class="co">// 1 GB file = 1 GB memory!</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Stream file in chunks</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">(</span><span class="bu">InputStream</span> is <span class="op">=</span> Files<span class="op">.</span><span class="fu">newInputStream</span><span class="op">(</span>path<span class="op">))</span> <span class="op">{</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>    s3Client<span class="op">.</span><span class="fu">putObject</span><span class="op">(</span>request<span class="op">,</span> RequestBody<span class="op">.</span><span class="fu">fromInputStream</span><span class="op">(</span>is<span class="op">,</span> fileSize<span class="op">));</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h3 id="issue-5-kafka-lag-consumer-too-slow">Issue 5: Kafka Lag
(Consumer Too Slow)</h3>
<p><strong>Symptom</strong>: Events processed with significant delay</p>
<p><strong>Diagnosis:</strong></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check consumer lag</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> exec kafka kafka-consumer-groups <span class="dt">\</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">--bootstrap-server</span> localhost:9092 <span class="dt">\</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">--describe</span> <span class="dt">\</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">--group</span> complete-integration-group</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output shows:</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="co"># GROUP                       TOPIC      PARTITION  CURRENT-OFFSET  LAG</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a><span class="co"># complete-integration-group  file-events  0        1000           500</span></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="co"># complete-integration-group  file-events  1        1000           500</span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="co"># complete-integration-group  file-events  2        1000           500</span></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Total lag: 1500 messages behind!</span></span></code></pre></div>
<p><strong>Solution 1: Add more consumers</strong></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Run multiple instances</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="co">// They&#39;ll automatically share the work</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Max consumers = number of partitions (3 in our case)</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Terminal 1</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>java <span class="op">-</span>jar app<span class="op">.</span><span class="fu">jar</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Terminal 2</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>java <span class="op">-</span>jar app<span class="op">.</span><span class="fu">jar</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Terminal 3</span></span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a>java <span class="op">-</span>jar app<span class="op">.</span><span class="fu">jar</span></span></code></pre></div>
<p><strong>Solution 2: Optimize processing</strong></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BAD: Slow processing</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>Consumer<span class="op">&lt;</span>FileEvent<span class="op">&gt;</span> handler <span class="op">=</span> event <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Synchronous processing (slow)</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">generateThumbnails</span><span class="op">(</span>event<span class="op">);</span>    <span class="co">// 10 seconds</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scanVirus</span><span class="op">(</span>event<span class="op">);</span>             <span class="co">// 15 seconds</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sendEmail</span><span class="op">(</span>event<span class="op">);</span>             <span class="co">// 2 seconds</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Total: 27 seconds per event!</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Parallel processing</span></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>Consumer<span class="op">&lt;</span>FileEvent<span class="op">&gt;</span> handler <span class="op">=</span> event <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Async processing (fast)</span></span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>    CompletableFuture<span class="op">.</span><span class="fu">runAsync</span><span class="op">(()</span> <span class="op">-&gt;</span> <span class="fu">generateThumbnails</span><span class="op">(</span>event<span class="op">));</span></span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>    CompletableFuture<span class="op">.</span><span class="fu">runAsync</span><span class="op">(()</span> <span class="op">-&gt;</span> <span class="fu">scanVirus</span><span class="op">(</span>event<span class="op">));</span></span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>    CompletableFuture<span class="op">.</span><span class="fu">runAsync</span><span class="op">(()</span> <span class="op">-&gt;</span> <span class="fu">sendEmail</span><span class="op">(</span>event<span class="op">));</span></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Total: Max 15 seconds per event (3 tasks in parallel)</span></span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<hr />
<h3 id="issue-6-database-deadlock">Issue 6: Database Deadlock</h3>
<p><strong>Error:</strong></p>
<pre><code>org.postgresql.util.PSQLException:
ERROR: deadlock detected</code></pre>
<p><strong>Cause</strong>: Two transactions waiting for each other</p>
<p><strong>Example:</strong></p>
<pre><code>Transaction 1: Lock file A, waiting for file B
Transaction 2: Lock file B, waiting for file A
Result: Deadlock! 💀</code></pre>
<p><strong>Solution: Consistent lock ordering</strong></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BAD: Random order</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">transferFiles</span><span class="op">(</span><span class="bu">String</span> fileId1<span class="op">,</span> <span class="bu">String</span> fileId2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lockFile</span><span class="op">(</span>fileId1<span class="op">);</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lockFile</span><span class="op">(</span>fileId2<span class="op">);</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="co">// GOOD: Always lock in same order</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">transferFiles</span><span class="op">(</span><span class="bu">String</span> fileId1<span class="op">,</span> <span class="bu">String</span> fileId2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> first <span class="op">=</span> fileId1<span class="op">.</span><span class="fu">compareTo</span><span class="op">(</span>fileId2<span class="op">)</span> <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> fileId1 <span class="op">:</span> fileId2<span class="op">;</span></span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> second <span class="op">=</span> fileId1<span class="op">.</span><span class="fu">compareTo</span><span class="op">(</span>fileId2<span class="op">)</span> <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> fileId2 <span class="op">:</span> fileId1<span class="op">;</span></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lockFile</span><span class="op">(</span>first<span class="op">);</span></span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lockFile</span><span class="op">(</span>second<span class="op">);</span></span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h3 id="issue-7-s3-upload-timeout">Issue 7: S3 Upload Timeout</h3>
<p><strong>Error:</strong></p>
<pre><code>software.amazon.awssdk.core.exception.SdkClientException:
Unable to execute HTTP request: Read timed out</code></pre>
<p><strong>Cause</strong>: Large file upload taking too long</p>
<p><strong>Solution 1: Increase timeout</strong></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>S3Client s3Client <span class="op">=</span> S3Client<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">overrideConfiguration</span><span class="op">(</span>config <span class="op">-&gt;</span> config</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">apiCallTimeout</span><span class="op">(</span><span class="bu">Duration</span><span class="op">.</span><span class="fu">ofMinutes</span><span class="op">(</span><span class="dv">10</span><span class="op">))</span>  <span class="co">// 10 min timeout</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">apiCallAttemptTimeout</span><span class="op">(</span><span class="bu">Duration</span><span class="op">.</span><span class="fu">ofMinutes</span><span class="op">(</span><span class="dv">5</span><span class="op">)))</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span></code></pre></div>
<p><strong>Solution 2: Multipart upload for large files</strong></p>
<div class="sourceCode" id="cb150"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">uploadLargeFile</span><span class="op">(</span><span class="bu">String</span> bucket<span class="op">,</span> <span class="bu">String</span> key<span class="op">,</span> <span class="bu">File</span> file<span class="op">)</span> <span class="op">{</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>    CreateMultipartUploadRequest createRequest <span class="op">=</span> CreateMultipartUploadRequest<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">bucket</span><span class="op">(</span>bucket<span class="op">)</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">key</span><span class="op">(</span>key<span class="op">)</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> uploadId <span class="op">=</span> s3Client<span class="op">.</span><span class="fu">createMultipartUpload</span><span class="op">(</span>createRequest<span class="op">).</span><span class="fu">uploadId</span><span class="op">();</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Upload in 5 MB chunks</span></span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> partSize <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span><span class="op">;</span></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> partNumber <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>CompletedPart<span class="op">&gt;</span> completedParts <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">(</span><span class="bu">FileInputStream</span> fis <span class="op">=</span> <span class="kw">new</span> <span class="bu">FileInputStream</span><span class="op">(</span>file<span class="op">))</span> <span class="op">{</span></span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">byte</span><span class="op">[]</span> buffer <span class="op">=</span> <span class="kw">new</span> <span class="dt">byte</span><span class="op">[</span>partSize<span class="op">];</span></span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> bytesRead<span class="op">;</span></span>
<span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-18"><a href="#cb150-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">((</span>bytesRead <span class="op">=</span> fis<span class="op">.</span><span class="fu">read</span><span class="op">(</span>buffer<span class="op">))</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb150-19"><a href="#cb150-19" aria-hidden="true" tabindex="-1"></a>            UploadPartRequest uploadRequest <span class="op">=</span> UploadPartRequest<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb150-20"><a href="#cb150-20" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">bucket</span><span class="op">(</span>bucket<span class="op">)</span></span>
<span id="cb150-21"><a href="#cb150-21" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">key</span><span class="op">(</span>key<span class="op">)</span></span>
<span id="cb150-22"><a href="#cb150-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">uploadId</span><span class="op">(</span>uploadId<span class="op">)</span></span>
<span id="cb150-23"><a href="#cb150-23" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">partNumber</span><span class="op">(</span>partNumber<span class="op">)</span></span>
<span id="cb150-24"><a href="#cb150-24" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb150-25"><a href="#cb150-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-26"><a href="#cb150-26" aria-hidden="true" tabindex="-1"></a>            UploadPartResponse response <span class="op">=</span> s3Client<span class="op">.</span><span class="fu">uploadPart</span><span class="op">(</span>uploadRequest<span class="op">,</span></span>
<span id="cb150-27"><a href="#cb150-27" aria-hidden="true" tabindex="-1"></a>                RequestBody<span class="op">.</span><span class="fu">fromBytes</span><span class="op">(</span><span class="bu">Arrays</span><span class="op">.</span><span class="fu">copyOf</span><span class="op">(</span>buffer<span class="op">,</span> bytesRead<span class="op">)));</span></span>
<span id="cb150-28"><a href="#cb150-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-29"><a href="#cb150-29" aria-hidden="true" tabindex="-1"></a>            completedParts<span class="op">.</span><span class="fu">add</span><span class="op">(</span>CompletedPart<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb150-30"><a href="#cb150-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">partNumber</span><span class="op">(</span>partNumber<span class="op">)</span></span>
<span id="cb150-31"><a href="#cb150-31" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">eTag</span><span class="op">(</span>response<span class="op">.</span><span class="fu">eTag</span><span class="op">())</span></span>
<span id="cb150-32"><a href="#cb150-32" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">());</span></span>
<span id="cb150-33"><a href="#cb150-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-34"><a href="#cb150-34" aria-hidden="true" tabindex="-1"></a>            partNumber<span class="op">++;</span></span>
<span id="cb150-35"><a href="#cb150-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb150-36"><a href="#cb150-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb150-37"><a href="#cb150-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-38"><a href="#cb150-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Complete upload</span></span>
<span id="cb150-39"><a href="#cb150-39" aria-hidden="true" tabindex="-1"></a>    CompleteMultipartUploadRequest completeRequest <span class="op">=</span> CompleteMultipartUploadRequest<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb150-40"><a href="#cb150-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">bucket</span><span class="op">(</span>bucket<span class="op">)</span></span>
<span id="cb150-41"><a href="#cb150-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">key</span><span class="op">(</span>key<span class="op">)</span></span>
<span id="cb150-42"><a href="#cb150-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">uploadId</span><span class="op">(</span>uploadId<span class="op">)</span></span>
<span id="cb150-43"><a href="#cb150-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">multipartUpload</span><span class="op">(</span>CompletedMultipartUpload<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="cb150-44"><a href="#cb150-44" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">parts</span><span class="op">(</span>completedParts<span class="op">)</span></span>
<span id="cb150-45"><a href="#cb150-45" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">())</span></span>
<span id="cb150-46"><a href="#cb150-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb150-47"><a href="#cb150-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-48"><a href="#cb150-48" aria-hidden="true" tabindex="-1"></a>    s3Client<span class="op">.</span><span class="fu">completeMultipartUpload</span><span class="op">(</span>completeRequest<span class="op">);</span></span>
<span id="cb150-49"><a href="#cb150-49" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h3 id="issue-8-consumer-rebalancing-loop">Issue 8: Consumer Rebalancing
Loop</h3>
<p><strong>Symptom</strong>: Consumer constantly disconnecting and
reconnecting</p>
<p><strong>Logs:</strong></p>
<pre><code>[INFO] Revoking previously assigned partitions [file-events-0, file-events-1]
[INFO] Setting newly assigned partitions [file-events-0, file-events-1]
[INFO] Revoking previously assigned partitions [file-events-0, file-events-1]
[INFO] Setting newly assigned partitions [file-events-0, file-events-1]
// Repeats forever...</code></pre>
<p><strong>Cause</strong>: Consumer processing takes longer than session
timeout</p>
<p><strong>Solution: Increase timeouts</strong></p>
<div class="sourceCode" id="cb152"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Properties</span> props <span class="op">=</span> <span class="kw">new</span> <span class="bu">Properties</span><span class="op">();</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ConsumerConfig<span class="op">.</span><span class="fu">SESSION_TIMEOUT_MS_CONFIG</span><span class="op">,</span> <span class="st">&quot;30000&quot;</span><span class="op">);</span>  <span class="co">// 30 seconds</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ConsumerConfig<span class="op">.</span><span class="fu">MAX_POLL_INTERVAL_MS_CONFIG</span><span class="op">,</span> <span class="st">&quot;300000&quot;</span><span class="op">);</span> <span class="co">// 5 minutes</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>props<span class="op">.</span><span class="fu">put</span><span class="op">(</span>ConsumerConfig<span class="op">.</span><span class="fu">MAX_POLL_RECORDS_CONFIG</span><span class="op">,</span> <span class="st">&quot;10&quot;</span><span class="op">);</span>  <span class="co">// Process fewer records</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>consumer <span class="op">=</span> <span class="kw">new</span> KafkaConsumer<span class="op">&lt;&gt;(</span>props<span class="op">);</span></span></code></pre></div>
<hr />
<h3 id="debugging-checklist">Debugging Checklist</h3>
<p><strong>When something doesn’t work:</strong></p>
<pre><code>☐ 1. Check all services are running
    docker-compose ps
    (All should show &quot;Up&quot; or &quot;Up (healthy)&quot;)

☐ 2. Check service logs
    docker-compose logs kafka
    docker-compose logs postgres
    docker-compose logs minio

☐ 3. Check network connectivity
    # From your Java app, can you reach services?
    telnet localhost 9092  # Kafka
    telnet localhost 5432  # PostgreSQL
    telnet localhost 9000  # MinIO

☐ 4. Check credentials
    # Are usernames/passwords correct?
    # Check docker-compose.yml matches your code

☐ 5. Check disk space
    df -h
    # Ensure you have enough space for data

☐ 6. Check Java version
    java -version
    # Should be Java 11 or higher

☐ 7. Check Maven dependencies
    mvn dependency:tree
    # Ensure all dependencies are downloaded

☐ 8. Clean and rebuild
    mvn clean compile
    docker-compose down -v
    docker-compose up -d</code></pre>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p>Congratulations! You now understand:</p>
<ol type="1">
<li>✅ <strong>Apache Kafka</strong> - Message streaming and event
processing</li>
<li>✅ <strong>PostgreSQL</strong> - Relational database and metadata
storage</li>
<li>✅ <strong>MinIO (S3)</strong> - Blob storage for large files</li>
<li>✅ <strong>Java Application</strong> - Orchestrating all
components</li>
<li>✅ <strong>Docker</strong> - Containerization and deployment</li>
<li>✅ <strong>Event-Driven Architecture</strong> - Building scalable
systems</li>
<li>✅ <strong>Real-World Applications</strong> - How Netflix,
Instagram, Dropbox work</li>
<li>✅ <strong>Troubleshooting</strong> - Solving common issues</li>
</ol>
<h3 id="next-steps">Next Steps</h3>
<ol type="1">
<li><strong>Extend the project</strong>:
<ul>
<li>Add user authentication</li>
<li>Implement file sharing</li>
<li>Add thumbnail generation</li>
<li>Create a REST API</li>
<li>Build a web frontend</li>
</ul></li>
<li><strong>Learn more</strong>:
<ul>
<li>Kubernetes (container orchestration)</li>
<li>Redis (caching)</li>
<li>Elasticsearch (search)</li>
<li>GraphQL (API design)</li>
<li>React (frontend)</li>
</ul></li>
<li><strong>Deploy to production</strong>:
<ul>
<li>Use AWS S3 instead of MinIO</li>
<li>Use AWS MSK instead of local Kafka</li>
<li>Use AWS RDS instead of local PostgreSQL</li>
<li>Add monitoring (Prometheus, Grafana)</li>
<li>Add logging (ELK stack)</li>
</ul></li>
</ol>
<h3 id="resources">Resources</h3>
<ul>
<li><strong>Kafka</strong>: https://kafka.apache.org/documentation/</li>
<li><strong>PostgreSQL</strong>: https://www.postgresql.org/docs/</li>
<li><strong>AWS S3</strong>: https://docs.aws.amazon.com/s3/</li>
<li><strong>Docker</strong>: https://docs.docker.com/</li>
<li><strong>Java</strong>: https://docs.oracle.com/en/java/</li>
</ul>
<hr />
<p><strong>Thank you for learning with this guide!</strong> 🎉</p>
<p><em>If you have questions or find issues, please refer to the
README.md and other documentation files in the project.</em></p>
</body>
</html>
